## A - Endpoints (Definición General)

**Definición:** Los endpoints en Astro son archivos .js o .ts dentro de src/pages/ que generan datos (como JSON, imágenes, etc.) en lugar de páginas HTML. Se usan para crear APIs o generar archivos estáticos.

**Ejemplo:**

```text
src/pages/
├── data.json.ts  // Genera /data.json
└── api/
    └── users.json.ts // Genera /api/users.json
```

(Los archivos .js o .ts en src/pages/ con extensiones como .json, .png, etc., se convierten en endpoints.)

## B - Endpoints Estáticos

**Definición:** En sitios generados estáticamente, los endpoints se ejecutan en tiempo de compilación para generar archivos estáticos.

**Ejemplo:**

```TypeScript
// src/pages/builtwith.json.ts
export async function GET({ params, request }) {
  return new Response(
    JSON.stringify({
      name: 'Astro',
      url: 'https://astro.build/'
    })
  );
}
```

(Este endpoint genera un archivo /builtwith.json con el JSON especificado.)

## C - Función GET (Endpoints)

**Definición:** Los endpoints exportan una función GET (opcionalmente async) que recibe un objeto context y debe retornar un objeto Response.

**Ejemplo:**

```TypeScript
// src/pages/data.json.ts
export async function GET({ params, request }) {
  return new Response(JSON.stringify({ message: "Hola!" }));
}
```

(La función GET define cómo se genera la respuesta del endpoint.)

## D - Objeto Response (Endpoints)

**Definición:** La función GET debe retornar un objeto Response que contiene los datos y metadatos de la respuesta.

**Ejemplo:**

```TypeScript
// src/pages/image.png.ts
export async function GET({ params, request }) {
  const response = await fetch("https://example.com/image.png");
  return new Response(await response.arrayBuffer(), {
    headers: { "Content-Type": "image/png" },
  });
}
```

(El objeto Response puede incluir el cuerpo de la respuesta, el código de estado y los encabezados.)

## E - Tipado de Endpoints (APIRoute)

**Definición:** Puedes tipar tus funciones de endpoint usando el tipo APIRoute de Astro.

**Ejemplo:**

```TypeScript
import type { APIRoute } from 'astro';

export const GET: APIRoute = async ({ params, request }) => {
  // ...
};
```

(Ayuda a tener un mejor tipado y detección de errores.)

## F - Rutas Dinámicas en Endpoints

**Definición:** Los endpoints soportan rutas dinámicas usando parámetros entre corchetes [] en el nombre del archivo.

**Ejemplo:**

```text
src/pages/api/[id].json.ts
```

(El archivo `[id]`.json.ts puede generar endpoints como /api/1.json, /api/2.json, etc.)

## G - getStaticPaths() en Endpoints

**Definición:** En modo estático, los endpoints con rutas dinámicas deben exportar getStaticPaths() para definir las rutas a generar.

**Ejemplo:**

```TypeScript
// src/pages/api/[id].json.ts
export function getStaticPaths() {
  return [
    { params: { id: "0"} },
    { params: { id: "1"} },
  ];
}
```

(Define que se generarán /api/0.json y /api/1.json.)

## H - Parámetro params (Endpoints)

**Definición:** El objeto context pasado a la función GET incluye un parámetro params que contiene los valores de los parámetros dinámicos.

**Ejemplo:**

```TypeScript
// src/pages/api/[id].json.ts
export async function GET({ params }) {
  const id = params.id;
  return new Response(JSON.stringify({ id }));
}
```

(Accede al valor del parámetro id.)

## I - Parámetro request (Endpoints Estáticos)

**Definición:** En modo estático, el objeto context incluye un parámetro request que contiene la URL del endpoint.

**Ejemplo:**

```TypeScript
// src/pages/request-path.json.ts
export async function GET({ request }) {
  return new Response(JSON.stringify({
    path: new URL(request.url).pathname
  }));
}
```

(Accede a la URL del endpoint.)

## J - Endpoints de Servidor (API Routes)

**Definición:** En modo SSR, los endpoints se ejecutan bajo demanda, permitiendo crear APIs que responden a las peticiones del cliente.

**Ejemplo:**

```TypeScript
// src/pages/api/products/[id].json.ts
export async function GET({ params }) {
  const product = await fetchProduct(params.id);
  return new Response(JSON.stringify(product));
}
```

(Este endpoint busca un producto por ID y lo devuelve como JSON.)

## K - prerender = false (Endpoints SSR)

**Definición:** En modo estático, usa export const prerender = false para evitar que un endpoint se genere en tiempo de compilación y se comporte como un endpoint SSR.

**Ejemplo:**

```TypeScript
// src/pages/api/dynamic.json.ts
export const prerender = false;

export async function GET({ params }) {
  // ...
}
```

(Este endpoint se ejecutará bajo demanda en modo estático.)

## L - Acceso a params en SSR

**Definición:** En modo SSR, los endpoints pueden acceder a params sin necesidad de getStaticPaths().

**Ejemplo:**

```TypeScript
// src/pages/[id].json.js
export async function GET({ params }) {
  const id = params.id;
  // ...
}
```

(Accede al parámetro id directamente.)

## M - Códigos de Estado y Encabezados (SSR)

**Definición:** En modo SSR, puedes usar el objeto Response para especificar códigos de estado y encabezados.

**Ejemplo:**

```TypeScript
// src/pages/api/product/[id].json.ts
export async function GET({ params }) {
  const product = await fetchProduct(params.id);
  if (!product) {
    return new Response(null, { status: 404, statusText: 'Not found' });
  }
  return new Response(JSON.stringify(product), {
    status: 200,
    headers: { "Content-Type": "application/json" },
  });
}
```

(Devuelve un 404 si el producto no se encuentra, o un 200 con el producto en JSON.)

## N - Métodos HTTP (Endpoints SSR)

**Definición:** En modo SSR, puedes exportar funciones con nombres de métodos HTTP (como POST, PUT, DELETE) para manejar diferentes tipos de peticiones.

**Ejemplo:**

```TypeScript
// src/pages/api/data.json.ts
export async function GET({ request }) {
  return new Response(JSON.stringify({ message: "GET" }));
}

export async function POST({ request }) {
  return new Response(JSON.stringify({ message: "POST" }));
}
```

(Maneja peticiones GET y POST por separado.)

## O - Función ALL (Endpoints SSR)

**Definición:** Puedes exportar una función ALL para manejar cualquier método HTTP que no tenga una función específica.

**Ejemplo:**

```TypeScript
// src/pages/api/data.json.ts
export async function ALL({ request }) {
  return new Response(JSON.stringify({ message: `Método: ${request.method}` }));
}
```

(Maneja cualquier método HTTP no definido.)

## P - Parámetro request (Endpoints SSR)

**Definición:** En modo SSR, el parámetro request es un objeto Request completo que permite acceder a los encabezados y al cuerpo de la petición.

**Ejemplo:**

```TypeScript
// src/pages/api/post.json.ts
export async function POST({ request }) {
  if (request.headers.get("Content-Type") === "application/json") {
    const body = await request.json();
    return new Response(JSON.stringify({ message: `Hola, ${body.name}!` }));
  }
  return new Response(null, { status: 400 });
}
```

(Accede al cuerpo de la petición JSON y a los encabezados.)

## Q - Redirecciones en Endpoints

**Definición:** El objeto context en endpoints SSR incluye una función redirect() para redirigir a otra URL.

**Ejemplo:**

```TypeScript
// src/pages/links/[id].js
export async function GET({ params, redirect }) {
  const link = await getLinkUrl(params.id);
  if (!link) {
    return new Response(null, { status: 404 });
  }
  return redirect(link, 307);
}
```

(Redirige a la URL obtenida de getLinkUrl().)
