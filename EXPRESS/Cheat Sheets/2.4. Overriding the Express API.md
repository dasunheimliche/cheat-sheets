## A - Puntos de Extensi贸n de la API de Express

#### 1. **Definici贸n:**

Express te da dos lugares principales para cambiar c贸mo funciona internamente su API, 隆como si pudieras personalizar tu coche!

- **Prototipos Globales:** Imagina que son los planos originales de f谩brica para todos los coches Express. Se encuentran en `express.request` y `express.response`. Si los cambias aqu铆, 隆afectar谩 a TODAS las apps Express que se ejecuten en el mismo lugar! 
- **Prototipos Espec铆ficos de la App:** Estos son como los planos personalizados para un coche Express en particular. Los encuentras en `app.request` y `app.response`. Cambiarlos aqu铆 solo afecta a esa app espec铆fica. 

#### 2. **Ejemplo:**

Imagina que quieres que todas tus apps Express tengan una funci贸n extra, como un "turbo". Podr铆as modificar los prototipos globales. Pero si solo quieres el "turbo" en una app, modificas los prototipos espec铆ficos de esa app.

#### 3. **Notas o advertencias:**

锔 隆Cuidado con los prototipos globales! Cambiarlos es como modificar los planos de f谩brica. Aseg煤rate de saber lo que haces, porque afectar谩 a todas las apps Express. Es m谩s seguro y recomendable modificar los prototipos espec铆ficos de cada app para evitar sorpresas inesperadas en otras partes.

---

## B - Sobrescribiendo M茅todos

#### 1. **Definici贸n:**

Los m茅todos son como las acciones que puedes realizar con los objetos `req` (request - petici贸n) y `res` (response - respuesta) en Express. Puedes cambiar c贸mo funcionan estos m茅todos, 隆reescribiendo las instrucciones! Es como darle una nueva funci贸n a un bot贸n.

#### 2. **Ejemplo:**

Digamos que quieres cambiar c贸mo funciona `res.sendStatus`, que normalmente solo env铆a el c贸digo de estado. Quieres que tambi茅n pueda enviar un mensaje y especificar el tipo de contenido.

```javascript
app.response.sendStatus = function (statusCode, type, message) {
  // Este c贸digo es simple para que se entienda f谩cil
  return this.contentType(type) // Le decimos el tipo de contenido (ej: json)
    .status(statusCode) // Establecemos el c贸digo de estado (ej: 404)
    .send(message); // Enviamos el mensaje (ej: 'No encontrado')
};
```

**Explicaci贸n del ejemplo:**
Aqu铆, hemos redefinido `res.sendStatus`. Ahora, en lugar de solo aceptar un c贸digo de estado, acepta tres cosas:

1.  `statusCode`: El c贸digo de estado HTTP (como 404, 200, etc.).
2.  `type`: El tipo de contenido que vamos a enviar (como 'application/json' para JSON).
3.  `message`: El mensaje que queremos enviar.

Ahora puedes usar `res.sendStatus` as铆:

```javascript
res.sendStatus(404, "application/json", '{"error":"recurso no encontrado"}');
```

**Explicaci贸n del uso:**
Esta l铆nea de c贸digo enviar谩 una respuesta con c贸digo de estado 404 (No Encontrado), establecer谩 el tipo de contenido a JSON y enviar谩 el mensaje JSON `{"error":"recurso no encontrado"}`. 隆Hemos personalizado `sendStatus`!

#### 3. **Notas o advertencias:**

- Al sobrescribir un m茅todo, 隆cambias completamente c贸mo funciona! Aseg煤rate de entender bien el m茅todo original y lo que quieres lograr con el cambio.
- En el ejemplo, hemos cambiado la "firma" del m茅todo `sendStatus`, ahora espera diferentes argumentos. Ten cuidado al hacer esto, ya que podr铆a confundir a otros desarrolladores que esperen el comportamiento original.

---

## C - Sobrescribiendo Propiedades

#### 1. **Definici贸n:**

Las propiedades son como caracter铆sticas o datos asociados a los objetos `req` y `res`. En Express, hay dos tipos principales de propiedades:

1.  **Propiedades Asignadas:** Se calculan y se les da un valor directamente cuando se hace una petici贸n. Ejemplos: `req.baseUrl`, `req.originalUrl`. Piensa en ellas como variables que se calculan y guardan una vez por petici贸n. М
2.  **Propiedades Definidas como Getters:** Estas no guardan un valor directamente. En su lugar, tienen una funci贸n especial (`getter`) que se ejecuta cada vez que intentas acceder a la propiedad para calcular su valor en ese momento. Ejemplos: `req.secure`, `req.ip`. Piensa en ellas como funciones que se ejecutan cada vez que preguntas por la propiedad. 锔

**Importante:** 隆Solo puedes cambiar el comportamiento de las propiedades del tipo 2 (getters)! Las propiedades asignadas (tipo 1) se calculan una vez y no puedes "interceptar" su c谩lculo de la misma manera.

#### 2. **Ejemplo:**

Vamos a cambiar c贸mo se obtiene la direcci贸n IP del cliente (`req.ip`). Por defecto, Express la obtiene de cierta manera (mirando cabeceras, etc.). Vamos a simplificarlo para que simplemente lea la IP de la cabecera `Client-IP` (隆ojo, esto es solo un ejemplo y no siempre es la mejor manera de obtener la IP real en producci贸n!).

```javascript
Object.defineProperty(app.request, "ip", {
  configurable: true, // Permite redefinir la propiedad m谩s adelante (si es necesario)
  enumerable: true, // Hace que la propiedad aparezca en bucles y Object.keys()
  get() {
    // 隆Aqu铆 est谩 el truco! Definimos un 'getter'
    return this.get("Client-IP"); //  Cuando alguien pregunte por 'req.ip', ejecutamos esto:
    //  Obtenemos el valor de la cabecera 'Client-IP'
  },
});
```

**Explicaci贸n del ejemplo:**

- `Object.defineProperty` es una funci贸n de JavaScript que nos permite definir o modificar propiedades de un objeto de forma muy precisa.
- `app.request, 'ip'` Le decimos que vamos a modificar la propiedad `ip` del objeto `app.request`.
- `get () { ... }` Definimos un _getter_. Esto significa que cada vez que alguien intente acceder a `req.ip`, en lugar de obtener un valor almacenado, se ejecutar谩 la funci贸n dentro de `get()`.
- `return this.get('Client-IP')` Dentro del getter, le decimos que obtenga el valor de la cabecera HTTP llamada `Client-IP` usando `this.get('Client-IP')` (que es una funci贸n de Express para obtener cabeceras). 隆Ese valor ser谩 lo que `req.ip` devuelva!

Ahora, cuando uses `req.ip` en tu c贸digo, 隆obtendr谩 el valor de la cabecera `Client-IP` en lugar de la forma en que Express lo hac铆a antes!

#### 3. **Notas o advertencias:**

- Sobrescribir propiedades (especialmente getters) puede ser 煤til para personalizar el comportamiento de Express, pero hazlo con cuidado. Aseg煤rate de entender qu茅 hace la propiedad original y qu茅 implicaciones tiene tu cambio.
- En el ejemplo de `req.ip`, simplificamos mucho la obtenci贸n de la IP. En un entorno real, obtener la IP correcta puede ser m谩s complejo (considerando proxies, etc.). Este ejemplo es solo para demostrar c贸mo sobrescribir un getter.

---

## D - Sobrescribiendo el Prototipo

#### 1. **Definici贸n:**

En programaci贸n orientada a objetos, un prototipo es como un "modelo" del que heredan los objetos. En Express, los objetos `req` y `res` que usa Express (cuando haces `app(req, res)`) normalmente heredan de ciertos prototipos por defecto:

- `req` (request - petici贸n) por defecto hereda de `http.IncomingRequest.prototype`.
- `res` (response - respuesta) por defecto hereda de `http.ServerResponse.prototype`.

Estos prototipos base vienen del m贸dulo `http` de Node.js, que es la base de Express. Puedes cambiar estos prototipos, 隆pero generalmente no es necesario y debes tener cuidado!

#### 2. **Ejemplo:**

Imagina que has creado tus propias clases `FakeRequest` y `FakeResponse` que se comportan de manera similar a las originales de `http`, pero quiz谩s con algunas diferencias para pruebas o entornos especiales. Puedes decirle a Express que use tus prototipos en lugar de los originales:

```javascript
// Usar FakeRequest y FakeResponse en lugar de http.IncomingRequest y http.ServerResponse
// para la app 'app'
Object.setPrototypeOf(
  Object.getPrototypeOf(app.request),
  FakeRequest.prototype
);
Object.setPrototypeOf(
  Object.getPrototypeOf(app.response),
  FakeResponse.prototype
);
```

**Explicaci贸n del ejemplo:**

- `Object.setPrototypeOf(obj, proto)` es una funci贸n de JavaScript que cambia el prototipo de un objeto (`obj`) a un nuevo prototipo (`proto`).
- `Object.getPrototypeOf(app.request)` Obtiene el prototipo actual del objeto `app.request`.
- `FakeRequest.prototype` Es el prototipo de tu clase `FakeRequest`.
- En resumen, estas l铆neas de c贸digo est谩n diciendo: "Cambia el prototipo del prototipo de `app.request` a `FakeRequest.prototype`" (y lo mismo para `app.response` y `FakeResponse`). 隆Es un poco enrevesado, pero as铆 se hace!).

Despu茅s de esto, los objetos `req` y `res` que use tu app `app` heredar谩n de `FakeRequest.prototype` y `FakeResponse.prototype` en lugar de los prototipos HTTP originales.

#### 3. **Notas o advertencias:**

- **隆Cuidado al cambiar prototipos!** Es una operaci贸n avanzada y puede causar problemas si los nuevos prototipos no son compatibles con lo que Express espera.
- **Recomendaci贸n:** Generalmente, solo deber铆as hacer esto a nivel de aplicaci贸n (`app-specific`), no globalmente (`express.request`, `express.response`), a menos que tengas una raz贸n muy espec铆fica y sepas lo que est谩s haciendo.
- **Aseg煤rate de que los nuevos prototipos sean lo m谩s parecidos posible a los originales** en cuanto a funcionalidad, para evitar comportamientos inesperados en Express. Normalmente, solo har铆as esto para casos muy espec铆ficos como pruebas o entornos de simulaci贸n.
