## A - Motores de Plantillas (Template Engines) en Express

#### 1. **Definici√≥n:**

Un **motor de plantillas** es como un traductor m√°gico para tus p√°ginas web. Imagina que tienes un archivo HTML "plantilla" con espacios en blanco. El motor de plantillas llena esos espacios con informaci√≥n real (como nombres, datos, etc.) cuando alguien visita tu p√°gina. ¬°Convierte una plantilla est√°tica en una p√°gina web din√°mica y personalizada! ü™Ñ

#### 2. **Ejemplo:**

Piensa en un formulario de "Hola [Nombre]". La parte "[Nombre]" es el espacio en blanco. El motor de plantillas toma esa plantilla y, cuando alguien la ve, reemplaza "[Nombre]" con el nombre real de la persona. ¬°As√≠ cada persona ve un saludo personalizado!

**Beneficios:**

- **Organizaci√≥n:** Separas el dise√±o HTML de los datos. ¬°M√°s f√°cil de mantener y entender! üóÇÔ∏è
- **Reutilizaci√≥n:** Usas la misma plantilla para mostrar diferentes datos. ¬°Ahorras c√≥digo y esfuerzo! ‚ôªÔ∏è
- **Din√°mico:** Creas p√°ginas web que cambian seg√∫n la informaci√≥n. ¬°Webs m√°s interactivas! üîÑ

#### 3. **Notas o advertencias:**

- Express no viene con un motor de plantillas preinstalado. ¬°Tienes que elegir e instalar uno!
- Hay muchos motores de plantillas para elegir (Pug, Handlebars, EJS, etc.). ¬°Cada uno tiene sus propias reglas y caracter√≠sticas!

---

## B - Configurando Motores de Plantillas en Express

#### 1. **Definici√≥n:**

Para que Express sepa que vas a usar un motor de plantillas y d√≥nde encontrar tus plantillas, necesitas configurarlo. Es como decirle a Express: "¬°Oye, vamos a usar plantillas y est√°n en este lugar!".

Hay dos configuraciones principales:

- **`views`:** Le dices a Express en qu√© carpeta guardas tus archivos de plantilla. Por defecto, busca en una carpeta llamada `views` en la ra√≠z de tu proyecto. üìÅ
- **`view engine`:** Le dices a Express qu√© motor de plantillas vas a usar (por ejemplo, Pug, EJS, Handlebars). Express necesita saber esto para usar el "traductor" correcto. ‚öôÔ∏è

#### 2. **Ejemplo:**

Imagina que tienes tus plantillas en una carpeta llamada `mis_plantillas` en tu proyecto y quieres usar el motor de plantillas Pug. As√≠ configurar√≠as Express:

```javascript
const express = require("express");
const app = express();

app.set("views", "./mis_plantillas"); // Le decimos que las plantillas est√°n en './mis_plantillas'
app.set("view engine", "pug"); // Le decimos que vamos a usar Pug

// ... tu c√≥digo de rutas y dem√°s ...

app.listen(3000, () => console.log("Servidor escuchando en el puerto 3000"));
```

**Explicaci√≥n del ejemplo:**

- `app.set('views', './mis_plantillas')`: Esta l√≠nea le dice a Express que busque los archivos de plantilla en la carpeta `./mis_plantillas` (que significa "la carpeta `mis_plantillas` en el mismo directorio que este archivo").
- `app.set('view engine', 'pug')`: Esta l√≠nea le dice a Express que el motor de plantillas que vamos a usar es "pug". ¬°Ahora Express sabe que debe usar Pug para procesar las plantillas!

#### 3. **Notas o advertencias:**

- Si no configuras `views`, Express asumir√° que tus plantillas est√°n en la carpeta `views` en la ra√≠z de tu proyecto.
- Si no configuras `view engine`, tendr√°s que especificar la extensi√≥n del archivo de plantilla cada vez que uses `res.render()`. ¬°Es m√°s c√≥modo configurar `view engine`!

---

## C - Instalando un Motor de Plantillas

#### 1. **Definici√≥n:**

Los motores de plantillas no vienen con Express por defecto. Tienes que instalar el que quieras usar como cualquier otra librer√≠a de Node.js, usando `npm install`. ¬°Es como descargar el "traductor" de plantillas que elegiste! üì¶

#### 2. **Ejemplo:**

Si quieres usar Pug, necesitas instalar el paquete `pug` usando npm en tu terminal:

```bash
npm install pug --save
```

**Explicaci√≥n del ejemplo:**

- `npm install pug`: Este comando le dice a npm (el gestor de paquetes de Node.js) que instale el paquete llamado `pug`.
- `--save`: Esto guarda `pug` como una dependencia en tu archivo `package.json`. As√≠, cuando compartas tu proyecto o lo vuelvas a instalar, npm sabr√° que necesita instalar `pug`.

Despu√©s de ejecutar este comando, ¬°Pug estar√° instalado y listo para usar en tu proyecto Express!

#### 3. **Notas o advertencias:**

- Aseg√∫rate de instalar el motor de plantillas **antes** de intentar usarlo en tu c√≥digo Express.
- El nombre del paquete npm suele ser el mismo que el nombre del motor de plantillas (ej: `pug` para Pug, `ejs` para EJS, `handlebars` para Handlebars).

---

## D - `__express` y `res.render()`: La Magia Detr√°s de las Plantillas

#### 1. **Definici√≥n:**

Express necesita una forma est√°ndar de comunicarse con los motores de plantillas. La mayor√≠a de los motores de plantillas compatibles con Express (como Pug, EJS, Handlebars) siguen una "convenci√≥n": exportan una funci√≥n especial llamada `__express`. ¬°Esta funci√≥n es como el "idioma com√∫n" entre Express y el motor de plantillas! üó£Ô∏è

Cuando usas `res.render()`, Express internamente llama a esta funci√≥n `__express` del motor de plantillas que configuraste. `__express` toma tu archivo de plantilla, los datos que le pasas y hace la magia de combinar la plantilla con los datos para generar el HTML final. ‚ú®

#### 2. **Ejemplo:**

No necesitas escribir la funci√≥n `__express` t√∫ mismo. ¬°El motor de plantillas (como Pug) ya la proporciona! Solo necesitas usar `res.render()` en tu c√≥digo Express.

Imagina que tienes un archivo de plantilla Pug llamado `index.pug` y quieres mostrarlo con algunos datos. As√≠ usar√≠as `res.render()`:

```javascript
app.get("/", (req, res) => {
  res.render("index", { title: "Mi P√°gina", mensaje: "¬°Hola desde Express!" });
});
```

**Explicaci√≥n del ejemplo:**

- `res.render('index', { title: 'Mi P√°gina', mensaje: '¬°Hola desde Express!' })`: Esta l√≠nea le dice a Express que:
  - `render('index'...)`: Use el archivo de plantilla llamado `index` (Express buscar√° `index.pug` en la carpeta `views` porque configuramos `view engine` a Pug).
  - `{ title: 'Mi P√°gina', mensaje: '¬°Hola desde Express!' }`: Pasa estos datos a la plantilla. Dentro de `index.pug`, podr√°s usar `title` y `mensaje` para mostrar estos valores.

Express, al llamar a `res.render()`, internamente usar√° la funci√≥n `__express` de Pug para procesar `index.pug` con los datos y enviar el HTML resultante al navegador.

#### 3. **Notas o advertencias:**

- No te preocupes demasiado por los detalles de `__express`. Lo importante es entender que `res.render()` es la funci√≥n que usas en Express para renderizar plantillas y que Express se encarga de usar el motor de plantillas correcto gracias a la configuraci√≥n `view engine` y la convenci√≥n `__express`.
- Algunos motores de plantillas no siguen exactamente la convenci√≥n `__express`. Para esos casos, existe la librer√≠a `@ladjs/consolidate` que "traduce" entre Express y varios motores de plantillas, ¬°haciendo que funcionen bien juntos!

---

## E - Ejemplo Completo con Pug

#### 1. **Definici√≥n:**

Vamos a ver un ejemplo completo usando el motor de plantillas Pug. Veremos c√≥mo crear un archivo de plantilla Pug, c√≥mo configurarlo en Express y c√≥mo renderizarlo en una ruta.

#### 2. **Ejemplo:**

**1. Archivo de plantilla Pug (`views/index.pug`):**

```pug
html
  head
    title= title  // 'title' ser√° reemplazado por el valor que le pasemos
  body
    h1= message // 'message' ser√° reemplazado por el valor que le pasemos
```

**Explicaci√≥n del archivo Pug:**

- Pug usa una sintaxis ÁÆÄÊ¥Å (concisa) basada en la indentaci√≥n. No usa etiquetas HTML completas como `<div>` o `<span>`.
- `title= title`: Esto significa "crea una etiqueta `<title>` y pon dentro el valor de la variable `title` que le pasemos desde Express". Lo mismo para `h1= message`.

**2. Ruta en Express (`app.js`):**

```javascript
const express = require("express");
const app = express();

app.set("views", "./views"); // Plantillas en la carpeta 'views'
app.set("view engine", "pug"); // Usamos el motor de plantillas Pug

app.get("/", (req, res) => {
  res.render("index", {
    title: "¬°Hola!",
    message: "¬°Bienvenido a mi web con Pug!",
  });
});

app.listen(3000, () => console.log("Servidor escuchando en el puerto 3000"));
```

**Explicaci√≥n de la ruta:**

- `res.render('index', ...)`: Renderiza la plantilla `index.pug`.
- `{ title: '¬°Hola!', message: '¬°Bienvenido a mi web con Pug!' }`: Pasamos estos datos a la plantilla. `title` tendr√° el valor '¬°Hola!' y `message` tendr√° el valor '¬°Bienvenido a mi web con Pug!'.

**3. Ejecuta tu app:**

Aseg√∫rate de haber instalado `pug` (`npm install pug --save`) y ejecuta tu app Node.js. Cuando visites la ruta `/` en tu navegador, ¬°ver√°s la p√°gina HTML generada por Pug!

#### 3. **Notas o advertencias:**

- Recuerda que el nombre del archivo de plantilla que pasas a `res.render()` (en este caso, `'index'`) **no incluye la extensi√≥n `.pug`** si has configurado `view engine` a `pug`. Express ya sabe que debe buscar un archivo `.pug` en la carpeta `views`.
- Si **no** hubieras configurado `view engine`, tendr√≠as que escribir `res.render('index.pug', ...)` para que Express supiera que es un archivo Pug. ¬°Configurar `view engine` hace que tu c√≥digo sea m√°s limpio!

---

## F - Cach√© del Motor de Plantillas

#### 1. **Definici√≥n:**

Express tiene un sistema de cach√© para los motores de plantillas. Pero, ¬°ojo!, este cach√© **no guarda el HTML final generado**, sino **la plantilla en s√≠ misma**. Es decir, guarda la "receta" de c√≥mo generar el HTML, no el "plato" ya cocinado. üç≥

#### 2. **Ejemplo:**

Imagina que tienes una plantilla Pug compleja. La primera vez que alguien visita una p√°gina que usa esa plantilla, Express la lee del disco, la procesa con Pug y genera el HTML. Si el cach√© est√° activado, Express guarda la plantilla Pug procesada en memoria. En las siguientes peticiones a la misma p√°gina, Express **no** vuelve a leer el archivo Pug del disco. ¬°Usa la versi√≥n en cach√©, lo que hace que el proceso sea m√°s r√°pido! üöÄ

**Importante:** Aunque la plantilla est√© en cach√©, **Express sigue renderizando la plantilla con cada petici√≥n**. Es decir, sigue combinando la plantilla con los datos y generando el HTML nuevo cada vez. El cach√© solo evita tener que volver a leer y procesar la plantilla desde el archivo en cada petici√≥n.

#### 3. **Notas o advertencias:**

- El cach√© de plantillas est√° **activado por defecto en producci√≥n** (`NODE_ENV=production`) y **desactivado en desarrollo** (`NODE_ENV=development`).
- En desarrollo, es √∫til que el cach√© est√© desactivado para que veas los cambios en tus plantillas inmediatamente sin tener que reiniciar el servidor.
- En producci√≥n, activar el cach√© mejora el rendimiento, especialmente para plantillas complejas que tardan en procesarse la primera vez.
- Si quieres desactivar o activar expl√≠citamente el cach√©, puedes usar la configuraci√≥n `view cache` en Express: `app.set('view cache', true)` o `app.set('view cache', false)`.
