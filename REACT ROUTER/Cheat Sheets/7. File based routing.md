## A - ¿Qué es File-Based Routing?

#### 1. **Definición:**

File-Based Routing es como organizar las calles de tu ciudad, ¡pero para tu app web! En lugar de escribir código complicado para definir cada ruta, usas **carpetas y archivos** en tu proyecto. La estructura de estos archivos **refleja directamente las URLs** de tu aplicación. Es como si el sistema de archivos fuera el mapa de tu navegación web.

#### 2. **Beneficios Clave:**

- **Simpleza:** Visualmente es muy fácil de entender, ¡incluso para quienes recién empiezan!
- **Organización:** Tus rutas se ven ordenadas como las URLs de tu página.
- **Escalabilidad:** Si tu app crece, añadir o cambiar rutas es pan comido.
- **Code-Splitting Automático:** TanStack Router divide tu código automáticamente para que tu app vuele.
- **Type-Safety:** Ayuda a que tu código sea más seguro y sin errores de tipo.
- **Consistencia:** Todas tus rutas siguen la misma lógica, ¡adiós al caos!

#### 3. **Notas o advertencias:**

- Es la forma **recomendada** de usar TanStack Router.
- Si ya sabes cómo funciona, puedes saltar a la sección de **Instalación** más abajo.

---

## B - Rutas con Carpetas (Directory Routes)

#### 1. **Definición:**

Usar **carpetas** para organizar tus rutas. Imagina que cada carpeta es una sección principal de tu web (como `/blog`, `/tienda`, `/contacto`). Dentro de cada carpeta, puedes tener archivos `.tsx` que representan las páginas dentro de esa sección.

#### 2. **Ejemplo:**

Imagina esta estructura de archivos:

```
src/routes/
├── __root.tsx        (Componente raíz de toda la app)
├── index.tsx         (Página principal: "/")
├── about.tsx         (Página "Acerca de": "/about")
├── posts.tsx         (Página "Posts": "/posts")
└── posts/            (Carpeta "posts" para rutas relacionadas con posts)
    ├── index.tsx     (Índice de posts: "/posts")
    └── $postId.tsx  (Post individual: "/posts/$postId")
```

**Explicación del ejemplo:**

- `__root.tsx` define el componente que envuelve toda tu aplicación.
- `index.tsx` en la raíz es la página principal (`/`).
- `about.tsx` es la página `/about`.
- `posts.tsx` es la página `/posts`.
- La carpeta `posts/` crea una sección `/posts`.
  - `posts/index.tsx` es la página principal dentro de `/posts`, o sea, `/posts`.
  - `posts/$postId.tsx` crea una ruta dinámica para ver posts individuales como `/posts/123`, `/posts/otro-post`, etc. (`$postId` es un parámetro dinámico).

#### 3. **Notas o advertencias:**

- Ideal para organizar rutas en grupos lógicos.
- Reduce la longitud de los nombres de archivo en rutas muy anidadas.

---

## C - Rutas Planas (Flat Routes)

#### 1. **Definición:**

En lugar de carpetas, usas el carácter **`.`** en los nombres de archivo para indicar niveles de anidamiento. Es como si "aplanaras" la estructura de carpetas en los nombres de los archivos.

#### 2. **Ejemplo:**

La misma estructura de rutas del ejemplo anterior, pero ahora con rutas planas:

```
src/routes/
├── __root.tsx
├── index.tsx
├── about.tsx
├── posts.tsx
├── posts.index.tsx      (Índice de posts: "/posts")
└── posts.$postId.tsx   (Post individual: "/posts/$postId")
```

**Explicación del ejemplo:**

- `posts.index.tsx` es equivalente a `posts/index.tsx` en el ejemplo anterior, creando la ruta `/posts`.
- `posts.$postId.tsx` es equivalente a `posts/$postId.tsx`, creando rutas como `/posts/123`.

#### 3. **Notas o advertencias:**

- Útil cuando tienes muchas rutas anidadas de forma única y no quieres crear carpetas para cada una.
- Mantiene la estructura de rutas en los nombres de archivo.

---

## D - Rutas Mixtas (Mixed Flat and Directory Routes)

#### 1. **Definición:**

¡Lo mejor de ambos mundos! Puedes **combinar rutas con carpetas y rutas planas** en tu proyecto. Así, usas carpetas cuando tiene sentido agrupar rutas y rutas planas para anidamientos más puntuales.

#### 2. **Ejemplo:**

```
src/routes/
├── __root.tsx
├── index.tsx
├── about.tsx
├── posts.tsx
└── posts/
    ├── index.tsx
    └── $postId.tsx
        └── edit.tsx  (Edición de post: "/posts/$postId/edit")
```

**Explicación del ejemplo:**

- Aquí combinamos la carpeta `posts/` para agrupar rutas de posts, pero dentro de `$postId.tsx` usamos `edit.tsx` para crear la subruta `/edit`.

#### 3. **Notas o advertencias:**

- Lo más probable es que esta sea la mejor opción para la mayoría de los proyectos.
- Te da flexibilidad para organizar tus rutas de la manera más lógica.

---

## E - Parámetros de Ruta Dinámicos (Dynamic Path Params)

#### 1. **Definición:**

Son partes de la URL que **cambian** y que quieres capturar como variables. Se indican con el carácter **`$`** en el nombre del archivo o carpeta.

#### 2. **Ejemplo:**

Ya hemos visto ejemplos como `posts/$postId.tsx`.

- `$postId` captura la parte variable de la URL después de `/posts/`.
- Si vas a `/posts/123`, `$postId` tendrá el valor `"123"`.
- Si vas a `/posts/mi-post`, `$postId` tendrá el valor `"mi-post"`.

#### 3. **Notas o advertencias:**

- Súper útil para páginas de detalles, perfiles de usuario, etc.
- Profundizaremos en esto en la guía de [Path Params](https://tanstack.com/router/latest/docs/framework/react/guide/path-params).

---

## F - Rutas Sin Path (Pathless Routes)

#### 1. **Definición:**

Rutas que te permiten **envolver rutas hijas con lógica o un componente**, pero **sin añadir nada a la URL**. Se indican con el carácter **`_`** al inicio del nombre del archivo.

#### 2. **Ejemplo:**

```
src/routes/
├── _app.tsx         (Componente "App" sin path)
├── _app.a.tsx       (Ruta "/a" dentro de App)
└── _app.b.tsx       (Ruta "/b" dentro de App)
```

**Explicación del ejemplo:**

- `_app.tsx` no crea una ruta por sí mismo, pero envuelve las rutas hijas `_app.a.tsx` y `_app.b.tsx`.
- `/a` y `/b` **no** se convierten en `/app/a` o `/app/b`, sino que siguen siendo `/a` y `/b`, pero con el componente de `_app.tsx` "por encima".

#### 3. **Notas o advertencias:**

- Ideal para layouts o lógica que quieres aplicar a un grupo de rutas sin cambiar la URL.
- Más detalles en [Routing Concepts - Pathless Routes](https://tanstack.com/router/latest/docs/framework/react/guide/routing-concepts#pathless-routes).

---

## G - Convenciones de Nombres de Archivo

#### 1. **Lista de Convenciones:**

Aquí tienes un resumen de las reglas para nombrar tus archivos de rutas:

- **`__root.tsx`**: Archivo **raíz** de rutas. Debe estar en la carpeta `routesDirectory`.
- **`.` (Separador)**: Indica **anidamiento** de rutas (ej: `blog.post.tsx`).
- **`$` (Token)**: Indica un **parámetro dinámico** en la URL (ej: `$postId.tsx`).
- **`_` (Prefijo)**: Indica una ruta **sin path** (layout-route) (ej: `_layout.tsx`).
- **`_` (Sufijo)**: Excluye la ruta de ser anidada bajo rutas padre (ej: `posts_.tsx`).
- **`(folder)` (Patrón de carpeta)**: Carpeta que coincide con este patrón se trata como un **grupo de rutas**, no se incluye en la URL.
- **`index` (Token)**: Indica la ruta **índice** de una carpeta (ej: `index.tsx` dentro de `posts/`).
- **`.route.tsx` (Tipo de archivo)**: Para archivos de ruta dentro de carpetas (ej: `blog.post.route.tsx` o `blog/post/route.tsx`).
- **`.lazy.tsx` (Tipo de archivo)**: Para componentes que se cargan de forma **lazy** (code-splitting) (ej: `blog.post.lazy.tsx`).

#### 2. **Notas o advertencias:**

- ¡Sigue estas reglas al pie de la letra para que TanStack Router entienda tus rutas!
- Las opciones de configuración (`tsr.config.json`) pueden afectar estas convenciones.
- Rutas que empiecen por `/api` están reservadas para futuras funcionalidades de TanStack Start. Si necesitas usar `/api`, configura la opción `apiBase`.
- Archivos/carpetas que empiecen por `-` se ignoran por defecto (puedes cambiar esto con `routeFileIgnorePrefix`).

---

## H - Instalación

#### 1. **Bundlers Soportados:**

Para usar File-Based Routing, necesitas un bundler compatible:

- **Vite**
- **Rspack/Rsbuild**
- **Webpack**
- **Esbuild**

#### 2. **Plugin de TanStack Router:**

La forma más fácil es usar el **plugin de TanStack Router** para tu bundler. Se encarga de generar automáticamente la configuración de rutas durante el desarrollo y la construcción de tu proyecto.

#### 3. **Instalación del Plugin:**

```bash
npm install -D @tanstack/router-plugin
```

#### 4. **Configuración del Plugin en tu Bundler:**

Dependiendo de tu bundler, necesitas añadir el plugin a su configuración. Aquí tienes ejemplos:

- **Vite (`vite.config.ts`):**

  ```tsx
  import { defineConfig } from "vite";
  import viteReact from "@vitejs/plugin-react";
  import { TanStackRouterVite } from "@tanstack/router-plugin/vite";

  export default defineConfig({
    plugins: [
      TanStackRouterVite(),
      viteReact(),
      // ...
    ],
  });
  ```

- **Rspack/Rsbuild (`rsbuild.config.ts`):**

  ```tsx
  import { defineConfig } from "@rsbuild/core";
  import { pluginReact } from "@rsbuild/plugin-react";
  import { TanStackRouterRspack } from "@tanstack/router-plugin/rspack";

  export default defineConfig({
    plugins: [pluginReact()],
    tools: {
      rspack: {
        plugins: [TanStackRouterRspack()],
      },
    },
  });
  ```

- **Webpack (`webpack.config.ts`):**

  ```tsx
  import { TanStackRouterWebpack } from "@tanstack/router-plugin/webpack";

  export default {
    plugins: [TanStackRouterWebpack()],
  };
  ```

- **Esbuild (`esbuild.config.js`):**

  ```tsx
  import { TanStackRouterEsbuild } from "@tanstack/router-plugin/esbuild";

  export default {
    // ...
    plugins: [TanStackRouterEsbuild()],
  };
  ```

#### 5. **CLI de TanStack Router (Alternativa):**

Si tu bundler no es compatible, puedes usar el **CLI de TanStack Router** (`@tanstack/router-cli`) para generar el archivo de rutas.

- **Instalación del CLI:**

  ```bash
  npm install -D @tanstack/router-cli
  ```

- **Scripts en `package.json`:**

  ```json
  {
    "scripts": {
      "generate-routes": "tsr generate",
      "watch-routes": "tsr watch",
      "build": "npm run generate-routes && ...",
      "dev": "npm run watch-routes && ..."
    }
  }
  ```

- **Comandos del CLI:**
  - `tsr generate`: Genera las rutas una vez.
  - `tsr watch`: Vigila los archivos y regenera las rutas automáticamente al cambiar.

#### 6. **Ignorar el archivo `routeTree.gen.ts`:**

¡Importante! Debes **ignorar** el archivo `routeTree.gen.ts` generado por TanStack Router en tu linter/formatter (Prettier, ESLint, Biome) y en tu sistema de control de versiones (Git). Este archivo se genera automáticamente y no debes editarlo manualmente.

- **Ejemplo para VSCode (`.vscode/settings.json`):**

  ```json
  {
    "files.readonlyInclude": {
      "**/routeTree.gen.ts": true
    },
    "files.watcherExclude": {
      "**/routeTree.gen.ts": true
    },
    "search.exclude": {
      "**/routeTree.gen.ts": true
    }
  }
  ```

#### 7. **Desactivar el Plugin en Tests (Opcional):**

Si usas Vitest, puedes desactivar el plugin durante las pruebas para que no interfiera:

```tsx
// vite.config.ts
import { defineConfig } from "vite";
import viteReact from "@vitejs/plugin-react";
import { TanStackRouterVite } from "@tanstack/router-vite-plugin";

const isTest = process.env.NODE_ENV === "test";

export default defineConfig({
  plugins: [
    !isTest && TanStackRouterVite(),
    viteReact(),
    // ...
  ],
});
```

---

## I - Configuración (`tsr.config.json`)

#### 1. **Archivo `tsr.config.json`:**

Para personalizar la configuración de File-Based Routing, crea un archivo `tsr.config.json` en la **raíz de tu proyecto**.

#### 2. **Opciones de Configuración:**

Aquí tienes las opciones más importantes que puedes configurar en `tsr.config.json`:

- **`routesDirectory` (Obligatorio):** Directorio donde están tus archivos de rutas (por defecto: `./src/routes`).
- **`generatedRouteTree` (Obligatorio):** Ruta al archivo generado con el árbol de rutas (por defecto: `./src/routeTree.gen.ts`).
- **`routeFileIgnorePrefix` (Opcional):** Prefijo para ignorar archivos/carpetas de rutas (por defecto: `-`).
- **`routeFilePrefix` (Opcional):** Prefijo para incluir solo archivos/carpetas que empiecen con él.
- **`routeFileIgnorePattern` (Opcional):** Patrón regex para ignorar archivos/carpetas.
- **`indexToken` (Opcional):** Nombre del token para archivos índice (por defecto: `'index'`).
- **`routeToken` (Opcional):** Nombre del token para archivos de ruta en carpetas (por defecto: `'route'`).
- **`autoCodeSplitting` (Opcional):** Activar code-splitting automático (por defecto: `false`).
- **`quoteStyle` (Opcional):** Estilo de comillas en el archivo generado (`'single'` o `'double'`, por defecto: `'single'`).
- **`semicolons` (Opcional):** Usar punto y coma en el archivo generado (por defecto: `false`).
- **`apiBase` (Opcional):** Base para rutas API (por defecto: `/api`).
- **`disableTypes` (Opcional):** Desactivar generación de tipos (por defecto: `false`).
- **`addExtensions` (Opcional):** Añadir extensiones a los nombres de ruta en el árbol generado (por defecto: `false`).
- **`disableLogging` (Opcional):** Desactivar logs de generación de rutas (por defecto: `false`).
- **`routeTreeFileHeader` (Opcional):** Array de strings para añadir al inicio del archivo generado.
- **`routeTreeFileFooter` (Opcional):** Array de strings para añadir al final del archivo generado.
- **`disableManifestGeneration` (Opcional):** Desactivar la generación del manifiesto del árbol de rutas (por defecto: `false`).

#### 3. **Ejemplo de `tsr.config.json`:**

```json
{
  "routesDirectory": "./src/paginas",
  "generatedRouteTree": "./src/rutas-generadas.ts",
  "routeFileIgnorePrefix": "_",
  "quoteStyle": "double"
}
```

**Explicación del ejemplo:**

- Cambia el directorio de rutas a `./src/paginas`.
- Cambia el archivo generado a `./src/rutas-generadas.ts`.
- Ignora archivos/carpetas que empiecen con `_`.
- Usa comillas dobles en el archivo generado.

#### 4. **Notas o advertencias:**

- ¡No uses los tokens de convenciones de nombres de archivo (`$`, `_`, `.`, `index`, `route`) en `routeFilePrefix`, `routeFileIgnorePrefix` o `routeFileIgnorePattern`! Podría causar problemas.
- Si no necesitas personalizar nada, ¡no necesitas crear `tsr.config.json`! Los valores por defecto suelen funcionar muy bien.

---

## J - Inclusión / Exclusión de Rutas

#### 1. **Opciones `routeFilePrefix` y `routeFileIgnorePrefix`:**

Estas opciones te permiten **controlar qué archivos y carpetas se consideran rutas** y cuáles se ignoran.

#### 2. **Ejemplo de Inclusión (`routeFilePrefix`):**

Si solo quieres considerar archivos/carpetas que empiecen con `~` como rutas, usa esta configuración:

```json
{
  "routeFilePrefix": "~",
  "routesDirectory": "./src/routes",
  "generatedRouteTree": "./src/routeTree.gen.ts"
}
```

Con esta configuración, solo los archivos que empiecen con `~` dentro de `src/routes` se convertirán en rutas.

#### 3. **Ejemplo de Exclusión (`routeFileIgnorePrefix`):**

Si quieres ignorar archivos/carpetas que empiecen con `-` (que es el valor por defecto), usa esta configuración:

```json
{
  "routeFileIgnorePrefix": "-",
  "routesDirectory": "./src/routes",
  "generatedRouteTree": "./src/routeTree.gen.ts"
}
```

Con esta configuración, cualquier archivo o carpeta que empiece con `-` dentro de `src/routes` será ignorado por el sistema de rutas.

#### 4. **Notas o advertencias:**

- `routeFilePrefix` es útil si quieres tener archivos de rutas y otros archivos en la misma carpeta y distinguirlos fácilmente. `~` es un prefijo recomendado.
- `routeFileIgnorePrefix` es útil para ignorar archivos auxiliares, componentes, etc., que no son rutas. `-` es un prefijo recomendado.
