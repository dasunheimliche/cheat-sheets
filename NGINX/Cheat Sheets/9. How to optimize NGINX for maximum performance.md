## A - Procesos de Trabajo (Worker Processes)

#### 1. **Definición:**

Los procesos de trabajo son como los "empleados" de NGINX. Cada uno de ellos se encarga de atender las peticiones de los usuarios. NGINX puede tener varios de estos "empleados" trabajando al mismo tiempo para manejar muchas peticiones a la vez.

#### 2. **Ejemplo:**

```nginx
worker_processes auto;

events {

}

http {

    server {

        listen 80;
        server_name nginx-handbook.test;

        return 200 "worker processes and worker connections configuration!\n";
    }
}
```

**Explicación del ejemplo:**

- `worker_processes auto;`: Esta línea le dice a NGINX que configure automáticamente el número de procesos de trabajo. Lo ideal es que sea igual al número de núcleos de tu CPU para usar toda la potencia de tu servidor sin desperdiciar recursos. `auto` hace que NGINX lo calcule por ti.

#### 3. **Notas o advertencias:**

- **¿Cuántos procesos?** La regla general es: **número de procesos de trabajo = número de núcleos de CPU**. Si tienes un servidor con 4 núcleos, idealmente deberías tener 4 procesos de trabajo.
- **`auto` es tu amigo:** Usar `worker_processes auto;` es la forma más sencilla y recomendada. NGINX se encargará de ajustarlo automáticamente según tu servidor.
- **No siempre más es mejor:** Aumentar los procesos de trabajo más allá del número de núcleos de CPU no siempre mejora el rendimiento e incluso podría empeorarlo.

## B - Conexiones de Trabajo (Worker Connections)

#### 1. **Definición:**

Las conexiones de trabajo definen cuántas conexiones puede manejar **cada uno** de los procesos de trabajo **al mismo tiempo**. Imagina que cada "empleado" (proceso de trabajo) tiene un número máximo de "clientes" (conexiones) que puede atender simultáneamente.

#### 2. **Ejemplo:**

```nginx
worker_processes auto;

events {
    worker_connections 1024;
}

http {

    server {

        listen 80;
        server_name nginx-handbook.test;

        return 200 "worker processes and worker connections configuration!\n";
    }
}
```

**Explicación del ejemplo:**

- `worker_connections 1024;`: Esta línea, dentro del bloque `events {}`, establece que cada proceso de trabajo puede manejar hasta 1024 conexiones simultáneas.
- **Bloque `events`:** La configuración de `worker_connections` va dentro del bloque `events` porque son ajustes generales de NGINX que afectan a todos los procesos de trabajo.

#### 3. **Notas o advertencias:**

- **Límite del sistema operativo:** El número máximo de `worker_connections` también depende del límite de archivos abiertos que permite tu sistema operativo. Puedes consultar este límite con el comando `ulimit -n` en Linux.
- **Ajusta según necesidad:** 1024 es un valor común, pero puedes ajustarlo según las necesidades de tu aplicación y los recursos de tu servidor. Si esperas muchas conexiones simultáneas, puedes aumentarlo, pero siempre dentro de los límites de tu sistema.

## C - Caché de Contenido Estático

#### 1. **Definición:**

El caché de contenido estático es como guardar copias de archivos que no cambian mucho (imágenes, CSS, JavaScript) para servirlos más rápido. En lugar de buscar el archivo original cada vez, NGINX entrega la copia guardada, lo que acelera mucho la carga de la página web.

#### 2. **Ejemplo:**

```nginx
worker_processes auto;

events {
    worker_connections 1024;
}

http {

    include /env/nginx/mime.types;

    server {

        listen 80;
        server_name nginx-handbook.test;

        root /srv/nginx-handbook-demo/static-demo;

        location ~* \.(css|js|jpg)$ {
            access_log off;

            add_header Cache-Control public;
            add_header Pragma public;
            add_header Vary Accept-Encoding;
            expires 1M;
        }
    }
}
```

**Explicación del ejemplo:**

- `location ~* \.(css|js|jpg)$ { ... }`: Este bloque configura el caché **solo** para archivos que terminan en `.css`, `.js` o `.jpg`. `~*` significa que la búsqueda no distingue entre mayúsculas y minúsculas.
- `access_log off;`: Desactiva el registro de acceso para estos archivos estáticos, ya que suelen ser muchas peticiones y no es necesario registrarlas todas para análisis.
- `add_header Cache-Control public;`: Indica al navegador y a otros cachés (como los de los proveedores de internet) que estos archivos se pueden guardar en caché públicamente.
- `add_header Pragma public;`: Es una directiva más antigua que hace lo mismo que `Cache-Control public`, para asegurar compatibilidad con navegadores antiguos.
- `add_header Vary Accept-Encoding;`: Avisa al caché que la respuesta puede variar dependiendo de la compresión que acepte el navegador (lo veremos en el siguiente punto).
- `expires 1M;`: Establece que el caché de estos archivos sea válido durante **1 mes** (`1M`). Puedes usar `10m` (10 minutos), `24h` (24 horas), etc.

#### 3. **Notas o advertencias:**

- **Formatos comunes:** `.css`, `.js`, `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp` son formatos típicos para cachear.
- **`WebP`:** El texto menciona el formato `WebP` para imágenes, que es muy eficiente y recomendado para la web.
- **Tiempo de caché (`expires`):** Ajusta el tiempo de caché según la frecuencia con la que cambian tus archivos estáticos. Si cambian poco, puedes usar tiempos más largos (meses). Si cambian más a menudo, usa tiempos más cortos (horas o días).

## D - Compresión de Respuestas (GZIP)

#### 1. **Definición:**

Comprimir las respuestas significa enviar los archivos web en un formato más pequeño (comprimido) al navegador. Esto reduce el tamaño de los archivos que se transfieren por internet, haciendo que las páginas se carguen más rápido, especialmente para usuarios con conexiones lentas. NGINX usa `gzip` para comprimir.

#### 2. **Ejemplo:**

```nginx
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include /env/nginx/mime.types;

    gzip on;
    gzip_comp_level 3;

    gzip_types text/css text/javascript;

    server {

        listen 80;
        server_name nginx-handbook.test;

        root /srv/nginx-handbook-demo/static-demo;

        location ~* \.(css|js|jpg)$ {
            access_log off;

            add_header Cache-Control public;
            add_header Pragma public;
            add_header Vary Accept-Encoding;
            expires 1M;
        }
    }
}
```

**Explicación del ejemplo:**

- `gzip on;`: Activa la compresión `gzip` para las respuestas del servidor.
- `gzip_comp_level 3;`: Define el nivel de compresión. Valores entre 1 y 4 suelen ser un buen equilibrio entre compresión y uso de CPU. 3 es un valor recomendado.
- `gzip_types text/css text/javascript;`: Especifica **qué tipos de archivos** se van a comprimir. Por defecto, NGINX solo comprime HTML. Aquí le decimos que también comprima archivos `text/css` (CSS) y `text/javascript` (JavaScript).

#### 3. **Notas o advertencias:**

- **No todo se comprime:** No es recomendable comprimir formatos que ya están comprimidos, como imágenes (`.jpg`, `.png`, `.gif`, `.webp`), vídeos o archivos `.zip`. Comprimir archivos ya comprimidos no suele reducir mucho el tamaño y consume recursos del servidor innecesariamente.
- **`Accept-Encoding: gzip`:** Para que el navegador reciba la versión comprimida, debe indicar en su petición que acepta la compresión `gzip` mediante la cabecera `Accept-Encoding: gzip`. Los navegadores modernos lo hacen automáticamente.
- **`Vary: Accept-Encoding` (de nuevo):** La cabecera `Vary: Accept-Encoding` que vimos en el caché es importante aquí. Le dice a los cachés que la respuesta puede ser diferente (comprimida o no comprimida) dependiendo de si el navegador acepta `gzip` o no.
