## A - Archivo de Configuración Principal `nginx.conf`

#### 1. **Definición:**

El archivo `nginx.conf` es el corazón de la configuración de Nginx. Piensa en él como el director de orquesta que coordina todos los aspectos de tu servidor web. Aunque es importante, ¡normalmente no lo modificamos directamente!

#### 2. **Ejemplo:**

Imagina que `nginx.conf` es como el menú principal de un restaurante. No cambias el menú principal cada vez que quieres un plato diferente, ¿verdad? En lugar de eso, pides platos del menú. En Nginx, en lugar de cambiar `nginx.conf`, creamos archivos de configuración separados para nuestros sitios web.

#### 3. **Notas o advertencias:**

- **¡No lo toques (mucho)!**: A menos que sepas muy bien lo que haces, es mejor dejar el `nginx.conf` original como está. Los mantenedores de Nginx lo configuran para que funcione bien por defecto.
- **Incluye a otros**: `nginx.conf` usa la directiva `include` para traer configuraciones desde otros archivos y directorios. ¡Así es como mantenemos todo organizado!

## B - Volviendo al `nginx.conf` Original

#### 1. **Definición:**

Si has estado experimentando y modificaste el `nginx.conf` directamente (¡como te mostré antes, pero ya no lo haremos así!), es buena idea volver al archivo original para empezar de forma limpia y segura.

#### 2. **Ejemplo:**

Estos comandos te ayudarán a restaurar el `nginx.conf` original:

```bash
sudo rm /etc/nginx/nginx.conf
sudo mv /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf
sudo nginx -s reload
```

**Explicación del ejemplo:**

- `sudo rm /etc/nginx/nginx.conf`: Borra el `nginx.conf` modificado. ¡Ojo, que lo borra de verdad!
- `sudo mv /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf`: Renombra tu copia de seguridad (`nginx.conf.backup`) de vuelta a `nginx.conf`. ¡Magia!
- `sudo nginx -s reload`: Recarga Nginx para que use la configuración original.

#### 3. **Notas o advertencias:**

- **Copia de seguridad**: ¡Siempre haz una copia de seguridad antes de modificar archivos importantes! Por eso renombramos el original a `nginx.conf.backup` al principio.
- **`reload` es tu amigo**: Después de cualquier cambio en la configuración de Nginx, usa `sudo nginx -s reload` para aplicar los cambios sin interrumpir el servicio.

## C - Desglosando el `nginx.conf` Original

#### 1. **Definición:**

Vamos a ver qué hay dentro del `nginx.conf` original para entender cómo está configurado Nginx por defecto.

#### 2. **Ejemplo:**

Aquí tienes el contenido típico de un `nginx.conf` original:

```nginx
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 768;
}

http {

    ## Basic Settings ##
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    ## SSL Settings ##
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    ## Logging Settings ##
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    ## Gzip Settings ##
    gzip on;

    ## Virtual Host Configs ##
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

**Explicación del ejemplo:**

- **`user www-data;`**: Indica con qué usuario (en este caso, `www-data`) se ejecutarán los procesos de Nginx. Es por seguridad.
- **`worker_processes auto;`**: Nginx decide automáticamente cuántos procesos de "trabajadores" usar para manejar las conexiones, ¡lo hace solo y bien!
- **`pid /run/nginx.pid;`**: Guarda el "número de identificación" del proceso principal de Nginx en este archivo. Útil para que el sistema sepa cómo controlar Nginx.
- **`include /etc/nginx/modules-enabled/*.conf;`**: Carga configuraciones adicionales para módulos dinámicos de Nginx. No te preocupes mucho por esto ahora.
- **`events { ... }`**: Configuración para cómo Nginx maneja las conexiones de red. `worker_connections 768;` dice que cada proceso trabajador puede manejar hasta 768 conexiones a la vez.
- **`http { ... }`**: ¡Aquí está la magia para la web! Toda la configuración relacionada con servir páginas web va aquí dentro.
  - **`## Basic Settings ##`**: Ajustes básicos para optimizar la entrega de contenido web.
    - **`sendfile on;`**: Acelera la entrega de archivos estáticos (imágenes, CSS, JavaScript...).
    - **`tcp_nopush on;` y `tcp_nodelay on;`**: Otras optimizaciones para enviar datos de forma más eficiente.
    - **`keepalive_timeout 65;`**: Mantiene las conexiones abiertas durante 65 segundos para que el navegador pueda pedir más cosas sin tener que reconectar todo el tiempo.
    - **`types_hash_max_size 2048;`**: Ajuste técnico para manejar los tipos de archivos (MIME types).
    - **`include /etc/nginx/mime.types;`**: Carga la lista de tipos de archivos y cómo debe servirlos Nginx.
    - **`default_type application/octet-stream;`**: Si Nginx no sabe qué tipo de archivo es, lo sirve como "descarga genérica".
  - **`## SSL Settings ##`**: Configuración para conexiones seguras (HTTPS). `ssl_protocols` define qué versiones de SSL/TLS se permiten y `ssl_prefer_server_ciphers on;` prioriza las configuraciones de seguridad del servidor.
  - **`## Logging Settings ##`**: Dónde guarda Nginx los registros de acceso (quién visita tu web) y errores (si algo sale mal).
    - **`access_log /var/log/nginx/access.log;`**: Registro de accesos.
    - **`error_log /var/log/nginx/error.log;`**: Registro de errores.
  - **`## Gzip Settings ##`**: Configuración para comprimir las respuestas web (hacerlas más pequeñas y rápidas de descargar). `gzip on;` activa la compresión gzip.
  - **`## Virtual Host Configs ##`**: ¡La clave para configurar tus sitios web!
    - **`include /etc/nginx/conf.d/*.conf;`**: Incluye archivos de configuración que estén dentro del directorio `/etc/nginx/conf.d/` y terminen en `.conf`.
    - **`include /etc/nginx/sites-enabled/*;`**: ¡Y aquí está el truco! Incluye todos los archivos que estén _dentro_ del directorio `/etc/nginx/sites-enabled/`. ¡Este es el directorio donde activaremos nuestros sitios web!

#### 3. **Notas o advertencias:**

- **Comentarios**: Las líneas que empiezan con `#` son comentarios, Nginx las ignora. Sirven para explicar la configuración (¡como estoy haciendo yo ahora!).
- **Contextos**: `events { ... }`, `http { ... }` y (en el ejemplo completo, aunque lo saltamos) `mail { ... }` son "contextos". Organizan la configuración en bloques lógicos.

## D - Directivas `include`: El Secreto de la Organización

#### 1. **Definición:**

La directiva `include` es como una "llamada" a otros archivos de configuración. Permite dividir la configuración de Nginx en partes más pequeñas y manejables, ¡manteniendo todo ordenado y fácil de entender!

#### 2. **Ejemplo:**

En `nginx.conf` vemos estas líneas:

```nginx
include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/*;
```

**Explicación del ejemplo:**

- **`include /etc/nginx/conf.d/*.conf;`**: "Oye, Nginx, ve al directorio `/etc/nginx/conf.d/` y carga todos los archivos que terminen en `.conf` como si estuvieran escritos aquí mismo en `nginx.conf`". Este directorio es para configuraciones generales que quizás quieras aplicar a varios sitios.
- **`include /etc/nginx/sites-enabled/*;`**: "Ahora ve a `/etc/nginx/sites-enabled/` y carga _todos_ los archivos que haya dentro". ¡Este es el directorio clave para activar nuestros sitios web!

#### 3. **Notas o advertencias:**

- **Comodines (`*`)**: El asterisco `*` es un comodín. Significa "cualquier archivo". `*.conf` significa "cualquier archivo que termine en `.conf`".
- **Orden**: El orden en que se incluyen los archivos sí importa, especialmente si tienes configuraciones que se pisan unas a otras. Pero en general, para sitios web, no te preocupes demasiado por el orden dentro de `sites-enabled`.

## E - Estructura de Directorios para Virtual Hosts: Orden y Limpieza

#### 1. **Definición:**

Para organizar los sitios web que sirves con Nginx, se usa una estructura de directorios específica:

- `/etc/nginx/sites-available/`: Aquí guardamos los archivos de configuración de _cada uno_ de nuestros sitios web. Piensa en ellos como "disponibles" pero no necesariamente "activos".
- `/etc/nginx/sites-enabled/`: Aquí creamos **enlaces simbólicos** a los archivos de configuración que están en `/etc/nginx/sites-available/`. Solo los sitios con enlaces simbólicos en `sites-enabled` están _activos_.

#### 2. **Ejemplo:**

Imagina que tienes dos sitios web: `mi-blog.com` y `mi-tienda.com`.

1.  Crearías un archivo de configuración para cada uno en `/etc/nginx/sites-available/`:

    - `/etc/nginx/sites-available/mi-blog`
    - `/etc/nginx/sites-available/mi-tienda`

2.  Para activar `mi-blog.com`, crearías un enlace simbólico en `/etc/nginx/sites-enabled/`:

    - `sudo ln -s /etc/nginx/sites-available/mi-blog /etc/nginx/sites-enabled/mi-blog`

3.  Si quieres activar también `mi-tienda.com`, harías lo mismo:

    - `sudo ln -s /etc/nginx/sites-available/mi-tienda /etc/nginx/sites-enabled/mi-tienda`

4.  Para desactivar un sitio, simplemente borras el enlace simbólico de `/etc/nginx/sites-enabled/`. ¡El archivo en `/etc/nginx/sites-available/` sigue ahí, listo para ser activado de nuevo cuando quieras!

#### 3. **Notas o advertencias:**

- **Enlaces simbólicos**: Un enlace simbólico es como un "acceso directo" en Windows o un "alias" en macOS/Linux. Apunta a otro archivo o directorio. En este caso, los enlaces en `/etc/nginx/sites-enabled/` apuntan a los archivos de configuración en `/etc/nginx/sites-available/`.
- **`sites-available` vs `sites-enabled`**: Esta separación es una forma muy elegante de gestionar sitios web. Puedes tener muchos sitios configurados en `sites-available`, pero solo activas los que realmente quieres que funcionen creando enlaces en `sites-enabled`.

## F - Ejemplo Práctico: Configurando un Servidor Estático

#### 1. **Definición:**

Vamos a crear un ejemplo sencillo para ver cómo funciona esto de `sites-available` y `sites-enabled`. Configuraremos un servidor para servir archivos estáticos (como una página web simple).

#### 2. **Ejemplo:**

**Pasos:**

1.  **Borrar el enlace simbólico "default" (si existe):** Desactiva la configuración por defecto de Nginx.

    ```bash
    sudo rm /etc/nginx/sites-enabled/default
    ```

2.  **Crear el archivo de configuración para nuestro sitio:** En `/etc/nginx/sites-available/`, crea un archivo llamado `nginx-handbook` (o el nombre que quieras).

    ```bash
    sudo touch /etc/nginx/sites-available/nginx-handbook
    ```

3.  **Editar el archivo de configuración:** Abre `/etc/nginx/sites-available/nginx-handbook` con tu editor de texto favorito (nano, vim, etc.) y pon este contenido:

    ```nginx
    server {
        listen 80;
        server_name nginx-handbook.test;

        root /srv/nginx-handbook-projects/static-demo;
    }
    ```

    **Explicación de la configuración:**

    - `server { ... }`: Define un bloque de configuración para un servidor virtual.
    - `listen 80;`: Escucha en el puerto 80 (el puerto estándar para HTTP).
    - `server_name nginx-handbook.test;`: Este sitio responderá a las peticiones para el nombre de dominio `nginx-handbook.test`. (Tendrás que configurar esto en tu archivo `hosts` local para probarlo en tu máquina, pero eso es otro tema).
    - `root /srv/nginx-handbook-projects/static-demo;`: Indica el directorio donde están los archivos de este sitio web. Nginx buscará los archivos dentro de este directorio. (¡Asegúrate de que este directorio exista y tenga archivos HTML!).

4.  **Crear el enlace simbólico para activar el sitio:**

    ```bash
    sudo ln -s /etc/nginx/sites-available/nginx-handbook /etc/nginx/sites-enabled/nginx-handbook
    ```

    Esto crea un enlace en `/etc/nginx/sites-enabled/nginx-handbook` que apunta a `/etc/nginx/sites-available/nginx-handbook`. ¡Ahora el sitio está activo!

#### 3. **Notas o advertencias:**

- **`server` block**: Recuerda que los archivos en `/etc/nginx/sites-available/` solo deben contener bloques `server { ... }`. Ya están dentro del contexto `http { ... }` gracias al `nginx.conf` principal.
- **`server_name` y `hosts`**: Para probar `nginx-handbook.test` en tu máquina local, tendrás que añadir una línea como `127.0.0.1 nginx-handbook.test` a tu archivo `hosts`. Esto "engaña" a tu ordenador para que piense que `nginx-handbook.test` apunta a tu propia máquina.

## G - Reabriendo los Archivos de Log: Permisos al Día

#### 1. **Definición:**

A veces, después de cambiar la configuración principal de Nginx (como hicimos al restaurar `nginx.conf`), los archivos de registro (`access.log` y `error.log`) pueden dar problemas de permisos. Esto pasa porque el "proceso" de Nginx ha cambiado y necesita "reabrir" los archivos de log con el nuevo proceso.

#### 2. **Ejemplo:**

Si ves errores de "permission denied" en los logs después de recargar Nginx, estos comandos pueden ayudarte:

```bash
sudo rm /var/log/nginx/*.log
sudo touch /var/log/nginx/access.log /var/log/nginx/error.log
sudo nginx -s reopen
```

**Explicación del ejemplo:**

- `sudo rm /var/log/nginx/*.log`: Borra los archivos de log antiguos. (¡Ojo, perderás los registros anteriores!).
- `sudo touch /var/log/nginx/access.log /var/log/nginx/error.log`: Crea archivos de log nuevos y vacíos.
- `sudo nginx -s reopen`: Le dice a Nginx que "reabra" los archivos de log. Esto hace que Nginx empiece a escribir en los nuevos archivos con los permisos correctos.

#### 3. **Notas o advertencias:**

- **Pérdida de logs**: Borrar los logs antiguos (`sudo rm /var/log/nginx/*.log`) significa que perderás el historial de accesos y errores. Si necesitas guardarlos, ¡haz una copia de seguridad antes de borrarlos!
- **`reopen` vs `reload`**: `nginx -s reopen` solo afecta a los archivos de log. `nginx -s reload` recarga toda la configuración de Nginx. Son comandos diferentes para cosas diferentes.

## H - Validando y Recargando la Configuración: ¡Comprobando que Todo Está Bien!

#### 1. **Definición:**

Después de hacer cualquier cambio en la configuración de Nginx, es crucial **validar** la configuración para asegurarte de que no hay errores de sintaxis y luego **recargar** Nginx para que use la nueva configuración.

#### 2. **Ejemplo:**

Estos son los comandos mágicos:

```bash
sudo nginx -t
sudo nginx -s reload
```

**Explicación del ejemplo:**

- `sudo nginx -t`: **Valida la configuración.** Nginx revisa todos los archivos de configuración para ver si hay errores de sintaxis (por ejemplo, si te has dejado un punto y coma, o has escrito mal una directiva). Si todo está bien, verás un mensaje como:

  ```
  nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
  nginx: configuration file /etc/nginx/nginx.conf test is successful
  ```

  Si hay errores, Nginx te dirá dónde están para que puedas corregirlos. **¡Siempre valida antes de recargar!**

- `sudo nginx -s reload`: **Recarga la configuración.** Si la validación (`nginx -t`) fue exitosa, este comando le dice a Nginx que aplique la nueva configuración. Nginx lo hace sin interrumpir las conexiones existentes, ¡así que tu sitio web sigue funcionando sin problemas!

#### 3. **Notas o advertencias:**

- **Primero `-t`, luego `-s reload`**: ¡Siempre valida con `nginx -t` antes de recargar con `nginx -s reload`! Si recargas con errores, Nginx podría no arrancar correctamente o comportarse de forma inesperada.
- **Errores**: Si `nginx -t` te da errores, léelos con atención. Te dirán en qué archivo y línea está el problema. Corrige los errores y vuelve a validar hasta que todo esté "ok".

## I - Verificando la Configuración: ¿Funciona?

#### 1. **Definición:**

Después de configurar tu sitio web y recargar Nginx, ¡el último paso es comprobar que todo funciona como esperas!

#### 2. **Ejemplo:**

1.  **Visita tu sitio web en el navegador.** En nuestro ejemplo, deberías visitar `http://nginx-handbook.test` (o el `server_name` que hayas configurado).

2.  **¿Ves la página correcta?** Si configuraste un servidor estático con el contenido de "The NGINX Handbook", deberías ver esa página:

    ![Image](https://www.freecodecamp.org/news/content/images/2021/04/image-100.png)

#### 3. **Notas o advertencias:**

- **Caché del navegador**: A veces, si ya has visitado tu sitio web antes, el navegador puede mostrarte una versión antigua de la página desde su "caché". Si no ves los cambios que esperas, prueba con un **"hard refresh"** (normalmente `Ctrl + Shift + R` o `Cmd + Shift + R`). Esto fuerza al navegador a descargar la página web de nuevo desde el servidor, en lugar de usar la versión guardada en la caché.
- **Logs**: Si no ves la página correcta o tienes problemas, revisa los archivos de log de Nginx (`/var/log/nginx/access.log` y `/var/log/nginx/error.log`). Los logs suelen dar pistas muy útiles sobre lo que está pasando mal.
