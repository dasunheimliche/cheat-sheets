## A - Archivos de Log por Defecto en NGINX

#### 1. **Definición:**

NGINX guarda registros de actividad en dos archivos principales dentro de la carpeta `/var/log/nginx/`:

- **`access.log`**: Aquí se registra cada petición que recibe tu servidor web. Imagina que es como el libro de visitas de tu página web, donde se anota quién entra y qué pide.
- **`error.log`**: Este archivo guarda los problemas o errores que ocurren en NGINX. Es como el diario de incidencias, donde se apuntan los fallos para poder solucionarlos.

#### 2. **Ejemplo:**

Si abres la terminal y escribes el siguiente comando, podrás ver los archivos de log por defecto:

```bash
ls -lh /var/log/nginx/
```

**Resultado:**

```
# -rw-r----- 1 www-data adm     0 Apr 25 07:34 access.log
# -rw-r----- 1 www-data adm     0 Apr 25 07:34 error.log
```

**Explicación del ejemplo:**
Este comando te muestra una lista detallada de los archivos dentro de `/var/log/nginx/`. Vemos `access.log` y `error.log`, ¡justo los que estábamos buscando! `-rw-r-----` indica los permisos de los archivos, y el resto de la línea nos da información sobre el propietario, grupo, tamaño y fecha de modificación.

#### 3. **Notas o advertencias:**

- La ubicación `/var/log/nginx/` es la más común, pero en algunos sistemas operativos o configuraciones podría ser diferente. Si no los encuentras aquí, ¡no te preocupes! Más adelante veremos cómo configurar dónde se guardan.
- Al principio, estos archivos pueden estar vacíos (tamaño 0), como en el ejemplo. Se irán llenando a medida que tu servidor web reciba peticiones y ocurran eventos.

## B - Limpiando y Reabriendo los Logs

#### 1. **Definición:**

A veces, para empezar desde cero o para hacer pruebas, puede ser útil vaciar los archivos de log. Para hacer esto de forma correcta en NGINX, no basta con borrar los archivos y crearlos de nuevo. ¡Hay que decirle a NGINX que los "reabra"!

#### 2. **Ejemplo:**

Aquí te dejo los comandos para limpiar los logs y decirle a NGINX que los reabra:

```bash
# Borra los archivos antiguos (¡ojo, esto es permanente!)
sudo rm /var/log/nginx/access.log /var/log/nginx/error.log

# Crea archivos nuevos y vacíos
sudo touch /var/log/nginx/access.log /var/log/nginx/error.log

# Indica a NGINX que reabra los archivos de log
sudo nginx -s reopen
```

**Explicación del ejemplo:**

1.  **`sudo rm ...`**: Este comando borra los archivos `access.log` y `error.log`. **¡Cuidado!** Una vez borrados, no se pueden recuperar fácilmente.
2.  **`sudo touch ...`**: Crea archivos nuevos con el mismo nombre. `touch` se usa para actualizar la fecha de modificación de un archivo, pero si el archivo no existe, ¡lo crea vacío!
3.  **`sudo nginx -s reopen`**: Este es el comando clave. Le dice a NGINX que cierre los archivos de log que tenía abiertos y vuelva a abrirlos. Si no haces esto, NGINX seguirá escribiendo en los archivos "antiguos" (que ya borraste) y los nuevos se quedarán vacíos.

#### 3. **Notas o advertencias:**

- **¡Piensa bien antes de borrar los logs!** Si son importantes para ti, considera hacer una copia de seguridad antes de borrarlos.
- El comando `nginx -s reopen` es esencial después de crear nuevos archivos de log. ¡No te olvides de él!

## C - Logs de Acceso - Comportamiento Predeterminado

#### 1. **Definición:**

Por defecto, NGINX registra cada petición que recibe tu servidor en el archivo `access.log`. Esto es muy útil para saber quién visita tu página, qué páginas ven, etc.

#### 2. **Ejemplo:**

Vamos a simular una petición a tu servidor web y ver cómo se registra en `access.log`. Primero, asegúrate de que tu servidor NGINX está configurado para responder a `http://nginx-handbook.test`. Luego, ejecuta este comando en la terminal:

```bash
curl -I http://nginx-handbook.test
```

**Resultado del comando `curl`:**

```
# HTTP/1.1 200 OK
# Server: nginx/1.18.0 (Ubuntu)
# Date: Sun, 25 Apr 2021 08:35:59 GMT
# Content-Type: text/html
# Content-Length: 960
# Last-Modified: Sun, 25 Apr 2021 08:35:33 GMT
# Connection: keep-alive
# ETag: "608529d5-3c0"
# Accept-Ranges: bytes
```

Ahora, vamos a ver el contenido del archivo `access.log`:

```bash
sudo cat /var/log/nginx/access.log
```

**Resultado del comando `cat`:**

```
# 192.168.20.20 - - [25/Apr/2021:08:35:59 +0000] "HEAD / HTTP/1.1" 200 0 "-" "curl/7.68.0"
```

**Explicación del ejemplo:**

- **`curl -I http://nginx-handbook.test`**: Este comando envía una petición "HEAD" a tu servidor. "HEAD" es como preguntar "¿existe esta página?" sin descargar todo el contenido. `curl` es una herramienta para hacer peticiones web desde la terminal.
- **Resultado de `curl`**: Vemos una respuesta `HTTP/1.1 200 OK`, que significa que todo fue bien. También vemos información sobre el servidor NGINX, la fecha, el tipo de contenido, etc.
- **`sudo cat /var/log/nginx/access.log`**: Este comando muestra el contenido del archivo `access.log`.
- **Resultado de `cat`**: ¡Aquí está la línea del log! `192.168.20.20` es la dirección IP desde donde se hizo la petición, `[25/Apr/2021:08:35:59 +0000]` es la fecha y hora, `"HEAD / HTTP/1.1"` es la petición en sí, `200` es el código de respuesta HTTP (OK), `0` es el tamaño del contenido, y `"curl/7.68.0"` indica que la petición se hizo con `curl`.

#### 3. **Notas o advertencias:**

- Cada vez que alguien (o algo) acceda a tu servidor web, se añadirá una nueva línea a `access.log`.
- El formato de las líneas en `access.log` se puede personalizar, ¡lo veremos más adelante!

## D - Personalizando los Logs de Acceso con `access_log`

#### 1. **Definición:**

La directiva `access_log` en la configuración de NGINX te permite controlar dónde y cómo se guardan los logs de acceso. Puedes hacer tres cosas principales:

1.  **Usar el `access.log` por defecto:** Si no pones ninguna directiva `access_log` dentro de un bloque `location`, se usará el archivo por defecto (`/var/log/nginx/access.log`).
2.  **Guardar los logs en un archivo diferente para ubicaciones específicas:** Puedes definir un archivo de log diferente para ciertas partes de tu web (por ejemplo, para la sección de administración).
3.  **Desactivar los logs de acceso para ubicaciones específicas:** Si hay partes de tu web donde no te interesa guardar logs de acceso (por ejemplo, para archivos estáticos que se sirven muchísimas veces), puedes desactivarlos.

#### 2. **Ejemplo:**

Vamos a modificar la configuración de NGINX para ver cómo funciona `access_log`. Abre tu archivo de configuración (normalmente `/etc/nginx/nginx.conf` o un archivo dentro de `/etc/nginx/conf.d/` o `/etc/nginx/sites-available/`) y añade o modifica la sección `http` y `server` para que se parezca a esto:

```nginx
events {

}

http {

    include /etc/nginx/mime.types;

    server {

        listen 80;
        server_name nginx-handbook.test;

        location / {
            return 200 "esto se registrará en el archivo por defecto.\n";
        }

        location = /admin {
            access_log /var/log/nginx/admin.log; # ¡Log especial para /admin!

            return 200 "esto se registrará en un archivo separado.\n";
        }

        location = /no_logging {
            access_log off; # ¡No registrar logs para /no_logging!

            return 200 "esto no se registrará.\n";
        }
    }
}
```

Después de guardar los cambios, valida la configuración y recarga NGINX:

```bash
sudo nginx -t # Valida la configuración
sudo nginx -s reload # Recarga NGINX
```

Ahora, vamos a hacer peticiones a las diferentes URLs y ver los logs:

```bash
curl http://nginx-handbook.test/no_logging
# esto no se registrará

sudo cat /var/log/nginx/access.log
# (Debería estar vacío o no tener nuevas líneas)

curl http://nginx-handbook.test/admin
# esto se registrará en un archivo separado.

sudo cat /var/log/nginx/access.log
# (Debería estar vacío o no tener nuevas líneas)

sudo cat /var/log/nginx/admin.log
# 192.168.20.20 - - [25/Apr/2021:11:13:53 +0000] "GET /admin HTTP/1.1" 200 40 "-" "curl/7.68.0"

curl  http://nginx-handbook.test/
# esto se registrará en el archivo por defecto.

sudo cat /var/log/nginx/access.log
# 192.168.20.20 - - [25/Apr/2021:11:15:14 +0000] "GET / HTTP/1.1" 200 41 "-" "curl/7.68.0"
```

**Explicación del ejemplo:**

- **`location /`**: No tiene `access_log` definido, así que usa el comportamiento por defecto: logs en `/var/log/nginx/access.log`.
- **`location = /admin`**: Aquí definimos `access_log /var/log/nginx/admin.log;`. Esto significa que las peticiones a `/admin` se registrarán en un archivo nuevo llamado `admin.log` dentro de la carpeta `/var/log/nginx/`.
- **`location = /no_logging`**: Usamos `access_log off;` para desactivar completamente los logs de acceso para esta ubicación. Las peticiones a `/no_logging` no se registrarán en ningún archivo de log de acceso.

#### 3. **Notas o advertencias:**

- La directiva `access_log` se puede usar dentro de los bloques `http`, `server` y `location`. Si se define en un bloque más específico (como `location`), ¡esa configuración tiene prioridad!
- Usar `access_log off;` puede ser útil para mejorar el rendimiento en situaciones donde no necesitas logs de acceso, pero ¡úsalo con cuidado! A veces, los logs son muy útiles para diagnosticar problemas.

## E - Logs de Error - Comportamiento Predeterminado

#### 1. **Definición:**

El archivo `error.log` es donde NGINX registra los problemas y errores que ocurren. Esto es crucial para entender qué va mal en tu servidor y poder solucionarlo.

#### 2. **Ejemplo:**

Para generar un error y verlo en `error.log`, vamos a modificar la configuración de NGINX para que tenga un error intencionado. Cambia la sección `server` en tu archivo de configuración a esto:

```nginx
events {

}

http {

    include /etc/nginx/mime.types;

    server {

        listen 80;
        server_name nginx-handbook.test;

        return 200 "..." "..."; # ¡Error aquí! Demasiados argumentos en 'return'
    }

}
```

Como sabes, la directiva `return` solo acepta dos parámetros, ¡pero aquí le hemos dado tres! Ahora, intenta recargar la configuración:

```bash
sudo nginx -s reload
```

**Resultado del comando `reload`:**

```
# nginx: [emerg] invalid number of arguments in "return" directive in /etc/nginx/nginx.conf:14
```

¡NGINX nos avisa de que hay un error! Ahora, vamos a ver el contenido de `error.log`:

```bash
sudo cat /var/log/nginx/error.log
```

**Resultado del comando `cat`:**

```
# 2021/04/25 08:35:45 [notice] 4169#4169: signal process started
# 2021/04/25 10:03:18 [emerg] 8434#8434: invalid number of arguments in "return" directive in /etc/nginx/nginx.conf:14
```

**Explicación del ejemplo:**

- **`return 200 "..." "..."` (con tres argumentos)**: Esto es un error de configuración en NGINX. La directiva `return` solo puede tener un código de respuesta (como `200`) y un texto o URL.
- **`sudo nginx -s reload`**: Al intentar recargar la configuración con el error, NGINX detecta el problema y muestra un mensaje de error en la terminal: `invalid number of arguments in "return" directive...`.
- **`sudo cat /var/log/nginx/error.log`**: Al ver el `error.log`, encontramos el mismo mensaje de error: `invalid number of arguments in "return" directive...`. Además, vemos una línea `[emerg]` al principio, que indica la gravedad del error (¡emergencia!). También hay una línea `[notice]` que es un mensaje informativo normal de NGINX al iniciar.

#### 3. **Notas o advertencias:**

- El archivo `error.log` es tu mejor amigo para diagnosticar problemas en NGINX. ¡Consúltalo siempre que algo no funcione como esperas!
- Los mensajes en `error.log` tienen diferentes niveles de gravedad, ¡vamos a verlos ahora!

## F - Niveles de Mensajes de Error

#### 1. **Definición:**

Los mensajes de error en NGINX tienen diferentes niveles de gravedad. Esto ayuda a priorizar qué problemas son más importantes y cuáles son solo informativos. Aquí tienes los ocho niveles, de menos a más grave:

- **`debug`**: Información muy detallada para depuración. Útil para desarrolladores que intentan entender problemas muy específicos.
- **`info`**: Mensajes informativos, no son errores, pero pueden ser útiles para saber qué está haciendo NGINX.
- **`notice`**: Algo normal que ha ocurrido y que es bueno saber. No son errores, pero indican eventos importantes.
- **`warn`**: Algo inesperado ha ocurrido, pero no es grave. Podría ser un problema potencial en el futuro.
- **`error`**: Algo ha fallado. Es un error, pero el servidor web puede seguir funcionando (aunque alguna funcionalidad podría verse afectada).
- **`crit`**: Problemas críticos que necesitan atención urgente. El servidor web podría estar funcionando de forma inestable.
- **`alert`**: Se requiere acción inmediata. Un problema grave que necesita ser resuelto rápidamente.
- **`emerg`**: ¡Emergencia! El sistema está en un estado inutilizable y necesita atención inmediata. El servidor web podría no estar funcionando correctamente.

#### 2. **Ejemplo:**

En el ejemplo anterior, vimos un mensaje con nivel `[emerg]`: `invalid number of arguments in "return" directive...`. Esto indica un error grave que impidió que NGINX recargara la configuración. Los mensajes `[notice]` son menos graves, como el mensaje `signal process started` que vimos en el mismo ejemplo.

#### 3. **Notas o advertencias:**

- Por defecto, NGINX registra mensajes de todos los niveles en `error.log`.
- Puedes configurar NGINX para que solo registre mensajes de un nivel mínimo en adelante, ¡lo veremos en el siguiente punto!
- Es importante entender los niveles de error para saber qué problemas son más urgentes de solucionar. `emerg`, `alert` y `crit` son los más importantes, mientras que `debug`, `info` y `notice` suelen ser menos urgentes (o solo informativos).

## G - Personalizando los Logs de Error con `error_log`

#### 1. **Definición:**

La directiva `error_log` te permite controlar dónde se guardan los logs de error y, lo que es más importante, ¡qué nivel mínimo de error se registra! Esto es muy útil para evitar que el archivo `error.log` se llene de mensajes poco importantes (como `notice` o `info`) y centrarte en los errores más graves.

#### 2. **Ejemplo:**

Vamos a configurar NGINX para que solo registre errores de nivel `warn` o superior. Modifica la sección `server` en tu archivo de configuración así:

```nginx
events {

}

http {

    include /etc/nginx/mime.types;

    server {

        listen 80;
        server_name nginx-handbook.test;

        error_log /var/log/nginx/error.log warn; # ¡Solo errores 'warn' o más graves!

        return 200 "..." "..."; # Seguimos teniendo el error intencionado
    }

}
```

Hemos añadido `error_log /var/log/nginx/error.log warn;`. Esto le dice a NGINX que guarde los logs de error en `/var/log/nginx/error.log` y que solo registre mensajes de nivel `warn`, `error`, `crit`, `alert` o `emerg`. Los mensajes de nivel `debug`, `info` y `notice` ya no se registrarán.

Valida y recarga la configuración:

```bash
sudo nginx -t
sudo nginx -s reload
```

Ahora, vamos a ver el contenido de `error.log`:

```bash
cat /var/log/nginx/error.log
```

**Resultado del comando `cat`:**

```
# 2021/04/25 11:27:02 [emerg] 12769#12769: invalid number of arguments in "return" directive in /etc/nginx/nginx.conf:16
```

**Explicación del ejemplo:**

- **`error_log /var/log/nginx/error.log warn;`**: Esta línea configura el nivel mínimo de error a `warn`.
- **Resultado de `cat error.log`**: Vemos el mensaje de error `[emerg] invalid number of arguments...`. Como `emerg` es un nivel de error más grave que `warn`, ¡se ha registrado! Pero si hubiera mensajes de nivel `notice` (como el `signal process started` que vimos antes), ¡ya no aparecerían en el log!

#### 3. **Notas o advertencias:**

- La directiva `error_log` se puede usar en los bloques `http`, `server` y `location`.
- Para la mayoría de los proyectos, dejar la configuración de `error_log` como está por defecto (registrando todos los niveles) suele ser suficiente.
- Sin embargo, si quieres tener un `error.log` más limpio y centrarte en los errores más importantes, configurar el nivel mínimo a `warn` es una buena práctica, ¡especialmente en entornos de producción! Así evitarás que el log se llene de mensajes informativos que no requieren acción inmediata.

## H - ¿Quieres Saber Más?

#### 1. **Definición:**

Si te has quedado con ganas de profundizar en la personalización de los logs en NGINX, ¡la documentación oficial es tu mejor amiga!

#### 2. **Ejemplo:**

Aquí te dejo un enlace directo a la guía oficial de NGINX sobre logging:

[Documentación oficial de NGINX sobre Logging](https://docs.nginx.com/nginx/admin-guide/monitoring/logging/)

#### 3. **Notas o advertencias:**

- La documentación oficial de NGINX es muy completa y está siempre actualizada. ¡Es el mejor recurso para aprender más sobre NGINX!
- En la documentación encontrarás información sobre formatos de log personalizados, rotación de logs (para que los archivos de log no crezcan indefinidamente), y muchas otras opciones avanzadas.
