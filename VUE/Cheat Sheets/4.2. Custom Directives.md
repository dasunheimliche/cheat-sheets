## A - Custom Directives

**Definición:** Las directivas personalizadas en Vue son una manera de extender la funcionalidad de las plantillas HTML, permitiéndonos manipular el DOM de manera directa cuando las directivas predefinidas (como `v-if`, `v-for`, `v-bind`, etc.) no son suficientes. Imagina que las directivas predefinidas son herramientas comunes de un taller (martillos, destornilladores), mientras que las directivas personalizadas son herramientas especializadas que tú mismo puedes crear para trabajos muy específicos.

**Ejemplo:** Crearemos una directiva que cambia el color de fondo de un elemento cuando el componente se monta.

```vue
<script setup>
const vBackgroundColor = {
  mounted: (el) => {
    el.style.backgroundColor = "lightblue";
  },
};
</script>

<template>
  <div v-background-color>Este div tiene fondo celeste.</div>
</template>
```

**Descripción del ejemplo:** La directiva `vBackgroundColor` se define como un objeto con una función `mounted`. Esta función se ejecuta cuando el elemento al que se le aplica la directiva se inserta en el DOM. En este caso, la función cambia el `backgroundColor` del elemento a `lightblue`. Usamos `v-background-color` en el div de la plantilla, lo que hace que cambie su color de fondo al montarse.

## B - Componentes vs. Directivas

**Definición:** Los componentes son los bloques principales para construir interfaces de usuario, encapsulando lógica, plantillas y estilos. Son como los "ladrillos" de una casa. Los `composables`, por otro lado, son funciones que encapsulan lógica con estado, como si fueran herramientas especializadas para diferentes tareas dentro de la casa (por ejemplo, una alarma, una llave, etc). Las directivas, en cambio, se centran en manipular directamente el DOM. Son como los "andamios" o "herramientas" que permiten hacer ajustes directos en la estructura de la casa, como ajustar el color de una pared o cambiar la cerradura de una puerta. La diferencia es que los componentes son para construir, los composables para organizar la lógica y las directivas para manipular el DOM.

**Ejemplo:**

- Componente: Un `Card` que muestra info de un producto
- Composable: una función `useCounter` que gestiona un contador
- Directiva: `v-focus` que enfoca un campo al montar

```vue
// Componente Card.vue
<template>
  <div class="card">
    <h3>{{ title }}</h3>
    <p>{{ description }}</p>
  </div>
</template>
<script setup>
defineProps(["title", "description"]);
</script>

// Composable useCounter.js import { ref } from 'vue' export function
useCounter(initialValue = 0) { const count = ref(initialValue) function
increment() { count.value++ } return { count, increment} } // Directiva v-focus
en el componente
<template>
  <input v-focus />
</template>
<script setup>
const vFocus = {
  mounted: (el) => el.focus(),
};
</script>
```

**Descripción del ejemplo:** El componente `Card` es un bloque reutilizable que muestra info, el composable `useCounter` encapsula la lógica del contador, y la directiva `v-focus` hace la manipulación DOM de enfocar el input. La directiva no maneja la lógica del componente, sino que ajusta su comportamiento en el DOM.

## C - Registro de Directivas

**Definición:** Para que una directiva personalizada pueda ser usada en la plantilla, debe ser registrada, ya sea localmente (solo disponible en un componente específico) o globalmente (disponible en toda la aplicación). Es como si las herramientas estuvieran guardadas en una caja de herramientas local o en una caja de herramientas central en el taller.

**Ejemplo:**

- Registro local dentro de `<script setup>`: directiva `vHighlight`
- Registro local con opción `directives`: directiva `highlight`
- Registro global: directiva `v-focus`.

```js
// Ejemplo de registro local en
<script setup>
<script setup>
    const vHighlight = {
      mounted: (el) => {
        el.classList.add('is-highlight')
      }
    }
</script>
<template>
  <p v-highlight>Texto con highlight</p>
</template>

// Ejemplo de registro local con la opción directives
<script>
export default {
  directives: {
    highlight: {
      mounted: (el) => {
        el.classList.add("is-highlight");
      },
    },
  },
};
</script>
<template>
  <p v-highlight>Texto con highlight</p>
</template>

// Ejemplo de registro global import { createApp } from 'vue' const app =
createApp({}) app.directive('focus', { mounted: (el) => el.focus() })
```

**Descripción del ejemplo:** En el primer caso, `vHighlight` se define directamente en el script setup y su nombre es suficente para que se pueda usar con `v-highlight`. En el segundo caso, `highlight` se registra en la opción `directives` del componente, haciendo que `v-highlight` sea accesible. Finalmente, la directiva `focus` se registra globalmente con `app.directive`, de modo que `v-focus` puede usarse en cualquier componente de la aplicación.

## D - Cuándo Usar Directivas Personalizadas

**Definición:** Las directivas personalizadas se usan cuando la manipulación directa del DOM es necesaria y no puede lograrse de forma eficiente o clara con las directivas predefinidas de Vue. Es como usar herramientas especializadas para tareas específicas que no pueden realizarse con herramientas comunes. El ejemplo más común es `v-focus`, porque usar el atributo autofocus no permite el mismo control.

**Ejemplo:** Una directiva que añade un efecto de sombra a un elemento, que solo se activa después de que el elemento está en el DOM, y se le da un determinado valor.

```vue
<script setup>
const vShadow = {
  mounted(el, binding) {
    el.style.boxShadow = `5px 5px 10px ${binding.value}`;
  },
  updated(el, binding) {
    el.style.boxShadow = `5px 5px 10px ${binding.value}`;
  },
};
</script>

<template>
  <div v-shadow="'gray'">Este div tiene una sombra gris.</div>
  <div v-shadow="'blue'">Este div tiene una sombra azul.</div>
</template>
```

**Descripción del ejemplo:** La directiva `vShadow` agrega un efecto de sombra al elemento utilizando la propiedad `box-shadow` de CSS. Usamos la propiedad binding.value para definir el color de la sombra. Se define el comportamiento de `mounted` y `updated` porque si el color del binding cambia, el efecto de sombra debe actualizarse. Si no fuera necesario ese comportamiento al actualizar, podríamos usar la sintaxis abreviada.

## E - Hooks de Directivas

**Definición:** Los hooks de una directiva son funciones que se ejecutan en diferentes momentos del ciclo de vida del elemento al que está vinculada la directiva. Son como los momentos clave en un proyecto de construcción (preparación, colocación, ajuste, demolición). Cada hook nos permite hacer una acción específica.

**Ejemplo:** Una directiva con todos los hooks para ver su orden de ejecución y la información de cada hook.

```vue
<script setup>
const myDirective = {
  created(el, binding, vnode) {
    console.log("created", el, binding, vnode);
  },
  beforeMount(el, binding, vnode) {
    console.log("beforeMount", el, binding, vnode);
  },
  mounted(el, binding, vnode) {
    console.log("mounted", el, binding, vnode);
  },
  beforeUpdate(el, binding, vnode, prevVnode) {
    console.log("beforeUpdate", el, binding, vnode, prevVnode);
  },
  updated(el, binding, vnode, prevVnode) {
    console.log("updated", el, binding, vnode, prevVnode);
  },
  beforeUnmount(el, binding, vnode) {
    console.log("beforeUnmount", el, binding, vnode);
  },
  unmounted(el, binding, vnode) {
    console.log("unmounted", el, binding, vnode);
  },
};
</script>

<template>
  <p v-my-directive>Texto para ver hooks</p>
</template>
```

**Descripción del ejemplo:** La directiva `myDirective` tiene todos los hooks posibles. Al cargar y actualizar el componente, los logs en la consola mostrarán el orden en el que cada hook se ejecuta, permitiendo ver qué información está disponible en cada fase. `created` se llama antes de aplicar los atributos y listeners, `beforeMount` antes de insertar el nodo, `mounted` cuando el componente y sus hijos están montados, `beforeUpdate` antes de actualizar el componente, `updated` después de la actualización, `beforeUnmount` antes de desmontar y `unmounted` después de desmontar el componente.

## F - Argumentos de Hooks

**Definición:** Los hooks de una directiva reciben argumentos que proporcionan información sobre el elemento, el enlace de la directiva y el virtual DOM. Son como los planos, materiales e instrucciones que necesita un constructor para ejecutar su trabajo. El argumento principal es `el`, el elemento del DOM, luego tenemos `binding` (contiene el valor, el argumento, el modificador, etc) , `vnode` (el nodo virtual), y `prevVnode` (el nodo virtual anterior en la actualización).

**Ejemplo:** Una directiva que muestra en la consola el argumento, valor y modificadores que se le pasa

```vue
<script setup>
const vLogDirective = {
  mounted(el, binding) {
    console.log("Argument:", binding.arg);
    console.log("Value:", binding.value);
    console.log("Modifiers:", binding.modifiers);
  },
};
const dynamicValue = "dynamic";
</script>

<template>
  <p v-log-directive:foo.bar="dynamicValue">Text with directive</p>
</template>
```

**Descripción del ejemplo:** La directiva `vLogDirective` recibe los argumentos `el` y `binding`. Usamos `binding.arg` para mostrar el argumento `"foo"`, `binding.value` para mostrar el valor de `dynamicValue` y `binding.modifiers` para mostrar un objeto `{bar: true}`.

## G - Sintaxis Abreviada de Funciones

**Definición:** Cuando una directiva solo necesita el comportamiento de `mounted` y `updated` sin diferencias, podemos simplificar su definición como una función en lugar de un objeto con hooks. Es como tener una herramienta multifuncional que hace lo mismo en dos situaciones diferentes.

**Ejemplo:** Una directiva que cambia el color de un elemento que usa la sintaxis abreviada.

```vue
<script setup>
const vColor = (el, binding) => {
  el.style.color = binding.value;
};
</script>
<template>
  <p v-color="'red'">Texto rojo</p>
  <p v-color="'green'">Texto verde</p>
</template>
```

**Descripción del ejemplo:** La directiva `vColor` se define como una función que recibe los argumentos `el` y `binding`. La función cambia el color del elemento a `binding.value`, que puede ser `'red'` o `'green'`. Al usar la sintaxis abreviada, `vColor` se ejecuta en el montaje y en la actualización.

## H - Literales de Objeto

**Definición:** Las directivas pueden recibir un objeto literal como valor, permitiendo pasar múltiples valores y parámetros a la directiva. Es como si la directiva recibiera un "paquete de información" en lugar de un valor individual.

**Ejemplo:** Una directiva que establece la fuente, color y tamaño de un elemento, recibiendo un objeto literal.

```vue
<script setup>
const vStyleDirective = (el, binding) => {
  el.style.fontFamily = binding.value.font;
  el.style.color = binding.value.color;
  el.style.fontSize = binding.value.size;
};
</script>

<template>
  <p v-style-directive="{ font: 'Arial', color: 'blue', size: '16px' }">
    Texto con estilo
  </p>
  <p v-style-directive="{ font: 'Verdana', color: 'red', size: '20px' }">
    Otro Texto con estilo
  </p>
</template>
```

**Descripción del ejemplo:** La directiva `vStyleDirective` recibe un objeto literal con las propiedades `font`, `color` y `size`. Se le pasa un objeto como value en la directiva, y cada propiedad se utiliza para establecer los estilos del elemento.

## I - Uso en Componentes

**Definición:** No se recomienda usar directivas personalizadas directamente en componentes. Una directiva siempre se aplica al nodo raíz del componente, y si el componente tiene múltiples nodos raíz, la directiva se ignora y Vue emite una advertencia. En la práctica es como si le aplicas el color al contenedor de la casa y no a las paredes o elementos internos.

**Ejemplo:** Demostración de una directiva aplicada a un componente y el comportamiento no recomendado.

```vue
// Componente MyComponent.vue
<template>
  <div>
    <p>Soy un componente con dos nodos raíz</p>
    <span>Otro nodo</span>
  </div>
</template>

// Componente App.vue
<script setup>
import MyComponent from "./MyComponent.vue";
const vHighlight = {
  mounted(el) {
    el.classList.add("is-highlight");
  },
};
</script>
<template>
  <MyComponent v-highlight />
</template>
```

**Descripción del ejemplo:** El componente `MyComponent` tiene dos nodos raíz (un div y un span). Al aplicarle la directiva `v-highlight` al componente, la directiva se aplica al `div` y el span se ignora. Si el componente solo tuviera un único nodo raíz, la directiva se aplicaría sin problemas. Por lo que no es lo ideal y es mejor evitarlo. En su lugar, puedes usar atributos con `v-bind="$attrs"`.
