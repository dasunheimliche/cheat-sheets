## A - HTTP Basic Auth

**Definición:**  
HTTP Basic Auth es un método simple de autenticación en el que el cliente (como un navegador) envía un nombre de usuario y una contraseña en el encabezado de la solicitud HTTP. Si el servidor no recibe estas credenciales, devuelve un error HTTP 401 "No autorizado" y un encabezado `WWW-Authenticate` con el valor `Basic`. Esto hace que el navegador muestre un cuadro de diálogo para ingresar el nombre de usuario y la contraseña.

**Ejemplo:**

```python
from fastapi import FastAPI, Depends, HTTPException, status
from fastapi.security import HTTPBasic, HTTPBasicCredentials

app = FastAPI()
security = HTTPBasic()

@app.get("/users/me")
def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):
    return {"username": credentials.username, "password": credentials.password}
```

**Descripción del ejemplo:**  
Este código define una ruta `/users/me` que requiere autenticación básica. Si el usuario no proporciona credenciales, FastAPI devuelve un error 401. Si las credenciales se envían, el servidor las devuelve en la respuesta.

---

## B - Verificación de credenciales

**Definición:**  
Para verificar si el nombre de usuario y la contraseña son correctos, se utiliza el módulo `secrets` de Python. Este módulo proporciona una función llamada `compare_digest` que compara dos cadenas de manera segura, evitando ataques de tiempo (timing attacks).

**Ejemplo:**

```python
import secrets
from fastapi import Depends, FastAPI, HTTPException, status
from fastapi.security import HTTPBasic, HTTPBasicCredentials

app = FastAPI()
security = HTTPBasic()

def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):
    current_username_bytes = credentials.username.encode("utf8")
    correct_username_bytes = b"stanleyjobson"
    is_correct_username = secrets.compare_digest(current_username_bytes, correct_username_bytes)

    current_password_bytes = credentials.password.encode("utf8")
    correct_password_bytes = b"swordfish"
    is_correct_password = secrets.compare_digest(current_password_bytes, correct_password_bytes)

    if not (is_correct_username and is_correct_password):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Incorrect username or password",
            headers={"WWW-Authenticate": "Basic"},
        )
    return credentials.username

@app.get("/users/me")
def read_current_user(username: str = Depends(get_current_username)):
    return {"username": username}
```

**Descripción del ejemplo:**  
Este código verifica si el nombre de usuario es `"stanleyjobson"` y la contraseña es `"swordfish"`. Si las credenciales son incorrectas, se lanza una excepción HTTP 401. La función `secrets.compare_digest` se usa para evitar ataques de tiempo.

---

## C - Ataques de tiempo (Timing Attacks)

**Definición:**  
Un ataque de tiempo es un tipo de ataque en el que un atacante mide el tiempo que tarda el servidor en responder para adivinar información sensible, como nombres de usuario o contraseñas. Si el servidor tarda más en responder cuando una parte de la credencial es correcta, el atacante puede deducir información útil.

**Ejemplo:**

```python
if "johndoe" == "stanleyjobson" and "love123" == "swordfish":
    # Respuesta rápida si la primera letra no coincide
    pass
```

**Descripción del ejemplo:**  
En este caso, si el nombre de usuario comienza con una letra incorrecta, el servidor responde rápidamente. Sin embargo, si el nombre de usuario es similar al correcto, el servidor tarda más en responder, lo que puede ser explotado por un atacante.

---

## D - `secrets.compare_digest()`

**Definición:**  
`secrets.compare_digest()` es una función que compara dos cadenas de manera segura, asegurándose de que el tiempo de ejecución sea constante, independientemente de cuántos caracteres coincidan. Esto previene los ataques de tiempo.

**Ejemplo:**

```python
import secrets

is_correct = secrets.compare_digest("stanleyjobson", "stanleyjobsox")
```

**Descripción del ejemplo:**  
Este código compara dos cadenas de manera segura. Aunque las cadenas son similares, el tiempo de ejecución no revela información útil a un atacante.

---

## E - Devolver un error 401

**Definición:**  
Cuando las credenciales son incorrectas, se debe devolver un error HTTP 401 "No autorizado" y agregar el encabezado `WWW-Authenticate` para que el navegador vuelva a mostrar el cuadro de diálogo de inicio de sesión.

**Ejemplo:**

```python
raise HTTPException(
    status_code=status.HTTP_401_UNAUTHORIZED,
    detail="Incorrect username or password",
    headers={"WWW-Authenticate": "Basic"},
)
```

**Descripción del ejemplo:**  
Este código lanza una excepción HTTP 401 con un mensaje de error y el encabezado `WWW-Authenticate`, lo que hace que el navegador solicite nuevamente las credenciales.
