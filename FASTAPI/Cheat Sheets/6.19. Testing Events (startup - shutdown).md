## A - Eventos `startup` y `shutdown` en FastAPI

**Definición:**  
En FastAPI, los eventos `startup` y `shutdown` son funciones que se ejecutan automáticamente cuando la aplicación inicia (`startup`) o se detiene (`shutdown`). Estos eventos son útiles para realizar tareas de configuración inicial (como cargar datos o conectarse a una base de datos) o limpieza (como cerrar conexiones o liberar recursos).

Ejemplo:

```python
from fastapi import FastAPI

app = FastAPI()

items = {}

@app.on_event("startup")
async def startup_event():
    items["foo"] = {"name": "Fighters"}
    items["bar"] = {"name": "Tenders"}

@app.on_event("shutdown")
async def shutdown_event():
    print("Limpiando recursos...")
```

(Descripción del ejemplo):

- `startup_event` se ejecuta al iniciar la aplicación y llena el diccionario `items` con algunos datos.
- `shutdown_event` se ejecuta al detener la aplicación y muestra un mensaje en la consola.

---

## B - `TestClient` para pruebas en FastAPI

**Definición:**  
`TestClient` es una herramienta proporcionada por FastAPI para probar tu aplicación sin necesidad de levantar un servidor real. Simula las solicitudes HTTP y te permite verificar el comportamiento de tu aplicación, incluyendo las respuestas y el estado del código.

Ejemplo:

```python
from fastapi.testclient import TestClient

def test_read_items():
    with TestClient(app) as client:
        response = client.get("/items/foo")
        assert response.status_code == 200
        assert response.json() == {"name": "Fighters"}
```

(Descripción del ejemplo):

- `TestClient(app)` crea un cliente de prueba para la aplicación `app`.
- `client.get("/items/foo")` simula una solicitud GET a la ruta `/items/foo`.
- `assert` verifica que la respuesta tenga un código de estado 200 y que el contenido sea el esperado.

---

## C - Uso de `with` para asegurar la ejecución de eventos

**Definición:**  
Al usar `TestClient` dentro de un bloque `with`, FastAPI asegura que los eventos `startup` y `shutdown` se ejecuten correctamente durante las pruebas. Esto es especialmente útil para probar código que depende de estos eventos.

Ejemplo:

```python
def test_read_items():
    with TestClient(app) as client:
        response = client.get("/items/foo")
        assert response.status_code == 200
        assert response.json() == {"name": "Fighters"}
```

(Descripción del ejemplo):

- El bloque `with` garantiza que los eventos `startup` y `shutdown` se ejecuten antes y después de las pruebas, respectivamente.
- Esto asegura que el diccionario `items` esté inicializado correctamente antes de realizar la solicitud.

---

## D - Pruebas de rutas con datos inicializados

**Definición:**  
Cuando pruebas rutas que dependen de datos inicializados durante el evento `startup`, debes asegurarte de que esos datos estén disponibles durante la prueba. Usar `TestClient` dentro de un bloque `with` es la forma correcta de hacerlo.

Ejemplo:

```python
def test_read_items():
    with TestClient(app) as client:
        response = client.get("/items/bar")
        assert response.status_code == 200
        assert response.json() == {"name": "Tenders"}
```

(Descripción del ejemplo):

- La prueba verifica que la ruta `/items/bar` devuelva el objeto correcto (`{"name": "Tenders"}`).
- Los datos se inicializan durante el evento `startup`, por lo que están disponibles para la prueba.

---

## E - Aserciones en pruebas

**Definición:**  
Las aserciones (`assert`) son declaraciones que verifican si una condición es verdadera. Si la condición es falsa, la prueba falla. Son fundamentales para asegurar que tu código funcione como se espera.

Ejemplo:

```python
assert response.status_code == 200
assert response.json() == {"name": "Fighters"}
```

(Descripción del ejemplo):

- La primera aserción verifica que el código de estado de la respuesta sea 200 (éxito).
- La segunda aserción verifica que el contenido de la respuesta sea el objeto esperado.

---

### Resumen del Cheat Sheet

1.  **Eventos `startup` y `shutdown`:** Funciones que se ejecutan al iniciar y detener la aplicación.
2.  **`TestClient`:** Herramienta para probar FastAPI sin levantar un servidor real.
3.  **Bloque `with`:** Asegura que los eventos `startup` y `shutdown` se ejecuten durante las pruebas.
4.  **Pruebas de rutas:** Verifican que las rutas devuelvan los datos correctos.
5.  **Aserciones:** Declaraciones que verifican el comportamiento esperado del código.
