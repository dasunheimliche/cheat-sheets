## A - Cambiar el código de estado de la respuesta

**Definición:**  
En FastAPI, puedes definir un código de estado HTTP predeterminado para una respuesta. Sin embargo, en algunos casos, es necesario devolver un código de estado diferente al predeterminado. Por ejemplo, podrías querer devolver un código `200 OK` en la mayoría de los casos, pero un código `201 CREATED` cuando se crea un nuevo recurso. Para hacer esto, puedes usar un parámetro de tipo `Response` en tu función de operación de ruta.

**Ejemplo:**

```python
from fastapi import FastAPI, Response, status

app = FastAPI()
tasks = {"foo": "Listen to the Bar Fighters"}

@app.put("/get-or-create-task/{task_id}", status_code=200)
def get_or_create_task(task_id: str, response: Response):
    if task_id not in tasks:
        tasks[task_id] = "This didn't exist before"
        response.status_code = status.HTTP_201_CREATED
    return tasks[task_id]
```

**Descripción del ejemplo:**

1.  Se define una ruta PUT (`/get-or-create-task/{task_id}`) con un código de estado predeterminado `200`.
2.  Si el `task_id` no existe en el diccionario `tasks`, se crea una nueva entrada y se cambia el código de estado a `201 CREATED` usando `response.status_code`.
3.  Finalmente, se devuelve el valor asociado al `task_id`.

---

## B - Uso del parámetro `Response`

**Definición:**  
El parámetro `Response` te permite manipular aspectos de la respuesta HTTP, como el código de estado, las cabeceras y las cookies. Puedes declarar este parámetro en tu función de operación de ruta y modificarlo según sea necesario. FastAPI utilizará este objeto temporal para construir la respuesta final.

**Ejemplo:**

```python
from fastapi import FastAPI, Response, status

app = FastAPI()

@app.get("/custom-response")
def custom_response(response: Response):
    response.status_code = status.HTTP_202_ACCEPTED
    response.headers["X-Custom-Header"] = "Hello, World!"
    return {"message": "This is a custom response"}
```

**Descripción del ejemplo:**

1.  Se define una ruta GET (`/custom-response`) que utiliza un parámetro `Response`.
2.  Se cambia el código de estado a `202 ACCEPTED` y se añade una cabecera personalizada (`X-Custom-Header`).
3.  Se devuelve un diccionario que será convertido a JSON en la respuesta.

---

## C - Uso de `response_model` con `Response`

**Definición:**  
Aunque estés utilizando un parámetro `Response` para modificar el código de estado o las cabeceras, aún puedes usar `response_model` para filtrar y convertir los datos que devuelves. FastAPI aplicará el `response_model` a los datos devueltos, manteniendo los cambios realizados en el objeto `Response`.

**Ejemplo:**

```python
from fastapi import FastAPI, Response, status
from pydantic import BaseModel

app = FastAPI()

class TaskModel(BaseModel):
    task_id: str
    description: str

tasks = {"foo": "Listen to the Bar Fighters"}

@app.put("/get-or-create-task/{task_id}", response_model=TaskModel, status_code=200)
def get_or_create_task(task_id: str, response: Response):
    if task_id not in tasks:
        tasks[task_id] = "This didn't exist before"
        response.status_code = status.HTTP_201_CREATED
    return {"task_id": task_id, "description": tasks[task_id]}
```

**Descripción del ejemplo:**

1.  Se define un modelo `TaskModel` con Pydantic para validar y filtrar los datos de respuesta.
2.  La ruta PUT (`/get-or-create-task/{task_id}`) utiliza `response_model=TaskModel` para asegurarse de que los datos devueltos coincidan con el modelo.
3.  Si el `task_id` no existe, se crea una nueva entrada y se cambia el código de estado a `201 CREATED`.
4.  Los datos devueltos se validan y filtran según el `response_model`.

---

## D - Uso de `Response` en dependencias

**Definición:**  
También puedes declarar el parámetro `Response` en dependencias y modificar el código de estado o las cabeceras desde allí. Sin embargo, ten en cuenta que el último valor asignado al código de estado o a las cabeceras será el que prevalezca.

**Ejemplo:**

```python
from fastapi import FastAPI, Response, status, Depends

app = FastAPI()

def set_custom_header(response: Response):
    response.headers["X-Custom-Header"] = "Dependency Header"
    return response

@app.get("/dependency-response", dependencies=[Depends(set_custom_header)])
def dependency_response(response: Response):
    response.status_code = status.HTTP_203_NON_AUTHORITATIVE_INFORMATION
    return {"message": "This response has a custom header and status code"}
```

**Descripción del ejemplo:**

1.  Se define una dependencia `set_custom_header` que añade una cabecera personalizada.
2.  La ruta GET (`/dependency-response`) utiliza esta dependencia y también modifica el código de estado a `203 NON-AUTHORITATIVE INFORMATION`.
3.  La respuesta final incluye tanto la cabecera personalizada como el código de estado modificado.
