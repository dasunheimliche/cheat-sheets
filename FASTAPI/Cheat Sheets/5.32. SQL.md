## A - SQLModel

**Definición:** SQLModel es una biblioteca construida sobre SQLAlchemy y Pydantic, diseñada para ser la combinación perfecta para aplicaciones FastAPI que necesitan usar bases de datos SQL.

**Ejemplo:**

```python
from sqlmodel import SQLModel, Field

class Hero(SQLModel, table=True):
    id: int | None = Field(default=None, primary_key=True)
    name: str = Field(index=True)
    age: int | None = Field(default=None, index=True)
    secret_name: str
```

En este ejemplo, Hero es un modelo de base de datos que representa una tabla en la base de datos SQL.

## B - Crear un Motor (Engine)

**Definición:** Un motor SQLModel (en realidad un motor SQLAlchemy) es lo que mantiene las conexiones a la base de datos.

**Ejemplo:**

```python
from sqlmodel import create_engine

sqlite_file_name = "database.db"
sqlite_url = f"sqlite:///{sqlite_file_name}"
engine = create_engine(sqlite_url, connect_args={"check_same_thread": False})
```

En este ejemplo, se crea un motor para una base de datos SQLite.

## C - Crear las Tablas

**Definición:** La función create_all de SQLModel se utiliza para crear las tablas en la base de datos.

**Ejemplo:**

```python
def create_db_and_tables():
    SQLModel.metadata.create_all(engine)
```

En este ejemplo, create_db_and_tables crea las tablas para todos los modelos de tabla.

## D - Crear una Dependencia de Sesión

**Definición:** Una sesión es lo que almacena los objetos en memoria y realiza un seguimiento de los cambios necesarios en los datos, utilizando el motor para comunicarse con la base de datos.

**Ejemplo:**

```python
from sqlmodel import Session

def get_session():
    with Session(engine) as session:
        yield session
```

En este ejemplo, get_session proporciona una nueva sesión para cada solicitud.

## E - Crear Tablas de Base de Datos al Iniciar

**Definición:** Podemos crear las tablas de la base de datos cuando la aplicación se inicia.

**Ejemplo:**

```python
app = FastAPI()

@app.on_event("startup")
def on_startup():
    create_db_and_tables()
```

En este ejemplo, se crean las tablas en un evento de inicio de la aplicación.

## F - Crear un Héroe

**Definición:** Se puede usar un modelo SQLModel en las anotaciones de tipo para leer datos del cuerpo JSON y devolverlos en la respuesta.

**Ejemplo:**

```python
from fastapi import FastAPI, Depends

app = FastAPI()

@app.post("/heroes/")
def create_hero(hero: Hero, session: Session = Depends(get_session)):
    session.add(hero)
    session.commit()
    session.refresh(hero)
    return hero
```

En este ejemplo, se crea un nuevo héroe y se guarda en la base de datos.

## G - Leer Héroes

**Definición:** Podemos leer héroes de la base de datos utilizando select(). Podemos incluir un límite y un desplazamiento para paginar los resultados.

**Ejemplo:**

```python
from fastapi import Query

@app.get("/heroes/")
def read_heroes(session: Session = Depends(get_session), offset: int = 0, limit: int = Query(default=100, le=100)):
    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()
    return heroes
```

En este ejemplo, se leen héroes de la base de datos con paginación.

## H - Leer un Héroe

**Definición:** Podemos leer un solo héroe de la base de datos.

**Ejemplo:**

```python
@app.get("/heroes/{hero_id}")
def read_hero(hero_id: int, session: Session = Depends(get_session)):
    hero = session.get(Hero, hero_id)
    if not hero:
        raise HTTPException(status_code=404, detail="Hero not found")
    return hero
```

En este ejemplo, se lee un héroe específico de la base de datos.

## I - Eliminar un Héroe

**Definición:** Podemos eliminar un héroe de la base de datos.

**Ejemplo:**

```python
@app.delete("/heroes/{hero_id}")
def delete_hero(hero_id: int, session: Session = Depends(get_session)):
    hero = session.get(Hero, hero_id)
    if not hero:
        raise HTTPException(status_code=404, detail="Hero not found")
    session.delete(hero)
    session.commit()
    return {"ok": True}
```

En este ejemplo, se elimina un héroe de la base de datos.

## J - Crear Múltiples Modelos

**Definición:** En SQLModel, cualquier clase de modelo que tenga table=True es un modelo de tabla. Y cualquier clase de modelo que no tenga table=True es un modelo de datos.

**Ejemplo:**

```python
class HeroBase(SQLModel):
    name: str = Field(index=True)
    age: int | None = Field(default=None, index=True)

class Hero(HeroBase, table=True):
    id: int | None = Field(default=None, primary_key=True)
    secret_name: str

class HeroPublic(HeroBase):
    id: int

class HeroCreate(HeroBase):
    secret_name: str

class HeroUpdate(HeroBase):
    name: str | None = None
    age: int | None = None
    secret_name: str | None = None
```

En este ejemplo, se crean múltiples modelos para diferentes propósitos.

## K - Crear con HeroCreate y devolver un HeroPublic

**Definición:** Podemos recibir un modelo HeroCreate en la solicitud y devolver un modelo HeroPublic.

**Ejemplo:**

```python
@app.post("/heroes/", response_model=HeroPublic)
def create_hero(hero: HeroCreate, session: Session = Depends(get_session)):
    db_hero = Hero.from_orm(hero)
    session.add(db_hero)
    session.commit()
    session.refresh(db_hero)
    return db_hero
```

En este ejemplo, se crea un héroe y se devuelve como HeroPublic.

## L - Leer Héroes con HeroPublic

**Definición:** Podemos leer héroes y devolverlos como HeroPublic.

**Ejemplo:**

```python
@app.get("/heroes/", response_model=List[HeroPublic])
def read_heroes(session: Session = Depends(get_session), offset: int = 0, limit: int = Query(default=100, le=100)):
    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()
    return heroes
```

En este ejemplo, se leen héroes y se devuelven como HeroPublic.

## M - Leer un Héroe con HeroPublic

**Definición:** Podemos leer un solo héroe y devolverlo como HeroPublic.

**Ejemplo:**

```python
@app.get("/heroes/{hero_id}", response_model=HeroPublic)
def read_hero(hero_id: int, session: Session = Depends(get_session)):
    hero = session.get(Hero, hero_id)
    if not hero:
        raise HTTPException(status_code=404, detail="Hero not found")
    return hero
```

En este ejemplo, se lee un héroe específico y se devuelve como HeroPublic.

## N - Actualizar un Héroe con HeroUpdate

**Definición:** Podemos actualizar un héroe utilizando un modelo HeroUpdate.

**Ejemplo:**

```python
@app.patch("/heroes/{hero_id}", response_model=HeroPublic)
def update_hero(hero_id: int, hero: HeroUpdate, session: Session = Depends(get_session)):
    hero_db = session.get(Hero, hero_id)
    if not hero_db:
        raise HTTPException(status_code=404, detail="Hero not found")
    hero_data = hero.dict(exclude_unset=True)
    for key, value in hero_data.items():
        setattr(hero_db, key, value)
    session.add(hero_db)
    session.commit()
    session.refresh(hero_db)
    return hero_db
```

En este ejemplo, se actualiza un héroe con los datos proporcionados.
