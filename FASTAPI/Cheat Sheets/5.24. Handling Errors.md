## A - Manejo de errores en FastAPI

**Definición:**  
FastAPI permite manejar errores de manera eficiente utilizando excepciones HTTP. Estas excepciones se usan para notificar al cliente (por ejemplo, un navegador, una aplicación móvil o un dispositivo IoT) que algo salió mal durante la solicitud. Los errores comunes incluyen acceso denegado, recursos no encontrados o datos inválidos.

**Códigos de estado HTTP comunes para errores:**

- **400-499**: Errores del cliente (por ejemplo, 404 para "No encontrado").
- **500-599**: Errores del servidor (por ejemplo, 500 para "Error interno del servidor").

---

## B - Uso de `HTTPException`

**Definición:**  
`HTTPException` es una excepción especial en FastAPI que se usa para devolver respuestas HTTP con errores. En lugar de retornar un valor, se **lanza** (`raise`) esta excepción, lo que detiene la ejecución de la función y envía la respuesta de error al cliente.

Ejemplo:

```python
from fastapi import FastAPI, HTTPException

app = FastAPI()

items = {"foo": "The Foo Wrestlers"}

@app.get("/items/{item_id}")
async def read_item(item_id: str):
    if item_id not in items:
        raise HTTPException(status_code=404, detail="Item not found")
    return {"item": items[item_id]}
```

**Descripción:**

- Si el `item_id` no existe en `items`, se lanza una `HTTPException` con código de estado `404` y un mensaje de detalle.
- Si el `item_id` existe, se devuelve el item correspondiente.

---

## C - Respuesta resultante de `HTTPException`

**Definición:**  
Cuando se lanza una `HTTPException`, FastAPI devuelve una respuesta JSON con el código de estado HTTP y el mensaje de detalle proporcionado.

Ejemplo de respuesta para un error 404:

```json
{
  "detail": "Item not found"
}
```

**Nota:**  
El campo `detail` puede contener cualquier valor JSON (no solo cadenas), como diccionarios o listas.

---

## D - Agregar encabezados personalizados a `HTTPException`

**Definición:**  
Puedes agregar encabezados personalizados a una `HTTPException` para escenarios avanzados, como seguridad.

Ejemplo:

```python
raise HTTPException(
    status_code=404,
    detail="Item not found",
    headers={"X-Error": "There goes my error"},
)
```

**Descripción:**

- El encabezado personalizado `X-Error` se incluirá en la respuesta HTTP.

---

## E - Manejo de excepciones personalizadas

**Definición:**  
Puedes manejar excepciones personalizadas en FastAPI utilizando decoradores. Esto es útil para manejar errores específicos de tu aplicación o bibliotecas externas.

Ejemplo:

```python
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse

class UnicornException(Exception):
    def __init__(self, name: str):
        self.name = name

app = FastAPI()

@app.exception_handler(UnicornException)
async def unicorn_exception_handler(request: Request, exc: UnicornException):
    return JSONResponse(
        status_code=418,
        content={"message": f"Oops! {exc.name} did something. There goes a rainbow..."},
    )

@app.get("/unicorns/{name}")
async def read_unicorn(name: str):
    if name == "yolo":
        raise UnicornException(name=name)
    return {"unicorn_name": name}
```

**Descripción:**

- Si el nombre del unicornio es `"yolo"`, se lanza una `UnicornException`.
- La excepción es manejada por `unicorn_exception_handler`, que devuelve una respuesta JSON con código de estado `418`.

---

## F - Sobrescribir manejadores de excepciones predeterminados

**Definición:**  
FastAPI tiene manejadores de excepciones predeterminados para errores como `HTTPException` y `RequestValidationError`. Puedes sobrescribir estos manejadores para personalizar las respuestas de error.

Ejemplo:

```python
from fastapi import FastAPI, HTTPException, Request
from fastapi.exceptions import RequestValidationError
from fastapi.responses import PlainTextResponse

app = FastAPI()

@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request: Request, exc: RequestValidationError):
    return PlainTextResponse(str(exc), status_code=400)

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    if item_id == 3:
        raise HTTPException(status_code=418, detail="Nope! I don't like 3.")
    return {"item_id": item_id}
```

**Descripción:**

- Si el `item_id` es `3`, se lanza una `HTTPException` con código `418`.
- Los errores de validación de solicitud (por ejemplo, un `item_id` no entero) se manejan con `validation_exception_handler`, que devuelve una respuesta de texto plano.

---

## G - Usar el cuerpo de `RequestValidationError`

**Definición:**  
`RequestValidationError` contiene el cuerpo de la solicitud que causó el error. Puedes usar esta información para depurar o devolver detalles útiles al cliente.

Ejemplo:

```python
from fastapi import FastAPI, Request, status
from fastapi.exceptions import RequestValidationError
from fastapi.responses import JSONResponse

app = FastAPI()

@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request: Request, exc: RequestValidationError):
    return JSONResponse(
        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
        content={"detail": exc.errors(), "body": exc.body},
    )

@app.post("/items/")
async def create_item(item: dict):
    return item
```

**Descripción:**

- Si la solicitud contiene datos inválidos, se devuelve un JSON con los errores y el cuerpo de la solicitud.

---

## H - Reutilizar manejadores de excepciones de FastAPI

**Definición:**  
Puedes reutilizar los manejadores de excepciones predeterminados de FastAPI mientras agregas lógica personalizada.

Ejemplo:

```python
from fastapi import FastAPI, HTTPException
from fastapi.exception_handlers import http_exception_handler
from starlette.exceptions import HTTPException as StarletteHTTPException

app = FastAPI()

@app.exception_handler(StarletteHTTPException)
async def custom_http_exception_handler(request, exc):
    print(f"OMG! An HTTP error!: {repr(exc)}")
    return await http_exception_handler(request, exc)

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    if item_id == 3:
        raise HTTPException(status_code=418, detail="Nope! I don't like 3.")
    return {"item_id": item_id}
```

**Descripción:**

- El manejador personalizado imprime un mensaje y luego reutiliza el manejador predeterminado de FastAPI.
