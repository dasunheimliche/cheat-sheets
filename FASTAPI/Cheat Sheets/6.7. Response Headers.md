## A - Uso de encabezados en respuestas

**Definición:**  
FastAPI permite agregar encabezados personalizados a las respuestas HTTP. Esto se puede hacer de dos maneras:

1.  Usando un parámetro de tipo `Response` en la función de la operación de ruta.
2.  Devolviendo directamente un objeto `Response` (como `JSONResponse`) y configurando los encabezados en él.

**Ejemplo básico usando un parámetro `Response`:**

```python
from fastapi import FastAPI, Response

app = FastAPI()

@app.get("/headers-and-object/")
def get_headers(response: Response):
    response.headers["X-Cat-Dog"] = "alone in the world"
    return {"message": "Hello World"}
```

(Descripción: Aquí se declara un parámetro `response` de tipo `Response` en la función de la operación de ruta. Luego, se usa `response.headers` para agregar un encabezado personalizado. Finalmente, se devuelve un objeto JSON que será filtrado por `response_model` si está definido).

---

## B - Devolver una `Response` directamente

**Definición:**  
Otra forma de agregar encabezados es devolviendo directamente un objeto `Response` (como `JSONResponse`) y configurando los encabezados en él antes de devolverlo.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.responses import JSONResponse

app = FastAPI()

@app.get("/headers/")
def get_headers():
    content = {"message": "Hello World"}
    headers = {"X-Cat-Dog": "alone in the world", "Content-Language": "en-US"}
    return JSONResponse(content=content, headers=headers)
```

(Descripción: En este ejemplo, se crea un objeto `JSONResponse` y se configuran los encabezados usando el parámetro `headers`. Luego, se devuelve directamente este objeto `Response`).

---

## C - Detalles técnicos

**Definición:**  
FastAPI proporciona las clases `Response` y `JSONResponse` desde `fastapi.responses`, pero estas son en realidad reexportaciones de `starlette.responses`. Esto es por conveniencia para el desarrollador, pero la mayoría de las respuestas disponibles provienen directamente de Starlette.

**Ejemplo de importación desde Starlette:**

```python
from starlette.responses import Response, JSONResponse
```

(Descripción: Puedes importar `Response` y `JSONResponse` directamente desde Starlette si lo prefieres, pero FastAPI las proporciona en `fastapi.responses` para mayor comodidad).

---

## D - Encabezados personalizados

**Definición:**  
Los encabezados personalizados suelen usar el prefijo `X-` para indicar que son propietarios o específicos de la aplicación. Sin embargo, si deseas que estos encabezados sean visibles para clientes en un navegador, debes agregarlos a la configuración de CORS (Cross-Origin Resource Sharing) usando el parámetro `expose_headers`.

**Ejemplo de encabezado personalizado:**

```python
response.headers["X-Custom-Header"] = "Custom Value"
```

(Descripción: Aquí se agrega un encabezado personalizado con el prefijo `X-`).

---

## E - Configuración de CORS para encabezados personalizados

**Definición:**  
Si necesitas que los encabezados personalizados sean visibles en el navegador, debes configurar CORS para exponerlos. Esto se hace usando el parámetro `expose_headers` en la configuración de CORS.

**Ejemplo de configuración de CORS:**

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
    expose_headers=["X-Custom-Header"]  # Exponer encabezados personalizados
)
```

(Descripción: Aquí se configura CORS para exponer el encabezado personalizado `X-Custom-Header`).

---

## F - Consideraciones importantes

**Definición:**  
Si devuelves un objeto `Response` directamente, FastAPI no aplicará automáticamente el `response_model` ni realizará conversiones de datos. Por lo tanto, debes asegurarte de que los datos que devuelves sean compatibles con el tipo de respuesta (por ejemplo, JSON si usas `JSONResponse`).

**Ejemplo de error común:**

```python
@app.get("/headers/")
def get_headers():
    response = JSONResponse(content="Invalid content")  # Esto podría causar un error
    response.headers["X-Custom-Header"] = "Custom Value"
    return response
```

(Descripción: Si el contenido no es compatible con JSON, se producirá un error. Asegúrate de que los datos sean serializables).
