## A - OpenAPI Webhooks

**Definición:** Un webhook es un mecanismo donde tu API (o aplicación) envía una solicitud a la API de un usuario para notificarle sobre un evento específico. En lugar de que el usuario solicite información, tu API "empuja" la información al usuario cuando ocurre algo relevante.

**Ejemplo:**

```Python
from datetime import datetime
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Subscription(BaseModel):
    username: str
    monthly_fee: float
    start_date: datetime

@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    """
    Cuando un nuevo usuario se suscribe a tu servicio, te enviaremos una solicitud POST
    con estos datos a la URL que registres para el evento `new-subscription` en el dashboard.
    """

@app.get("/users/")
def read_users():
    return ["Rick", "Morty"]
```

(En este ejemplo, cuando un usuario se suscribe, la API enviará una solicitud POST a la URL que el usuario haya registrado para el evento new-subscription. La función new_subscription define la estructura de esta solicitud, pero no se ejecuta directamente en la API principal, sino que sirve para documentar el webhook.)

## B - Documentación de Webhooks

**Definición:** La documentación de webhooks describe cómo serán las solicitudes que tu API enviará a las APIs de tus usuarios. Esto incluye el nombre del webhook, el método HTTP (POST, PUT, etc.) y el cuerpo de la solicitud.

**Ejemplo:**

```Python
@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    """
    Cuando un nuevo usuario se suscribe a tu servicio, te enviaremos una solicitud POST
    con estos datos a la URL que registres para el evento `new-subscription` en el dashboard.
    """
```

(Aquí, @app.webhooks.post("new-subscription") define un webhook llamado new-subscription que enviará una solicitud POST. La función new_subscription define el cuerpo de la solicitud usando el modelo Subscription. Esta definición no ejecuta código, sino que documenta el webhook.)

## C - app.webhooks

**Definición:** app.webhooks es un atributo de la instancia de FastAPI que actúa como un APIRouter para definir webhooks. Permite definir las operaciones que tu API enviará a las APIs de tus usuarios.

**Ejemplo:**

```Python
@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    ...
```

(En este ejemplo, app.webhooks se utiliza para definir un webhook llamado new-subscription. Es similar a usar un APIRouter para definir rutas, pero en este caso se usa para definir webhooks.)

## D - Nombres de Webhooks

**Definición:** Los nombres de webhooks son identificadores únicos que se utilizan para referirse a un webhook específico. No son rutas, sino nombres que los usuarios utilizan para registrar las URLs donde recibirán las notificaciones.

**Ejemplo:**

```Python
@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    ...
```

(En este ejemplo, "new-subscription" es el nombre del webhook. Los usuarios registrarán una URL para este nombre en algún lugar de tu aplicación.)

## E - Diferencia entre Webhooks y Callbacks

**Definición:** La principal diferencia es la dirección de la comunicación. Los callbacks son una respuesta a una solicitud inicial a tu API, mientras que los webhooks son notificaciones proactivas enviadas por tu API a las APIs de tus usuarios.

**Ejemplo:**

Callback: Un usuario crea una factura en tu API, y tu API envía una notificación a la API del usuario después de procesar la factura.

Webhook: Un usuario se suscribe a tu servicio, y tu API envía una notificación a la API del usuario para informarle de la nueva suscripción.

(En el callback, la API del usuario es el receptor de la respuesta a una acción que inició, mientras que en el webhook, la API del usuario es el receptor de una notificación iniciada por tu API.)
