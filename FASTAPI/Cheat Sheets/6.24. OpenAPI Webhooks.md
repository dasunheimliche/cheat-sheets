## A - Webhooks

**Definición:**  
Un **webhook** es un mecanismo que permite a una aplicación (tu API) enviar una solicitud HTTP a otra aplicación (la API de tus usuarios) para notificar sobre un evento específico. A diferencia de una API tradicional, donde los usuarios envían solicitudes a tu sistema, con los webhooks es tu sistema el que envía solicitudes a los usuarios.

**Ejemplo:**

```python
from datetime import datetime
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Subscription(BaseModel):
    username: str
    monthly_fee: float
    start_date: datetime

@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    """
    Cuando un nuevo usuario se suscribe a tu servicio, enviaremos una solicitud POST con estos datos
    a la URL que registres para el evento `new-subscription` en el panel de control.
    """
```

**Descripción del ejemplo:**  
En este ejemplo, se define un webhook llamado `new-subscription`. Cuando un nuevo usuario se suscribe, tu aplicación enviará una solicitud POST con los datos de la suscripción (nombre de usuario, tarifa mensual y fecha de inicio) a la URL que el usuario haya registrado para este evento.

---

## B - Pasos de un Webhook

**Definición:**  
El proceso de un webhook implica:

1.  Definir el mensaje que se enviará (el cuerpo de la solicitud).
2.  Especificar en qué momentos se enviará la solicitud (eventos).
3.  Permitir que los usuarios registren la URL donde recibirán las solicitudes.

**Ejemplo:**

```python
@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    # Lógica para enviar la solicitud POST
    pass
```

**Descripción del ejemplo:**  
Aquí, el webhook `new-subscription` está listo para enviar una solicitud POST con los datos de la suscripción. Los usuarios deben proporcionar la URL donde recibirán esta solicitud, por ejemplo, a través de un panel de control.

---

## C - Documentación de Webhooks con FastAPI y OpenAPI

**Definición:**  
Con **FastAPI** y **OpenAPI**, puedes documentar los webhooks en tu API. Esto incluye definir el nombre del webhook, el tipo de operación HTTP (como `POST` o `PUT`) y el cuerpo de la solicitud. Esto facilita que los usuarios implementen sus APIs para recibir las solicitudes del webhook.

**Ejemplo:**

```python
@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    """
    Documentación del webhook `new-subscription`.
    """
```

**Descripción del ejemplo:**  
Este código define y documenta un webhook en FastAPI. Los usuarios pueden ver esta información en la interfaz de documentación automática de FastAPI (Swagger UI) y usarla para implementar su lado del webhook.

---

## D - Aplicación con Webhooks

**Definición:**  
En FastAPI, puedes definir webhooks usando el atributo `webhooks` de la aplicación. Esto es similar a cómo defines las operaciones de ruta (como `@app.get`), pero en lugar de rutas, defines eventos (nombres de webhooks).

**Ejemplo:**

```python
app = FastAPI()

@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    pass
```

**Descripción del ejemplo:**  
Aquí, `new-subscription` es el nombre del evento (webhook). No defines una ruta como `/items/`, porque los usuarios proporcionarán la URL donde recibirán las solicitudes.

---

## E - Verificación de la Documentación

**Definición:**  
Una vez que defines los webhooks en FastAPI, estos aparecen en la documentación automática generada por OpenAPI (Swagger UI). Los usuarios pueden ver los webhooks junto con las operaciones de ruta normales.

**Ejemplo:**

1.  Inicia la aplicación FastAPI.
2.  Ve a `http://127.0.0.1:8000/docs`.
3.  Verás los webhooks documentados junto con las rutas normales.

**Descripción del ejemplo:**  
Esto permite a los usuarios entender fácilmente cómo interactuar con los webhooks y qué datos esperar en las solicitudes.

---

## F - APIRouter y Webhooks

**Definición:**  
El objeto `app.webhooks` en FastAPI es en realidad un `APIRouter`, el mismo que se usa para estructurar aplicaciones con múltiples archivos. Esto significa que puedes organizar tus webhooks de la misma manera que organizas tus rutas.

**Ejemplo:**

```python
app = FastAPI()

@app.webhooks.post("new-subscription")
def new_subscription(body: Subscription):
    pass
```

**Descripción del ejemplo:**  
Aquí, `app.webhooks` se usa para definir un webhook, pero internamente funciona como un enrutador, lo que permite una organización flexible del código.
