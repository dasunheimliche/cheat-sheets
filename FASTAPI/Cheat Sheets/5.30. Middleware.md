## A - Middleware

**Definición:** Un middleware es una función que se ejecuta con cada solicitud antes de ser procesada por cualquier operación de ruta específica y con cada respuesta antes de ser devuelta.

**Ejemplo:**

```python
from fastapi import FastAPI, Request
import time

app = FastAPI()

@app.middleware("http")
async def add_process_time_header(request: Request, call_next):
    start_time = time.perf_counter()
    response = await call_next(request)
    process_time = time.perf_counter() - start_time
    response.headers["X-Process-Time"] = str(process_time)
    return response
```

En este ejemplo, el middleware add_process_time_header añade un encabezado X-Process-Time a cada respuesta, indicando el tiempo que tomó procesar la solicitud.

## B - Decorador @app.middleware

**Definición:** El decorador @app.middleware("http") se utiliza para declarar una función como middleware en una aplicación FastAPI.

**Ejemplo:**

```python
@app.middleware("http")
async def example_middleware(request: Request, call_next):
    # Código antes de procesar la solicitud
    response = await call_next(request)
    # Código después de procesar la solicitud
    return response
```

En este ejemplo, example_middleware es una función que se ejecuta antes y después de procesar cada solicitud.

## C - Función call_next

**Definición:** La función call_next se utiliza dentro de un middleware para pasar la solicitud a la operación de ruta correspondiente y obtener la respuesta generada.

**Ejemplo:**

```python
@app.middleware("http")
async def example_middleware(request: Request, call_next):
    response = await call_next(request)
    return response
```

En este ejemplo, call_next pasa la solicitud a la operación de ruta y devuelve la respuesta generada.

## D - Encabezados Personalizados

**Definición:** Los encabezados personalizados pueden ser añadidos a las respuestas utilizando el prefijo X-.

**Ejemplo:**

```python
response.headers["X-Custom-Header"] = "Custom Value"
```

En este ejemplo, se añade un encabezado personalizado X-Custom-Header con el valor Custom Value a la respuesta.

## E - Precisión de time.perf_counter

**Definición:** time.perf_counter se utiliza para medir el tiempo de procesamiento con mayor precisión que time.time.

**Ejemplo:**

```python
start_time = time.perf_counter()
# Código que toma tiempo
end_time = time.perf_counter()
process_time = end_time - start_time
```

En este ejemplo, time.perf_counter mide el tiempo de procesamiento de un bloque de código.
