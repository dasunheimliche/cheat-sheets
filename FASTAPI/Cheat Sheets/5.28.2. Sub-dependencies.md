## A - Dependencias

**Definición:** En FastAPI, una dependencia es cualquier "callable" (función, clase, etc.) que puede ser llamada por Python y que FastAPI puede usar para resolver parámetros en una operación de ruta.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons
```

## B - Sub-dependencias

**Definición:** Las sub-dependencias son dependencias que a su vez dependen de otras dependencias. FastAPI se encarga de resolverlas en el orden correcto.

**Ejemplo:**

```python
from typing import Annotated
from fastapi import Cookie, Depends, FastAPI

app = FastAPI()

def query_extractor(q: str | None = None):
    return q

def query_or_cookie_extractor(
    q: Annotated[str, Depends(query_extractor)],
    last_query: Annotated[str | None, Cookie()] = None,
):
    if not q:
        return last_query
    return q

@app.get("/items/")
async def read_query(query_or_default: Annotated[str, Depends(query_or_cookie_extractor)]):
    return {"q_or_cookie": query_or_default}
```

## C - Uso de la misma dependencia múltiples veces

**Definición:** Si una dependencia se declara múltiples veces para la misma operación de ruta, FastAPI la llamará solo una vez por solicitud y reutilizará el valor devuelto.

**Ejemplo:**

```python
from typing import Annotated
from fastapi import Depends, FastAPI

app = FastAPI()

async def get_value():
    return "value"

async def needy_dependency(fresh_value: Annotated[str, Depends(get_value, use_cache=False)]):
    return {"fresh_value": fresh_value}
```

## D - Recapitulación

**Definición:** El sistema de inyección de dependencias de FastAPI permite declarar dependencias anidadas de manera arbitraria, lo que simplifica el código y mejora la reutilización.

**Ejemplo:**

```python
from typing import Annotated
from fastapi import Cookie, Depends, FastAPI

app = FastAPI()

def query_extractor(q: str | None = None):
    return q

def query_or_cookie_extractor(
    q: Annotated[str, Depends(query_extractor)],
    last_query: Annotated[str | None, Cookie()] = None,
):
    if not q:
        return last_query
    return q

@app.get("/items/")
async def read_query(query_or_default: Annotated[str, Depends(query_or_cookie_extractor)]):
    return {"q_or_cookie": query_or_default}
```
