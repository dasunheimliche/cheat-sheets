## A - Sub-dependencias (Sub-dependencies)

**Definición:**  
Las sub-dependencias son dependencias que a su vez dependen de otras dependencias. En FastAPI, puedes crear una cadena de dependencias tan profunda como necesites, y FastAPI se encargará de resolverlas automáticamente.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI

app = FastAPI()

def dependency1():
    return "Dependency 1"

def dependency2(dep1: str = Depends(dependency1)):
    return f"Dependency 2 using {dep1}"

@app.get("/items/")
async def read_item(dep2: str = Depends(dependency2)):
    return {"message": dep2}
```

**Descripción del ejemplo:**

- `dependency2` depende de `dependency1`.
- Cuando se llama a la ruta `/items/`, FastAPI resuelve primero `dependency1` y luego pasa su resultado a `dependency2`.
- Finalmente, el resultado de `dependency2` se pasa a la función `read_item`.

---

## B - Dependencias anidadas (Nested dependencies)

**Definición:**  
Una dependencia puede ser tanto "dependable" (algo de lo que otros dependen) como "dependant" (algo que depende de otra dependencia). Esto permite crear estructuras complejas de dependencias.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI, Cookie

app = FastAPI()

def query_extractor(q: str | None = None):
    return q

def query_or_cookie_extractor(
    q: str = Depends(query_extractor),
    last_query: str | None = Cookie(default=None)
):
    if not q:
        return last_query
    return q

@app.get("/items/")
async def read_query(query_or_default: str = Depends(query_or_cookie_extractor)):
    return {"q_or_cookie": query_or_default}
```

**Descripción del ejemplo:**

- `query_or_cookie_extractor` depende de `query_extractor` y también de una cookie llamada `last_query`.
- Si no se proporciona el parámetro `q`, se usa el valor de la cookie `last_query`.
- FastAPI resuelve automáticamente las dependencias en el orden correcto.

---

## C - Uso de `Annotated` para dependencias

**Definición:**  
`Annotated` es una forma moderna de declarar dependencias en FastAPI. Permite combinar el tipo de dato con metadatos (como `Depends`), lo que hace el código más legible y mantenible.

**Ejemplo:**

```python
from typing import Annotated
from fastapi import Depends, FastAPI

app = FastAPI()

def dependency():
    return "Dependency"

@app.get("/items/")
async def read_item(dep: Annotated[str, Depends(dependency)]):
    return {"message": dep}
```

**Descripción del ejemplo:**

- `Annotated` se usa para combinar el tipo `str` con la dependencia `dependency`.
- Esto hace que el código sea más claro y evita confusiones con otros parámetros.

---

## D - Uso de `use_cache` en dependencias

**Definición:**  
Por defecto, FastAPI almacena en caché el resultado de una dependencia para una misma solicitud. Si necesitas que una dependencia se recalcule cada vez que se usa (incluso en la misma solicitud), puedes desactivar la caché con `use_cache=False`.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI

app = FastAPI()

def get_value():
    return "Fresh Value"

@app.get("/items/")
async def read_item(fresh_value: str = Depends(get_value, use_cache=False)):
    return {"fresh_value": fresh_value}
```

**Descripción del ejemplo:**

- `get_value` se ejecuta cada vez que se llama, incluso si se usa múltiples veces en la misma solicitud.
- Esto es útil cuando necesitas un valor "fresco" en cada llamada.

---

## E - Inyección de dependencias (Dependency Injection)

**Definición:**  
La inyección de dependencias es un patrón de diseño en el que las dependencias se "inyectan" automáticamente en las funciones que las necesitan. FastAPI maneja esto de forma automática, permitiendo crear estructuras complejas de dependencias.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI

app = FastAPI()

def common_dependency():
    return "Common Dependency"

@app.get("/items/")
async def read_item(dep: str = Depends(common_dependency)):
    return {"message": dep}
```

**Descripción del ejemplo:**

- `common_dependency` es una dependencia que se inyecta automáticamente en `read_item`.
- FastAPI se encarga de resolver y pasar la dependencia.

---

## F - Uso de cookies como dependencias

**Definición:**  
Puedes usar cookies como dependencias en FastAPI. Esto es útil cuando necesitas acceder a valores almacenados en cookies dentro de tus dependencias.

**Ejemplo:**

```python
from fastapi import Cookie, Depends, FastAPI

app = FastAPI()

@app.get("/items/")
async def read_item(last_query: str | None = Cookie(default=None)):
    return {"last_query": last_query}
```

**Descripción del ejemplo:**

- `last_query` es una cookie que se pasa automáticamente a la función `read_item`.
- Si la cookie no está presente, se usa el valor por defecto `None`.

---

## G - Recapitulación (Recap)

**Definición:**  
El sistema de inyección de dependencias de FastAPI es simple pero poderoso. Permite crear estructuras complejas de dependencias (árboles de dependencias) que se resuelven automáticamente.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI

app = FastAPI()

def dep1():
    return "Dep 1"

def dep2(d1: str = Depends(dep1)):
    return f"Dep 2 using {d1}"

@app.get("/items/")
async def read_item(d2: str = Depends(dep2)):
    return {"message": d2}
```

**Descripción del ejemplo:**

- `dep2` depende de `dep1`.
- FastAPI resuelve automáticamente las dependencias en el orden correcto (`dep1` -> `dep2` -> `read_item`).
