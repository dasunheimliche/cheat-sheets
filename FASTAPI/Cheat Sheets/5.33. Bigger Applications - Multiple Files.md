## A - Estructura de archivos en aplicaciones grandes

**Definición:**  
Cuando construyes una aplicación o API web, es común dividir el código en múltiples archivos y directorios para mantenerlo organizado. FastAPI facilita esta estructura mediante el uso de paquetes y submódulos de Python. Cada directorio con un archivo `__init__.py` se considera un paquete, y los archivos `.py` dentro de estos directorios son módulos.

Ejemplo de estructura de archivos:

```
├── app
│   ├── __init__.py
│   ├── main.py
│   ├── dependencies.py
│   └── routers
│       ├── __init__.py
│       ├── items.py
│       └── users.py
│   └── internal
│       ├── __init__.py
│       └── admin.py
```

**Descripción del ejemplo:**

- `app/` es un paquete Python porque contiene un archivo `__init__.py`.
- `app/main.py` es un módulo dentro del paquete `app`.
- `app/routers/` es un subpaquete, y `items.py` y `users.py` son submódulos dentro de él.

---

## B - `APIRouter`

**Definición:**  
`APIRouter` es una herramienta de FastAPI que permite organizar las rutas (endpoints) de tu aplicación en módulos separados. Es similar a los "Blueprints" de Flask. Puedes definir rutas, dependencias, tags y respuestas en un `APIRouter` y luego incluirlo en la aplicación principal.

Ejemplo:

```python
from fastapi import APIRouter

router = APIRouter()

@router.get("/users/", tags=["users"])
async def read_users():
    return [{"username": "Rick"}, {"username": "Morty"}]
```

**Descripción del ejemplo:**

- Se crea un `APIRouter` llamado `router`.
- Se define una ruta `/users/` que devuelve una lista de usuarios.
- El tag `"users"` se usa para agrupar esta ruta en la documentación automática.

---

## C - Dependencias

**Definición:**  
Las dependencias son funciones que se ejecutan antes de que una ruta maneje una solicitud. Pueden usarse para validar datos, autenticar usuarios, o cualquier lógica que necesites ejecutar antes de procesar la solicitud.

Ejemplo:

```python
from fastapi import Header, HTTPException

async def get_token_header(x_token: str = Header()):
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="X-Token header invalid")
```

**Descripción del ejemplo:**

- La función `get_token_header` verifica si el header `X-Token` tiene un valor específico.
- Si no coincide, lanza una excepción HTTP 400.

---

## D - Inclusión de `APIRouter` en la aplicación principal

**Definición:**  
Una vez que has definido tus `APIRouter`s, puedes incluirlos en la aplicación principal usando `app.include_router()`. Esto permite que todas las rutas definidas en el `APIRouter` sean parte de la aplicación.

Ejemplo:

```python
from fastapi import FastAPI
from .routers import users, items

app = FastAPI()

app.include_router(users.router)
app.include_router(items.router)
```

**Descripción del ejemplo:**

- Se importan los `APIRouter`s `users` y `items`.
- Se incluyen en la aplicación principal usando `app.include_router()`.

---

## E - Prefijos, tags y dependencias en `APIRouter`

**Definición:**  
Puedes configurar un `APIRouter` con un prefijo, tags y dependencias que se aplicarán a todas las rutas dentro de él. Esto evita la repetición de código.

Ejemplo:

```python
router = APIRouter(
    prefix="/items",
    tags=["items"],
    dependencies=[Depends(get_token_header)],
    responses={404: {"description": "Not found"}},
)
```

**Descripción del ejemplo:**

- Todas las rutas en este `APIRouter` comenzarán con `/items`.
- Se aplica el tag `"items"` a todas las rutas.
- La dependencia `get_token_header` se ejecutará antes de cada ruta.
- Se define una respuesta predeterminada para el código 404.

---

## F - Importaciones relativas

**Definición:**  
Las importaciones relativas permiten importar módulos dentro de un paquete usando `.` para referirse al directorio actual y `..` para referirse al directorio padre.

Ejemplo:

```python
from ..dependencies import get_token_header
```

**Descripción del ejemplo:**

- `..dependencies` significa "sube un nivel en la estructura de directorios y busca el módulo `dependencies`".
- Esto es útil para importar funciones o variables desde módulos en directorios superiores.

---

## G - Inclusión de `APIRouter` con parámetros personalizados

**Definición:**  
Puedes incluir un `APIRouter` en la aplicación principal y personalizar su prefijo, tags, dependencias y respuestas sin modificar el `APIRouter` original.

Ejemplo:

```python
app.include_router(
    admin.router,
    prefix="/admin",
    tags=["admin"],
    dependencies=[Depends(get_token_header)],
    responses={418: {"description": "I'm a teapot"}},
)
```

**Descripción del ejemplo:**

- El `APIRouter` `admin.router` se incluye con un prefijo `/admin`.
- Se aplica el tag `"admin"` y la dependencia `get_token_header`.
- Se define una respuesta personalizada para el código 418.

---

## H - Documentación automática

**Definición:**  
FastAPI genera automáticamente documentación interactiva para tu API basada en las rutas, tags, dependencias y respuestas que defines. Puedes acceder a ella en `/docs` o `/redoc`.

Ejemplo:

```bash
uvicorn app.main:app --reload
```

**Descripción del ejemplo:**

- Al ejecutar la aplicación con Uvicorn, la documentación estará disponible en `http://127.0.0.1:8000/docs`.
- Aquí puedes ver y probar todas las rutas definidas en tu aplicación.
