## A - Middleware en FastAPI

**Definición:**  
FastAPI permite agregar middlewares ASGI (Interfaz de Servidor de Puerta de Enlace Asíncrona) para manejar solicitudes y respuestas. Los middlewares son clases que reciben una aplicación ASGI como primer argumento y pueden modificar las solicitudes o respuestas. FastAPI proporciona una forma sencilla de agregar middlewares usando `app.add_middleware()`.

**Ejemplo:**

```python
from fastapi import FastAPI
from some_library import SomeMiddleware

app = FastAPI()
app.add_middleware(SomeMiddleware, config="value")
```

**Descripción del ejemplo:**  
Este código agrega un middleware personalizado (`SomeMiddleware`) a la aplicación FastAPI. El middleware recibe un argumento adicional (`config="value"`).

---

## B - `HTTPSRedirectMiddleware`

**Definición:**  
Este middleware redirige todas las solicitudes HTTP a HTTPS y las solicitudes WS (WebSocket no seguro) a WSS (WebSocket seguro). Es útil para garantizar que todas las conexiones sean seguras.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.middleware.httpsredirect import HTTPSRedirectMiddleware

app = FastAPI()
app.add_middleware(HTTPSRedirectMiddleware)

@app.get("/")
async def main():
    return {"message": "Hello World"}
```

**Descripción del ejemplo:**  
Este código fuerza a todas las solicitudes a usar HTTPS. Si un cliente intenta acceder a la aplicación usando HTTP, será redirigido automáticamente a HTTPS.

---

## C - `TrustedHostMiddleware`

**Definición:**  
Este middleware asegura que todas las solicitudes tengan un encabezado `Host` válido, protegiendo contra ataques de suplantación de host. Puedes especificar una lista de hosts permitidos, incluyendo dominios con comodines como `*.example.com`.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.middleware.trustedhost import TrustedHostMiddleware

app = FastAPI()
app.add_middleware(TrustedHostMiddleware, allowed_hosts=["example.com", "*.example.com"])

@app.get("/")
async def main():
    return {"message": "Hello World"}
```

**Descripción del ejemplo:**  
Este código solo permite solicitudes con el encabezado `Host` que coincida con `example.com` o cualquier subdominio de `example.com`. Si el host no es válido, se devuelve un error 400.

---

## D - `GZipMiddleware`

**Definición:**  
Este middleware comprime las respuestas usando GZip si el cliente admite la compresión (especificado en el encabezado `Accept-Encoding`). Puedes configurar el tamaño mínimo para comprimir y el nivel de compresión.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.middleware.gzip import GZipMiddleware

app = FastAPI()
app.add_middleware(GZipMiddleware, minimum_size=1000, compresslevel=5)

@app.get("/")
async def main():
    return "somebigcontent"
```

**Descripción del ejemplo:**  
Este código comprime las respuestas mayores a 1000 bytes con un nivel de compresión de 5. Esto reduce el tamaño de las respuestas, mejorando el rendimiento.

---

## E - Otros middlewares ASGI

**Definición:**  
Existen muchos middlewares ASGI disponibles, como `ProxyHeadersMiddleware` de Uvicorn para manejar encabezados de proxy, o `MessagePack` para serializar datos en formato MessagePack. Puedes explorar más middlewares en la [documentación de Starlette](https://www.starlette.io/middleware/) y en la [lista ASGI Awesome List](https://github.com/florimondmanca/awesome-asgi).

**Ejemplo:**

```python
from fastapi import FastAPI
from uvicorn.middleware.proxy_headers import ProxyHeadersMiddleware

app = FastAPI()
app.add_middleware(ProxyHeadersMiddleware, trusted_hosts="*")
```

**Descripción del ejemplo:**  
Este código agrega `ProxyHeadersMiddleware` para manejar encabezados de proxy, como `X-Forwarded-For`, útil cuando la aplicación está detrás de un proxy inverso.

---

## F - Middlewares integrados en FastAPI

**Definición:**  
FastAPI incluye varios middlewares comunes, como `HTTPSRedirectMiddleware`, `TrustedHostMiddleware` y `GZipMiddleware`. Estos middlewares están disponibles directamente en `fastapi.middleware` por conveniencia, aunque la mayoría provienen de Starlette.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.middleware import HTTPSRedirectMiddleware, TrustedHostMiddleware, GZipMiddleware

app = FastAPI()
app.add_middleware(HTTPSRedirectMiddleware)
app.add_middleware(TrustedHostMiddleware, allowed_hosts=["example.com"])
app.add_middleware(GZipMiddleware, minimum_size=500)
```

**Descripción del ejemplo:**  
Este código agrega tres middlewares integrados: redirección HTTPS, validación de hosts y compresión GZip.
