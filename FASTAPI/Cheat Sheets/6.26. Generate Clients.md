## A - Generación de Clientes API

**Definición:** El proceso de crear automáticamente código cliente (SDKs) para una API, utilizando la especificación OpenAPI. Esto permite a los desarrolladores interactuar con la API de manera más sencilla y con menos errores.

**Ejemplo:**

```Python
# FastAPI app
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    price: float

class ResponseMessage(BaseModel):
    message: str

@app.post("/items/", response_model=ResponseMessage)
async def create_item(item: Item):
    return {"message": "item received"}

@app.get("/items/", response_model=list[Item])
async def get_items():
    return [
        {"name": "Plumbus", "price": 3},
        {"name": "Portal Gun", "price": 9001},
    ]
```

(Este código define una API FastAPI. A partir de esta definición, se puede generar un cliente en TypeScript, por ejemplo, que permita interactuar con esta API de forma tipada y con autocompletado.)

## B - Herramientas de Generación de Clientes OpenAPI

**Definición:** Software que toma una especificación OpenAPI como entrada y genera código cliente en diferentes lenguajes de programación. Ejemplos incluyen OpenAPI Generator y openapi-ts.

**Ejemplo:**

OpenAPI Generator: Una herramienta versátil que genera clientes en muchos lenguajes.

openapi-ts: Una herramienta específica para generar clientes en TypeScript, ideal para aplicaciones frontend.

(Estas herramientas automatizan la creación de clientes, ahorrando tiempo y reduciendo errores.)

## C - openapi-ts

**Definición:** Una herramienta de línea de comandos para generar clientes TypeScript a partir de una especificación OpenAPI. Es especialmente útil para aplicaciones frontend que consumen APIs FastAPI.

**Ejemplo:**

```Json
{
  "scripts": {
    "generate-client": "openapi-ts --input http://localhost:8000/openapi.json --output ./src/client --client axios"
  },
  "devDependencies": {
    "@hey-api/openapi-ts": "^0.27.38",
    "typescript": "^4.6.2"
  }
}
```

(Este fragmento de package.json muestra cómo configurar openapi-ts para generar un cliente TypeScript usando axios como cliente HTTP.)

## D - Autocompletado y Validación de Tipos

**Definición:** Los clientes generados a partir de OpenAPI ofrecen autocompletado y validación de tipos, lo que facilita el desarrollo y reduce errores.

**Ejemplo:**

```TypeScript
// Código generado por openapi-ts
import { ItemsService } from './src/client';

const itemsService = new ItemsService();

// Autocompletado para el método y el payload
itemsService.createItem({ name: "Plumbus", price: 5 });

// Validación de tipos
itemsService.createItem({ name: "Plumbus", price: "not a number" }); // Error
```

(El cliente generado ofrece autocompletado para los métodos y los campos de los payloads, y también valida los tipos de datos, lo que ayuda a prevenir errores.)

## E - Tags en FastAPI

**Definición:** Los tags en FastAPI se utilizan para agrupar operaciones de ruta relacionadas. Esto facilita la organización de la API y también se refleja en la estructura del cliente generado.

**Ejemplo:**

```Python
@app.post("/items/", response_model=ResponseMessage, tags=["items"])
async def create_item(item: Item):
    ...

@app.post("/users/", response_model=ResponseMessage, tags=["users"])
async def create_user(user: User):
    ...
```

(En este ejemplo, las operaciones /items/ están etiquetadas con items y las operaciones /users/ con users. Esto se reflejará en el cliente generado, que tendrá un ItemsService y un UsersService.)

## F - Nombres de Métodos en Clientes Generados

**Definición:** Los nombres de los métodos en los clientes generados se basan en los operation IDs de OpenAPI. Por defecto, estos IDs pueden ser largos y poco descriptivos, pero se pueden personalizar.

**Ejemplo:**

Por defecto: ItemsService.createItemItemsPost

Personalizado: ItemsService.createItem

(Personalizar los operation IDs permite generar nombres de métodos más limpios y fáciles de usar.)

## G - Personalización de generate_unique_id_function

**Definición:** Una función que se puede pasar a FastAPI para personalizar la forma en que se generan los operation IDs. Esto permite controlar los nombres de los métodos en los clientes generados.

**Ejemplo:**

```Python
from fastapi import FastAPI
from fastapi.routing import APIRoute

def custom_generate_unique_id(route: APIRoute):
    return f"{route.tags[0]}-{route.name}"

app = FastAPI(generate_unique_id_function=custom_generate_unique_id)
```

(Esta función personalizada genera operation IDs basados en el tag y el nombre de la función, lo que resulta en nombres de métodos más limpios.)

## H - Preprocesamiento de la Especificación OpenAPI

**Definición:** La modificación de la especificación OpenAPI antes de generar el cliente. Esto permite eliminar información redundante y generar nombres de métodos aún más limpios.

**Ejemplo:**

```Python
# Script para eliminar el prefijo del tag de los operation IDs
import json
from pathlib import Path

file_path = Path("./openapi.json")
openapi_content = json.loads(file_path.read_text())

for path_data in openapi_content["paths"].values():
    for operation in path_data.values():
        tag = operation["tags"][0]
        operation_id = operation["operationId"]
        to_remove = f"{tag}-"
        new_operation_id = operation_id[len(to_remove) :]
        operation["operationId"] = new_operation_id

file_path.write_text(json.dumps(openapi_content))
```

(Este script elimina el prefijo del tag de los operation IDs, lo que resulta en nombres de métodos más limpios como get_items en lugar de items-get_items.)
