## A - Uso de cookies en respuestas

**Definición:**  
FastAPI permite agregar cookies a las respuestas HTTP. Esto se puede hacer de dos maneras:

1.  Usando un parámetro de tipo `Response` en la función de la operación de ruta.
2.  Devolviendo directamente un objeto `Response` (como `JSONResponse`) y configurando las cookies en él.

**Ejemplo básico usando un parámetro `Response`:**

```python
from fastapi import FastAPI, Response

app = FastAPI()

@app.post("/cookie-and-object/")
def create_cookie(response: Response):
    response.set_cookie(key="fakesession", value="fake-cookie-session-value")
    return {"message": "Come to the dark side, we have cookies"}
```

(Descripción: Aquí se declara un parámetro `response` de tipo `Response` en la función de la operación de ruta. Luego, se usa `response.set_cookie()` para agregar una cookie a la respuesta. Finalmente, se devuelve un objeto JSON que será filtrado por `response_model` si está definido).

---

## B - Devolver una `Response` directamente

**Definición:**  
Otra forma de agregar cookies es devolviendo directamente un objeto `Response` (como `JSONResponse`) y configurando las cookies en él antes de devolverlo.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.responses import JSONResponse

app = FastAPI()

@app.post("/cookie/")
def create_cookie():
    content = {"message": "Come to the dark side, we have cookies"}
    response = JSONResponse(content=content)
    response.set_cookie(key="fakesession", value="fake-cookie-session-value")
    return response
```

(Descripción: En este ejemplo, se crea un objeto `JSONResponse` y se configura una cookie usando `response.set_cookie()`. Luego, se devuelve directamente este objeto `Response`).

---

## C - Detalles técnicos

**Definición:**  
FastAPI proporciona las clases `Response` y `JSONResponse` desde `fastapi.responses`, pero estas son en realidad reexportaciones de `starlette.responses`. Esto es por conveniencia para el desarrollador, pero la mayoría de las respuestas disponibles provienen directamente de Starlette.

**Ejemplo de importación desde Starlette:**

```python
from starlette.responses import Response, JSONResponse
```

(Descripción: Puedes importar `Response` y `JSONResponse` directamente desde Starlette si lo prefieres, pero FastAPI las proporciona en `fastapi.responses` para mayor comodidad).

---

## D - Parámetros y opciones de `set_cookie`

**Definición:**  
El método `set_cookie()` permite configurar varias opciones para las cookies, como:

- `key`: Nombre de la cookie.
- `value`: Valor de la cookie.
- `max_age`: Tiempo de vida de la cookie en segundos.
- `expires`: Fecha de expiración de la cookie.
- `path`: Ruta en la que la cookie es válida.
- `domain`: Dominio en el que la cookie es válida.
- `secure`: Indica si la cookie solo debe enviarse sobre HTTPS.
- `httponly`: Indica si la cookie debe ser accesible solo a través de HTTP (no desde JavaScript).

**Ejemplo con opciones adicionales:**

```python
response.set_cookie(
    key="fakesession",
    value="fake-cookie-session-value",
    max_age=3600,  # 1 hora
    path="/",      # Válida en todo el sitio
    secure=True,   # Solo se envía sobre HTTPS
    httponly=True  # No accesible desde JavaScript
)
```

(Descripción: Aquí se configura una cookie con varias opciones, como tiempo de vida, ruta, seguridad y accesibilidad).

---

## E - Consideraciones importantes

**Definición:**  
Si devuelves un objeto `Response` directamente, FastAPI no aplicará automáticamente el `response_model` ni realizará conversiones de datos. Por lo tanto, debes asegurarte de que los datos que devuelves sean compatibles con el tipo de respuesta (por ejemplo, JSON si usas `JSONResponse`).

**Ejemplo de error común:**

```python
@app.post("/cookie/")
def create_cookie():
    response = JSONResponse(content="Invalid content")  # Esto podría causar un error
    response.set_cookie(key="fakesession", value="fake-cookie-session-value")
    return response
```

(Descripción: Si el contenido no es compatible con JSON, se producirá un error. Asegúrate de que los datos sean serializables).
