## A - Sobreescritura de Dependencias (Dependency Overrides)

**Definición:** La capacidad de reemplazar una dependencia original por una dependencia alternativa (override) durante las pruebas. Esto permite simular comportamientos, evitar llamadas a servicios externos, o simplificar pruebas.

**Ejemplo:** Se cambia la dependencia de autenticación por una función que siempre retorna un usuario mockeado.

(Se pueden sobreescribir las dependencias para que se utilicen solo en pruebas.)

## B - app.dependency_overrides

**Definición:** Un diccionario en la instancia de la aplicación FastAPI que permite especificar las dependencias a sobreescribir durante las pruebas. La clave es la dependencia original (la función), y el valor es la dependencia alternativa (la función override).

**Ejemplo:**

```Python
from fastapi import Depends, FastAPI
from fastapi.testclient import TestClient

app = FastAPI()

async def original_dependency():
    # ... llamada a un servicio externo
    return {"value": "original"}

@app.get("/items")
async def read_items(data: dict = Depends(original_dependency)):
  return data

async def override_dependency():
  return {"value":"override"}


app.dependency_overrides[original_dependency] = override_dependency
```

(El diccionario dependency_overrides almacena la dependencia original como clave y la de override como valor.)

## C - Dependencia Original (Original Dependency)

**Definición:** La función que define la dependencia original que se va a sobreescribir durante las pruebas. Esta es la función que usualmente se utiliza en la aplicación.

**Ejemplo:**

(Ver original_dependency del punto B, que se llama desde el endpoint y llama a un servicio externo).

## D - Dependencia de Sobreescritura (Override Dependency)

**Definición:** La función que se utiliza para reemplazar la dependencia original durante las pruebas. Esta función retorna un valor alternativo al de la original.

**Ejemplo:**

(Ver override_dependency del punto B, que retorna un valor mockeado.)

## E - Uso de Overrides en Pruebas

**Definición:** Al realizar una prueba utilizando un TestClient, se utilizara el override en vez de la función original.

**Ejemplo:**

```Python
from fastapi import Depends, FastAPI
from fastapi.testclient import TestClient

app = FastAPI()

async def original_dependency():
    # ... llamada a un servicio externo
    return {"value": "original"}

@app.get("/items")
async def read_items(data: dict = Depends(original_dependency)):
  return data

async def override_dependency():
  return {"value":"override"}


app.dependency_overrides[original_dependency] = override_dependency

client = TestClient(app)

def test_items():
  response = client.get("/items")
  assert response.json() == {"value": "override"}
```

(Al testear la ruta /items, se usara la función override_dependency, obteniendo un resultado diferente)

## F - Resetear Overrides

**Definición:** Para eliminar las dependencias override, se debe establecer app.dependency_overrides como un diccionario vacío: app.dependency_overrides = {}.

**Ejemplo:**

```Python
app.dependency_overrides = {}
```

(Después de ejecutar esta linea de código la app ya no utilizará las dependencias override definidas anteriormente)

## G - Overrides por Test

**Definición:** Se puede usar el concepto de dependency_overrides para resetear, sobreescribir, o simplemente, manejar los overrides de dependencias en cada test. Lo cual permite un control mas preciso en las pruebas.

**Ejemplo:**

```Python
from fastapi import Depends, FastAPI
from fastapi.testclient import TestClient

app = FastAPI()

async def original_dependency():
    # ... llamada a un servicio externo
    return {"value": "original"}

@app.get("/items")
async def read_items(data: dict = Depends(original_dependency)):
  return data

async def override_dependency_test1():
  return {"value":"override test1"}

async def override_dependency_test2():
  return {"value":"override test2"}

client = TestClient(app)

def test_items_1():
  app.dependency_overrides[original_dependency] = override_dependency_test1
  response = client.get("/items")
  assert response.json() == {"value": "override test1"}

def test_items_2():
  app.dependency_overrides[original_dependency] = override_dependency_test2
  response = client.get("/items")
  assert response.json() == {"value": "override test2"}
```

(En este caso cada test define su propio override)
