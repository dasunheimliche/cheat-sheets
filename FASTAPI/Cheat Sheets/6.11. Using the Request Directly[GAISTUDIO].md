## A - Declaración de Parámetros de Solicitud

**Definición:** Declarar datos de la solicitud (parámetros de ruta, encabezados, cookies, etc.) como parámetros de función en FastAPI. Esto habilita la validación automática, la conversión al tipo especificado y la generación de documentación.

**Ejemplo:**

```Python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
def leer_item(item_id: int, q: str = None):
    return {"item_id": item_id, "query": q}
```

(En este ejemplo, item_id es un parámetro de ruta que se validará como un entero, y q es un parámetro de consulta opcional. FastAPI maneja la extracción, validación y documentación.)

## B - Acceso Directo al Objeto Request

**Definición:** Acceder directamente al objeto Request subyacente de Starlette dentro de una función de operación de ruta de FastAPI. Esto permite un acceso de bajo nivel a los detalles de la solicitud.

**Ejemplo:**

```Python
from fastapi import FastAPI, Request

app = FastAPI()

@app.get("/items/{item_id}")
def leer_item(item_id: str, request: Request):
    client_host = request.client.host
    return {"client_host": client_host, "item_id": item_id}
```

(Aquí, request: Request permite el acceso al objeto Request. Luego podemos acceder a la dirección IP del cliente usando request.client.host. Ten en cuenta que item_id todavía es validado y documentado por FastAPI.)

## C - Base en Starlette

**Definición:** FastAPI está construido sobre Starlette, un framework ASGI ligero. Esto significa que FastAPI hereda las características de Starlette, incluyendo el objeto Request.

**Ejemplo:**

```Python
# FastAPI usa el objeto Request de Starlette

from starlette.requests import Request as StarletteRequest
from fastapi import FastAPI, Request

app = FastAPI()

@app.get("/test")
def test_request(request: Request):
    print(type(request)) # Salida: <class 'starlette.requests.Request'>
    return {"message": "Tipo de objeto Request impreso"}
```

(Este ejemplo muestra que el objeto Request usado en FastAPI es el mismo que el de Starlette.)

## D - Omisión de Validación y Documentación

**Definición:** Cuando accedes a datos directamente desde el objeto Request, la validación, conversión y documentación automáticas de FastAPI (para OpenAPI) se omiten para esos datos específicos.

**Ejemplo:**

```Python
from fastapi import FastAPI, Request

app = FastAPI()

@app.post("/items")
def crear_item(request: Request):
    body = request.body() # No hay validación ni documentación para el cuerpo
    return {"body": body}
```

(En este ejemplo, el cuerpo de la solicitud se lee directamente usando request.body(). FastAPI no valida ni documenta estos datos. Si deseas validación, debes usar un modelo Pydantic como parámetro.)

## E - Validación Selectiva

**Definición:** Puedes combinar el acceso directo a Request con declaraciones de parámetros estándar. Esto te permite validar y documentar selectivamente algunas partes de la solicitud mientras accedes a otras partes directamente.

**Ejemplo:**

```Python
from fastapi import FastAPI, Request
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    price: float

@app.post("/items")
def crear_item(item: Item, request: Request):
    client_host = request.client.host
    return {"item": item, "client_host": client_host}
```

(Aquí, el item se valida y documenta usando el modelo Pydantic Item, mientras que la dirección IP del cliente se accede directamente desde el objeto Request.)

## F - Caso de Uso: IP del Cliente

**Definición:** Un caso de uso común para el acceso directo a Request es obtener la dirección IP del cliente u otra información relacionada con el cliente.

**Ejemplo:**

```Python
from fastapi import FastAPI, Request

app = FastAPI()

@app.get("/ip")
def obtener_ip_cliente(request: Request):
    client_ip = request.client.host
    return {"client_ip": client_ip}
```

(Este ejemplo demuestra cómo obtener la dirección IP del cliente usando request.client.host.)

## G - Importación por Conveniencia

**Definición:** FastAPI proporciona el objeto Request directamente desde fastapi para conveniencia, pero es el mismo objeto Request de Starlette.

**Ejemplo:**

```Python
from fastapi import FastAPI, Request
# Equivalente a: from starlette.requests import Request

app = FastAPI()

@app.get("/test")
def test_request(request: Request):
    return {"message": "Objeto Request accedido"}
```

(Esto muestra que puedes importar Request directamente desde fastapi en lugar de starlette.requests.)
