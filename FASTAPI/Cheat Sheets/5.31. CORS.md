## A - CORS (Cross-Origin Resource Sharing)

**Definición:**  
CORS es un mecanismo que permite a un frontend (que se ejecuta en un navegador) comunicarse con un backend que está en un **origen diferente**. Un "origen" es la combinación de protocolo (`http`, `https`), dominio (`localhost`, `miweb.com`) y puerto (`80`, `8080`, etc.). Sin CORS, los navegadores bloquean estas solicitudes por razones de seguridad.

**Ejemplo:**

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

origins = [
    "http://localhost",
    "http://localhost:8080",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,  # Lista de orígenes permitidos
    allow_credentials=True,  # Permite cookies y credenciales
    allow_methods=["*"],  # Permite todos los métodos HTTP
    allow_headers=["*"],  # Permite todos los encabezados
)

@app.get("/")
async def main():
    return {"message": "Hello World"}
```

**Descripción del ejemplo:**  
Este código configura CORS para permitir solicitudes desde `http://localhost` y `http://localhost:8080`. También permite el uso de credenciales (como cookies) y todos los métodos y encabezados HTTP.

---

## B - Origen (Origin)

**Definición:**  
Un "origen" es la combinación de protocolo, dominio y puerto. Dos URLs con diferentes protocolos, dominios o puertos se consideran orígenes diferentes, incluso si apuntan al mismo servidor.

**Ejemplos de orígenes diferentes:**

- `http://localhost`
- `https://localhost`
- `http://localhost:8080`

**Descripción:**  
Aunque todas estas URLs apuntan a `localhost`, son orígenes diferentes porque usan diferentes protocolos (`http` vs `https`) o puertos (`80` vs `8080`).

---

## C - Solicitudes CORS

**Definición:**  
Cuando un frontend intenta comunicarse con un backend de un origen diferente, el navegador envía una solicitud `OPTIONS` (preflight) para verificar si el backend permite la comunicación. Si el backend responde con los encabezados CORS adecuados, el navegador permite la solicitud.

**Ejemplo de flujo:**

1.  Frontend en `http://localhost:8080` intenta comunicarse con el backend en `http://localhost`.
2.  El navegador envía una solicitud `OPTIONS` al backend.
3.  El backend responde con encabezados CORS que permiten el origen `http://localhost:8080`.
4.  El navegador permite la solicitud.

---

## D - Wildcards (Comodines)

**Definición:**  
Puedes usar `"*"` como comodín para permitir todos los orígenes, métodos o encabezados. Sin embargo, esto no permite el uso de credenciales (como cookies o tokens de autorización). Para permitir credenciales, debes especificar los orígenes permitidos explícitamente.

**Ejemplo con comodín:**

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Permite todos los orígenes
    allow_methods=["*"],  # Permite todos los métodos HTTP
    allow_headers=["*"],  # Permite todos los encabezados
)
```

**Descripción del ejemplo:**  
Este middleware permite solicitudes desde cualquier origen, pero no permite el uso de credenciales.

---

## E - Configuración del CORSMiddleware

**Definición:**  
El `CORSMiddleware` en FastAPI permite configurar:

- **`allow_origins`**: Lista de orígenes permitidos (ej: `["http://localhost:8080"]`).
- **`allow_methods`**: Lista de métodos HTTP permitidos (ej: `["GET", "POST"]`).
- **`allow_headers`**: Lista de encabezados permitidos (ej: `["Authorization"]`).
- **`allow_credentials`**: Permite el uso de cookies y credenciales (debe ser `True` o `False`).
- **`expose_headers`**: Encabezados que el navegador puede acceder en la respuesta.
- **`max_age`**: Tiempo máximo (en segundos) que el navegador puede cachear la respuesta CORS.

**Ejemplo completo:**

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:8080"],  # Orígenes permitidos
    allow_methods=["GET", "POST"],  # Métodos HTTP permitidos
    allow_headers=["Authorization"],  # Encabezados permitidos
    allow_credentials=True,  # Permite credenciales
    expose_headers=["X-Custom-Header"],  # Encabezados expuestos
    max_age=600,  # Cachear respuestas CORS por 600 segundos
)
```

**Descripción del ejemplo:**  
Este middleware permite solicitudes desde `http://localhost:8080`, solo con los métodos `GET` y `POST`, y permite el encabezado `Authorization`. También permite credenciales y expone un encabezado personalizado (`X-Custom-Header`).

---

## F - Solicitudes Preflight y Simples

**Definición:**

- **Solicitudes Preflight**: Son solicitudes `OPTIONS` que el navegador envía para verificar si el backend permite la comunicación CORS. El middleware responde con los encabezados CORS adecuados.
- **Solicitudes Simples**: Son solicitudes con un encabezado `Origin`. El middleware las procesa normalmente y agrega los encabezados CORS a la respuesta.

**Ejemplo de solicitud Preflight:**

```
OPTIONS / HTTP/1.1
Origin: http://localhost:8080
Access-Control-Request-Method: POST
```

**Respuesta del middleware:**

```
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://localhost:8080
Access-Control-Allow-Methods: POST
```

---

## G - Consideraciones Técnicas

**Definición:**

- El `CORSMiddleware` en FastAPI proviene de Starlette, pero FastAPI lo proporciona por conveniencia.
- Para permitir credenciales, no puedes usar `allow_origins=["*"]`. Debes especificar los orígenes permitidos explícitamente.

**Ejemplo de importación desde Starlette:**

```python
from starlette.middleware.cors import CORSMiddleware
```

**Descripción:**  
Aunque FastAPI proporciona el middleware, es útil saber que viene de Starlette.
