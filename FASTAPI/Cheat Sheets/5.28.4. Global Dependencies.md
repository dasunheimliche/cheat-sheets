## A - Dependencias globales (Global Dependencies)

**Definición:**  
Las dependencias globales son dependencias que se aplican a todas las operaciones de ruta (endpoints) de una aplicación FastAPI. Estas dependencias se ejecutan antes de cualquier operación de ruta, sin necesidad de declararlas individualmente en cada endpoint.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI, Header, HTTPException

app = FastAPI(dependencies=[Depends(verify_token), Depends(verify_key)])

async def verify_token(x_token: str = Header()):
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="X-Token header invalid")

async def verify_key(x_key: str = Header()):
    if x_key != "fake-super-secret-key":
        raise HTTPException(status_code=400, detail="X-Key header invalid")
    return x_key

@app.get("/items/")
async def read_items():
    return [{"item": "Portal Gun"}, {"item": "Plumbus"}]

@app.get("/users/")
async def read_users():
    return [{"username": "Rick"}, {"username": "Morty"}]
```

**Descripción del ejemplo:**

- `verify_token` y `verify_key` son dependencias globales que se aplican a todas las rutas de la aplicación.
- Si alguna de estas dependencias falla (por ejemplo, si el token no es válido), se lanza una excepción y la operación de ruta no se ejecuta.
- Estas dependencias se ejecutan antes de `read_items` y `read_users`.

---

## B - Dependencias para grupos de operaciones de ruta

**Definición:**  
Puedes declarar dependencias que se apliquen a un grupo específico de operaciones de ruta. Esto es útil cuando tienes múltiples rutas que comparten las mismas dependencias, pero no deseas aplicarlas a toda la aplicación.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI, HTTPException, Header, APIRouter

app = FastAPI()
router = APIRouter(dependencies=[Depends(verify_token)])

async def verify_token(x_token: str = Header()):
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="Invalid token")

@router.get("/items/")
async def read_items():
    return [{"item": "Portal Gun"}, {"item": "Plumbus"}]

@router.get("/users/")
async def read_users():
    return [{"username": "Rick"}, {"username": "Morty"}]

app.include_router(router)
```

**Descripción del ejemplo:**

- `verify_token` es una dependencia que se aplica a todas las rutas dentro del `router`.
- Tanto `read_items` como `read_users` requieren que `verify_token` se ejecute antes de que se llamen.
- Esto es útil para estructurar aplicaciones más grandes con múltiples archivos.

---

## C - Uso de `Annotated` para dependencias globales

**Definición:**  
`Annotated` es una forma moderna de declarar dependencias en FastAPI. Permite combinar el tipo de dato con metadatos (como `Depends`), lo que hace el código más legible y mantenible. También se puede usar con dependencias globales.

**Ejemplo:**

```python
from typing import Annotated
from fastapi import Depends, FastAPI, Header, HTTPException

app = FastAPI(dependencies=[Depends(verify_token)])

async def verify_token(x_token: Annotated[str, Header()]):
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="X-Token header invalid")

@app.get("/items/")
async def read_items():
    return [{"item": "Portal Gun"}, {"item": "Plumbus"}]
```

**Descripción del ejemplo:**

- `verify_token` usa `Annotated` para combinar el tipo `str` con la dependencia `Header`.
- Esto hace que el código sea más claro y evita confusiones con otros parámetros.
- La dependencia se aplica globalmente a todas las rutas.

---

## D - Dependencias globales que retornan valores

**Definición:**  
Las dependencias globales pueden retornar valores, pero estos valores no se pasan a las funciones de las operaciones de ruta. Sin embargo, la dependencia se ejecuta antes de cada operación de ruta.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI, Header

app = FastAPI(dependencies=[Depends(get_api_key)])

async def get_api_key(x_key: str = Header()):
    return x_key

@app.get("/items/")
async def read_items():
    return [{"item": "Portal Gun"}, {"item": "Plumbus"}]
```

**Descripción del ejemplo:**

- `get_api_key` retorna el valor de un encabezado, pero este valor no se pasa a `read_items`.
- La dependencia se ejecuta antes de la función de la operación de ruta.

---

## E - Dependencias globales que lanzan excepciones

**Definición:**  
Las dependencias globales pueden lanzar excepciones, como `HTTPException`, para detener la ejecución de cualquier operación de ruta si no se cumplen ciertas condiciones.

**Ejemplo:**

```python
from fastapi import Depends, FastAPI, HTTPException, Header

app = FastAPI(dependencies=[Depends(verify_token)])

async def verify_token(x_token: str = Header()):
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="Invalid token")

@app.get("/items/")
async def read_items():
    return [{"item": "Portal Gun"}, {"item": "Plumbus"}]
```

**Descripción del ejemplo:**

- `verify_token` verifica un token en el encabezado.
- Si el token no es válido, se lanza una excepción y `read_items` no se ejecuta.
- Esta dependencia se aplica a todas las rutas de la aplicación.
