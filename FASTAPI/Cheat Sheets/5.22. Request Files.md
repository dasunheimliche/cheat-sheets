## A - Subida de archivos en FastAPI

**Definición:**  
FastAPI permite manejar la subida de archivos desde el cliente usando la clase `File` y `UploadFile`. Los archivos se envían como "datos de formulario" (`multipart/form-data`), y FastAPI se encarga de leerlos y procesarlos.

**Requisito previo:**  
Para manejar archivos, debes instalar `python-multipart` en tu entorno virtual:

```bash
pip install python-multipart
```

---

## B - Importar `File` y `UploadFile`

**Definición:**  
Para trabajar con archivos en FastAPI, debes importar `File` y `UploadFile` desde `fastapi`. `File` se usa para definir parámetros de archivo, mientras que `UploadFile` es una clase más avanzada que permite manejar archivos grandes y acceder a metadatos.

Ejemplo:

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

**Descripción:**

- `File()` se usa para recibir el archivo como `bytes`.
- `UploadFile` es más eficiente para archivos grandes y permite acceder a metadatos como el nombre del archivo y su tipo MIME.

---

## C - Uso de `UploadFile`

**Definición:**  
`UploadFile` es una clase que permite manejar archivos de manera eficiente, especialmente para archivos grandes. Almacena el archivo en memoria hasta un límite y luego lo guarda en disco. También proporciona métodos asíncronos para leer y escribir.

Atributos y métodos principales:

- `filename`: Nombre del archivo subido.
- `content_type`: Tipo MIME del archivo (por ejemplo, `image/jpeg`).
- `file`: Objeto `SpooledTemporaryFile` que permite interactuar con el archivo.
- Métodos asíncronos: `read()`, `write()`, `seek()`, `close()`.

Ejemplo:

```python
@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    contents = await file.read()  # Lee el contenido del archivo
    return {"filename": file.filename, "content_type": file.content_type}
```

**Descripción:**

- `await file.read()` lee el contenido del archivo.
- `file.filename` y `file.content_type` proporcionan metadatos útiles.

---

## D - Datos de formulario (`Form Data`)

**Definición:**  
Cuando se suben archivos, los datos se envían como "datos de formulario" (`multipart/form-data`). FastAPI maneja automáticamente este tipo de codificación y extrae los archivos del cuerpo de la solicitud.

**Nota:**  
No puedes mezclar `File`/`Form` con `Body` (JSON) en la misma solicitud, ya que el cuerpo se codifica de manera diferente.

---

## E - Subida opcional de archivos

**Definición:**  
Puedes hacer que la subida de archivos sea opcional usando `None` como valor predeterminado. Esto es útil cuando no siempre se espera un archivo.

Ejemplo:

```python
@app.post("/files/")
async def create_file(file: bytes | None = File(default=None)):
    if not file:
        return {"message": "No file sent"}
    return {"file_size": len(file)}
```

**Descripción:**

- Si no se envía un archivo, la función devuelve un mensaje indicando que no se recibió ningún archivo.

---

## F - Subida de múltiples archivos

**Definición:**  
FastAPI permite subir varios archivos al mismo tiempo. Puedes declarar una lista de `bytes` o `UploadFile` para manejar múltiples archivos.

Ejemplo:

```python
@app.post("/files/")
async def create_files(files: list[bytes] = File()):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: list[UploadFile]):
    return {"filenames": [file.filename for file in files]}
```

**Descripción:**

- `files: list[bytes]` recibe una lista de archivos como `bytes`.
- `files: list[UploadFile]` recibe una lista de archivos como objetos `UploadFile`.

---

## G - Metadatos adicionales con `File()`

**Definición:**  
Puedes usar `File()` para agregar metadatos adicionales a los archivos subidos, como una descripción.

Ejemplo:

```python
@app.post("/files/")
async def create_file(file: bytes = File(description="A file read as bytes")):
    return {"file_size": len(file)}
```

**Descripción:**

- `File(description="...")` agrega una descripción al parámetro del archivo.

---

## H - Subida de múltiples archivos con metadatos

**Definición:**  
Puedes combinar la subida de múltiples archivos con metadatos adicionales usando `File()`.

Ejemplo:

```python
@app.post("/files/")
async def create_files(files: list[bytes] = File(description="Multiple files as bytes")):
    return {"file_sizes": [len(file) for file in files]}
```

**Descripción:**

- `File(description="...")` agrega una descripción a cada archivo en la lista.
