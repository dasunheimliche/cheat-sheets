## A - Endpoints Est√°ticos (para Archivos) üî¥

#### 1. **Introducci√≥n:**

Te permiten crear archivos (como un JSON o una imagen) de forma program√°tica durante la construcci√≥n de tu sitio, los cuales se quedan fijos y listos para ser servidos.

#### 2. **Ejemplo:**

Imagina que quieres generar un archivo `builtwith.json` que simplemente contenga informaci√≥n sobre la tecnolog√≠a con la que construiste tu web.

**`src/pages/builtwith.json.ts`**

```typescript
// Esto generar√° un archivo en la ruta: /builtwith.json
export function GET({ params, request }) {
  return new Response(
    JSON.stringify({
      name: "Astro",
      url: "https://astro.build/",
    })
  );
}
```

**Explicaci√≥n del ejemplo:**
¬°Vamos a desmenuzar esto, que no se nos escape nada!

1.  **El Nombre del Archivo es la Clave:** F√≠jate bien en el nombre: `builtwith.json.ts`. Astro es muy listo y entiende que quieres crear un archivo llamado `builtwith.json`. La extensi√≥n `.ts` (o `.js`) es solo para que escribas tu l√≥gica; Astro la eliminar√° al construir el archivo final. ¬°Es como darle una instrucci√≥n en el propio nombre!
2.  **La Funci√≥n M√°gica `GET`:** `export function GET` es la receta que Astro ejecutar√°. Se llama `GET` porque esto responde a una petici√≥n web de tipo GET (la m√°s com√∫n, la que usas al navegar).
3.  **Creando la Respuesta:** `return new Response(...)` es como le dices a Astro: "¬°Esto es lo que quiero que contenga el archivo!".
4.  **¬øPor qu√© `JSON.stringify`?** ¬°Excelente pregunta! El objeto `Response` necesita recibir el contenido como texto (o como un buffer de datos, para im√°genes y otros binarios). No puedes pasarle un objeto de JavaScript `{...}` directamente. `JSON.stringify()` convierte tu objeto a una cadena de texto con formato JSON, que es exactamente lo que necesitamos.

#### 3. **Desarrollo**:

Piensa en esto como una "receta" que Astro sigue al pie de la letra _una sola vez_, cuando construye tu web. El resultado es un archivo est√°tico, como si lo hubieras subido por FTP. No cambia, no piensa, solo existe.

- **Rutas Din√°micas:** ¬øY si quieres crear varios archivos a la vez? ¬°Puedes! Usando la misma sintaxis que en las p√°ginas (`[id].json.ts`), puedes generar m√∫ltiples archivos. Para ello, necesitas exportar una funci√≥n `getStaticPaths()` que le diga a Astro exactamente qu√© archivos crear.

  ```typescript
  // src/pages/api/[id].json.ts
  // Esto crear√° /api/0.json, /api/1.json, etc.
  export function getStaticPaths() {
    return [
      { params: { id: "0" } },
      { params: { id: "1" } },
      // ... y as√≠ sucesivamente
    ];
  }

  export function GET({ params }) {
    // params.id tendr√° el valor "0", "1", etc.
    return new Response(JSON.stringify({ userId: params.id }));
  }
  ```

- **Archivos Binarios (Im√°genes, etc.):** No solo puedes crear texto. Si quieres generar un archivo de imagen, simplemente obtienes los datos de la imagen y los devuelves en la `Response`.

  ```typescript
  // src/pages/astro-logo.png.ts
  export async function GET() {
    const response = await fetch(
      "https://docs.astro.build/assets/full-logo-light.png"
    );
    // response.arrayBuffer() convierte la imagen en datos binarios
    return new Response(await response.arrayBuffer());
  }
  ```

- **¬°Ojo aqu√≠! El objeto `request`:** En este modo est√°tico, el objeto `request` es bastante limitado. Pr√°cticamente solo te sirve para obtener la URL del propio endpoint (`request.url`), porque como el archivo se genera en el momento de la construcci√≥n, no hay una "petici√≥n de usuario" real a la que responder.

üî¥ **Fundamental**: Es una capacidad esencial de Astro para generar cualquier tipo de archivo que no sea una p√°gina HTML, como feeds RSS, sitemaps, o APIs de datos est√°ticos. Es la base para un sitio est√°tico rico en contenido.

---

## B - Endpoints de Servidor (Rutas de API) üü°

#### 1. **Introducci√≥n:**

A diferencia de los est√°ticos, estos endpoints se ejecutan en el servidor _cada vez_ que un usuario los solicita, permiti√©ndote crear APIs din√°micas, procesar formularios y conectarte a bases de datos en tiempo real.

#### 2. **Ejemplo:**

Imagina una API que busca un producto en tu base de datos seg√∫n el ID que le pasen en la URL. Si lo encuentra, lo devuelve; si no, devuelve un error 404.

**`src/pages/products/[id].json.js`**

```javascript
// export const prerender = false; // ¬°Necesario si est√°s en modo h√≠brido!

export async function GET({ params }) {
  const productId = params.id; // Ej: "helmet" si la URL es /products/helmet.json

  // Simulamos una b√∫squeda en la base de datos
  const product = await findProductInDatabase(productId);

  if (!product) {
    // No se encontr√≥ el producto, devolvemos un error 404
    return new Response(null, {
      status: 404,
      statusText: "Not Found",
    });
  }

  // Producto encontrado, lo devolvemos como JSON con un estado 200 (√âxito)
  return new Response(JSON.stringify(product), {
    status: 200,
    headers: { "Content-Type": "application/json" },
  });
}
```

**Explicaci√≥n del ejemplo:**
¬°No te me asustes! Esto es m√°s f√°cil de lo que parece, te lo prometo.

1.  **Ruta Din√°mica sin `getStaticPaths`:** F√≠jate que el archivo se llama `[id].json.js`. A diferencia del modo est√°tico, aqu√≠ no necesitamos `getStaticPaths`. El endpoint est√° "vivo" y responder√° a _cualquier_ ID que le pongan en la URL (`/products/zapatilla.json`, `/products/123.json`, etc.).
2.  **`params.id` al Vuelo:** La funci√≥n `GET` recibe el objeto `params`, que contiene el valor del `id` extra√≠do directamente de la URL que el usuario visit√≥. ¬°Pura magia din√°mica!
3.  **L√≥gica de Servidor:** Aqu√≠ est√° el superpoder. El `if (!product)` es c√≥digo que se ejecuta _en el servidor en el momento de la petici√≥n_. Puedes tomar decisiones, consultar una base de datos, lo que quieras.
4.  **Respuestas con `status`:** Ahora la `Response` es mucho m√°s potente. Puedes especificar un `status` (como `404` para "No Encontrado" o `200` para "OK") y `headers` (para decirle al navegador qu√© tipo de contenido est√°s enviando). Esto es VITAL para construir APIs de verdad.

#### 3. **Desarrollo**:

La gran diferencia con los Endpoints Est√°ticos (mira el concepto A, ¬°por favor!) es el **_cu√°ndo_** se ejecuta el c√≥digo. Est√°tico = una vez, al construir. Servidor = cada vez que alguien lo pide.

- **¬°No olvides activar el modo SSR!** Para que esto funcione, tu proyecto Astro debe estar configurado en modo `server` o `hybrid`. Si est√°s en modo `hybrid` (o `static` y quieres que solo este endpoint sea din√°mico), debes a√±adir `export const prerender = false;` al principio del archivo. Si no lo haces, Astro intentar√° convertirlo en un archivo est√°tico y fallar√°. ¬°Este es un error s√∫per com√∫n!

  ![Chef de Houston](https://docs.astro.build/houston_chef.webp)

- **M√°s que solo `GET` (M√©todos HTTP):** ¬°Puedes construir una API completa! Simplemente exporta funciones con el nombre del m√©todo HTTP que quieras manejar: `POST` (para recibir datos, como de un formulario), `PUT` (para actualizar), `DELETE` (para borrar), etc.

  ```typescript
  // src/pages/comments.json.ts
  export function GET({ request }) {
    /* Devuelve comentarios */
  }
  export async function POST({ request }) {
    /* A√±ade un nuevo comentario */
  }
  export function DELETE({ request }) {
    /* Borra un comentario */
  }
  // La funci√≥n ALL se usa si no hay una espec√≠fica para el m√©todo solicitado
  export function ALL({ request }) {
    /* Respuesta para otros m√©todos */
  }
  ```

- **El objeto `request` (¬°con superpoderes!):** En este modo, el objeto `request` es una mina de oro. Contiene toda la informaci√≥n de la petici√≥n del usuario. Puedes leer las cabeceras (`request.headers`) o, m√°s importante, leer los datos que te env√≠an en el cuerpo de la petici√≥n (por ejemplo, de un formulario).

  ```typescript
  // Ejemplo para un endpoint que recibe un POST con JSON
  export async function POST({ request }) {
    const body = await request.json(); // Lee el cuerpo de la petici√≥n como JSON
    const name = body.name;
    // ...haz algo con el nombre...
    return new Response(JSON.stringify({ message: `Hola, ${name}` }));
  }
  ```

- **Redirecciones:** ¬øNecesitas redirigir al usuario a otra p√°gina? ¬°F√°cil! El contexto te da una funci√≥n `redirect`.

  ```javascript
  export function GET({ params, redirect }) {
    // ...l√≥gica...
    return redirect("/nueva-pagina", 307); // Redirige a /nueva-pagina
  }
  ```

üü° **Importante**: Si tu sitio necesita interactuar con el usuario, manejar formularios, tener un √°rea de login, o conectarse a una base de datos en tiempo real, este concepto es tu pan de cada d√≠a. Es lo que convierte a Astro de un simple generador de sitios est√°ticos a un framework full-stack.
