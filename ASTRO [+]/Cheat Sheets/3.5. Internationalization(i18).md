## A - Configuración Inicial (i18n): El Cerebro Multilingüe de tu Web 🔴

#### 1. **Introducción:**

Este es el primer paso y el más crucial: aquí le dices a Astro qué idiomas hablará tu sitio y cuál es el idioma principal.

#### 2. **Ejemplo:**

Imagina que tu sitio web es una torre de oficinas internacional. Este código es el directorio en la entrada que dice: "Aquí hablamos español, inglés y portugués. El idioma oficial de la torre es el inglés".

```javascript
// astro.config.mjs

import { defineConfig } from "astro/config";

export default defineConfig({
  i18n: {
    // 1. Lista de todos los idiomas que soportas
    locales: ["es", "en", "pt-br"],

    // 2. El idioma que se usará por defecto
    defaultLocale: "en",
  },
});
```

**Explicación del ejemplo:**

1.  `locales`: Es un array (una lista) con todos los códigos de los idiomas que tu web ofrecerá. `es` para español, `en` para inglés, `pt-br` para portugués de Brasil.
2.  `defaultLocale`: Es el idioma que verán los visitantes si no se especifica otro. Debe ser uno de los que listaste en `locales`. En nuestro caso, si alguien visita `misitio.com`, verá el contenido en inglés.

#### 3. **Desarrollo**:

Este bloque de configuración `i18n` en tu archivo `astro.config.mjs` es el centro de mando para todo lo relacionado con los idiomas. Sin esto, Astro no sabe cómo gestionar las diferentes versiones de tus páginas. Es como intentar construir un edificio sin planos: imposible.

- **`locales`**: Piensa en esto como los pasaportes que tu sitio acepta. Cada código debe ser único.
- **`defaultLocale`**: Este es el "idioma de casa". Si un visitante llega a tu web sin una preferencia clara (por ejemplo, a la página de inicio), este es el idioma que le mostrarás.

🔴 **Fundamental**: No puedes tener un sitio multilingüe en Astro sin esto. Es el punto de partida obligatorio, la piedra angular sobre la que se construye todo lo demás.

---

## B - Carpetas por Idioma: Organizando tu Contenido como un Profesional 🔴

#### 1. **Introducción:**

Para que Astro sepa dónde está el contenido de cada idioma, debes organizar tus páginas en carpetas con el nombre del código de idioma correspondiente.

#### 2. **Ejemplo:**

Siguiendo con nuestra torre de oficinas, cada idioma tiene su propio piso. La planta baja es para el idioma por defecto (inglés), y luego hay un piso para español, otro para portugués, etc.

![Estructura de carpetas para i18n](https://docs.astro.build/assets/i18n-folder-structure.png)

**Explicación del ejemplo:**

- `src/pages/index.astro` y `src/pages/about.astro`: Son las páginas para el idioma por defecto (`en`). Están en la raíz de `pages`.
- `src/pages/es/index.astro` y `src/pages/es/about.astro`: Son las mismas páginas, pero traducidas al español. Están dentro de una carpeta llamada `es`.
- `src/pages/pt-br/`: Aquí irían las páginas en portugués.

#### 3. **Desarrollo**:

Astro utiliza un sistema de enrutamiento basado en archivos. Esto significa que la estructura de tus carpetas se convierte directamente en las URLs de tu sitio. Al crear una carpeta `es` dentro de `src/pages/`, Astro entiende automáticamente que cualquier página dentro de ella pertenecerá a la ruta `/es/`.

**¡Cuidado con esta confusión común!**: Las carpetas deben llamarse _exactamente_ igual que los `locales` que definiste en la configuración. Si pusiste `"pt-br"`, la carpeta debe llamarse `pt-br`, no `pt` ni `portugues`.

🔴 **Fundamental**: Esta estructura de carpetas es la contraparte física de tu configuración lógica. Una no funciona sin la otra. Es la forma en que Astro encuentra y sirve el contenido correcto para cada idioma.

---

## C - `prefixDefaultLocale`: ¿Tu Idioma Principal Lleva Etiqueta? 🟡

#### 1. **Introducción:**

Esta opción te permite decidir si la URL de tu idioma por defecto debe incluir el prefijo del idioma (ej: `/en/about`) o no (ej: `/about`).

#### 2. **Ejemplo:**

```javascript
// astro.config.mjs
import { defineConfig } from "astro/config";

export default defineConfig({
  i18n: {
    locales: ["es", "en", "fr"],
    defaultLocale: "en",
    routing: {
      // Opción 1: false (por defecto)
      prefixDefaultLocale: false,
      // Opción 2: true
      // prefixDefaultLocale: true
    },
  },
});
```

**Explicación del ejemplo:**

- **`prefixDefaultLocale: false` (Comportamiento por defecto):**

  - Página en inglés (defecto): `misitio.com/about`
  - Página en español: `misitio.com/es/about`
  - Los archivos del idioma por defecto (`en`) van en `src/pages/`.

- **`prefixDefaultLocale: true`:**
  - Página en inglés (defecto): `misitio.com/en/about`
  - Página en español: `misitio.com/es/about`
  - **¡Importante!** TODOS los idiomas, incluido el inglés, deben tener su propia carpeta (`src/pages/en/`, `src/pages/es/`, etc.).

#### 3. **Desarrollo**:

Esta decisión afecta principalmente a la estética de tus URLs y al SEO.

- **`false`**: Es común si quieres que tu audiencia principal vea URLs más limpias y cortas, sin el prefijo del idioma. Es como si la entrada principal del edificio te llevara directamente al piso en inglés.
- **`true`**: Es útil si quieres que todos los idiomas sean tratados por igual en la estructura de URLs, lo que puede ser más claro y consistente. Cada idioma, sin excepción, tiene su propio "piso" claramente etiquetado desde la URL.

🟡 **Importante**: Aunque tiene un valor por defecto que funciona bien, entender esta opción es clave para estructurar tus URLs y tus carpetas de la forma que realmente deseas. Una mala elección inicial puede llevar a reestructuraciones más tarde.

---

## D - Creando Enlaces Multilingües: Navegación sin Errores 🟡

#### 1. **Introducción:**

Astro te da una herramienta mágica, `getRelativeLocaleUrl()`, para crear enlaces que siempre apuntan a la versión correcta de una página según el idioma.

#### 2. **Ejemplo:**

Imagina que estás en la página "Acerca de" en español y quieres poner un enlace a la página "Blog". No quieres enviarlos al blog en inglés por error. Esta función se encarga de que el enlace sea `misitio.com/es/blog`.

```astro
---
// src/pages/es/index.astro
import { getRelativeLocaleUrl } from 'astro:i18n';

// Genera la URL para la página 'about' en el idioma 'es'
const aboutURL = getRelativeLocaleUrl("es", "about"); // Resultado: "/es/about"

// Genera la URL para la página 'blog' en el idioma 'es'
const blogURL = getRelativeLocaleUrl('es', 'blog'); // Resultado: "/es/blog"
---

<!-- Enlace escrito a mano (más propenso a errores) -->
<a href="/es/get-started/">¡Vamos!</a>

<!-- Enlaces generados con la función (más seguro) -->
<a href={blogURL}>Blog</a>
<a href={aboutURL}>Acerca de nosotros</a>
```

**Explicación del ejemplo:**
En lugar de escribir la ruta completa (`/es/blog`), le pides a Astro que la construya por ti. Le dices `getRelativeLocaleUrl('es', 'blog')` y él te devuelve la cadena de texto `/es/blog`. Esto es genial porque si cambias la configuración de `prefixDefaultLocale`, ¡estos enlaces seguirán funcionando sin que tengas que cambiar nada!

#### 3. **Desarrollo**:

Escribir URLs a mano es como caminar por un campo minado: un pequeño error y el enlace se rompe. `getRelativeLocaleUrl(locale, path)` es tu detector de metales. Le das el idioma (`locale`) y el nombre de la página (`path`, sin la extensión `.astro`) y te devuelve la URL correcta y segura, respetando toda tu configuración de i18n.

🟡 **Importante**: Usar esta función es una práctica recomendada. Te ahorra dolores de cabeza, previene errores de enlaces rotos y hace que tu código sea mucho más robusto y fácil de mantener a largo plazo.

---

## E - `fallback`: El Plan B para Contenido Faltante 🟡

#### 1. **Introducción:**

Esta función te permite mostrar una página en otro idioma si la traducción para el idioma actual todavía no existe, evitando así mostrar un error 404 (Página no encontrada).

#### 2. **Ejemplo:**

Supongamos que tienes una página "Términos y Condiciones" en español, pero aún no la has traducido al francés. Con `fallback`, si un usuario visita `misitio.com/fr/terminos-y-condiciones`, en lugar de un error, le muestras la versión en español.

```javascript
// astro.config.mjs
import { defineConfig } from "astro/config";

export default defineConfig({
  i18n: {
    locales: ["es", "en", "fr"],
    defaultLocale: "en",
    // Si una página en francés ('fr') no existe,
    // usa la versión en español ('es') como alternativa.
    fallback: {
      fr: "es",
    },
  },
});
```

**Explicación del ejemplo:**
La línea `fr: "es"` establece una regla clara: "Para cualquier página solicitada en francés que no encuentre, busque y muestre la versión en español". Esto es mucho mejor que dejar al usuario en un callejón sin salida.

#### 3. **Desarrollo**:

El `fallback` es tu red de seguridad. Es especialmente útil en sitios grandes donde las traducciones pueden no estar completas para todas las páginas desde el primer día. Puedes definir diferentes `fallbacks` para cada idioma (por ejemplo, que el catalán recurra al español, y el gallego al portugués).

Además, puedes elegir _cómo_ se muestra ese contenido alternativo:

- **Redirección (por defecto)**: El usuario es enviado a la URL del idioma de `fallback` (ej: de `/fr/pagina` a `/es/pagina`). La URL en el navegador cambia.
- **Reescritura (`rewrite`)**: El usuario ve el contenido del idioma de `fallback`, pero la URL en el navegador no cambia (sigue siendo `/fr/pagina`). Esto es más transparente para el usuario.

🟡 **Importante**: Esta es una característica poderosa para mejorar la experiencia del usuario. Evita frustraciones y asegura que tus visitantes siempre encuentren _algo_ de contenido útil, incluso si no está en su idioma preferido.

---

## F - `domains`: Un Dominio para cada Idioma 🔵

#### 1. **Introducción:**

Para proyectos más grandes, puedes asignar un dominio o subdominio completamente diferente a cada idioma (ej: `misitio.es` para español y `mysite.co.uk` para inglés).

#### 2. **Ejemplo:**

En lugar de `misitio.com/es/` y `misitio.com/fr/`, quieres tener `misitio.es` y `misitio.fr`.

```javascript
// astro.config.mjs
import { defineConfig } from "astro/config";

export default defineConfig({
  site: "https://example.com", // Dominio principal
  output: "server", // ¡Requerido!
  i18n: {
    locales: ["es", "en", "fr"],
    defaultLocale: "en",
    domains: {
      es: "https://example.es",
      fr: "https://fr.example.com",
    },
  },
});
```

**Explicación del ejemplo:**

- `es: "https://example.es"`: Mapea el idioma español al dominio `example.es`. Una visita a `https://example.es/about` buscará el archivo `src/pages/es/about.astro`.
- `fr: "https://fr.example.com"`: Mapea el francés al subdominio `fr.example.com`.
- El inglés (`en`), al no estar en `domains`, usará el dominio principal: `https://example.com/about`.

#### 3. **Desarrollo**:

Esta es una estrategia de SEO y de marca muy avanzada. Le indica a los motores de búsqueda y a los usuarios que tienes una presencia fuerte y dedicada en cada región.

**¡Mucho ojo con las limitaciones!**

- Solo funciona en modo `output: "server"`. No es para sitios estáticos.
- Necesitas tener configurado un `site` en tu `astro.config.mjs`.
- Tu proveedor de hosting debe configurar correctamente los servidores para que esto funcione.

🔵 **Específico**: Esta es una herramienta para casos de uso muy concretos, generalmente para empresas grandes con una estrategia de internacionalización muy definida. No es algo que necesites para empezar, pero es increíblemente potente saber que existe.

---

## G - Detección de Idioma del Navegador: Hablando el Idioma de tu Visitante 🟡

#### 1. **Introducción:**

Astro puede detectar el idioma preferido del navegador de tu visitante y ofrecerte esa información para que puedas, por ejemplo, sugerirle cambiar a su idioma.

#### 2. **Ejemplo:**

Imagina que un usuario de Francia, cuyo navegador está en francés, visita tu página en inglés (`misitio.com/about`). Podrías mostrarle un pequeño banner que diga: "👋 Bonjour! ¿Prefieres ver esta página en francés?".

```astro
---
// En cualquier página .astro
// Astro.currentLocale: 'en' (porque estamos en la URL en inglés)
// Si el navegador del visitante prefiere 'fr' y 'fr' está en tus locales:
// Astro.preferredLocale será 'fr'
// Astro.preferredLocaleList será ['fr', ...]

const suggestedLocale = Astro.preferredLocale;
const currentLocale = Astro.currentLocale;
---

{suggestedLocale && suggestedLocale !== currentLocale && (
  <div class="banner">
    ¿Prefieres leer esto en tu idioma?
    <a href={`/${suggestedLocale}/about`}>Cambiar a {suggestedLocale}</a>
  </div>
)}
```

**Explicación del ejemplo:**

- `Astro.currentLocale`: Te dice el idioma de la página que se está viendo AHORA MISMO.
- `Astro.preferredLocale`: Te dice cuál de TUS idiomas soportados coincide con la preferencia MÁS ALTA del navegador del visitante.
- `Astro.preferredLocaleList`: Te da una lista de TODAS las coincidencias entre los idiomas del navegador y los tuyos.

El código comprueba si existe un idioma sugerido (`suggestedLocale`) y si es diferente al actual. Si es así, muestra un banner para cambiar de idioma.

#### 3. **Desarrollo**:

Esta funcionalidad (disponible en páginas renderizadas en el servidor) te permite ser proactivo y mejorar enormemente la experiencia del usuario. En lugar de forzar al usuario a buscar el selector de idioma, te anticipas a sus necesidades.

- `Astro.currentLocale`: Siempre disponible. Es el idioma de la URL.
- `Astro.preferredLocale` y `Astro.preferredLocaleList`: Solo disponibles en renderizado bajo demanda (`output: 'server'` o `hybrid`). Son el puente entre las preferencias de tu usuario y lo que tu sitio puede ofrecer.

🟡 **Importante**: Aunque requiere renderizado en el servidor, esta es una de las características más amigables para el usuario que ofrece el paquete de i18n. Demuestra un nivel de pulido y atención al detalle que los visitantes aprecian.
