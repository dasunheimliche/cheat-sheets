## A - ¬øQu√© es Server-Side Rendering (SSR)?

#### 1. **Definici√≥n:**

Server-Side Rendering (SSR), o Renderizado en el Servidor, es una t√©cnica que te permite **renderizar tus componentes React en HTML directamente en el servidor**. En lugar de enviar una p√°gina web vac√≠a al navegador y dejar que JavaScript haga todo el trabajo en el lado del cliente, con SSR, el servidor env√≠a una p√°gina HTML **ya renderizada y lista para mostrar**. Luego, el navegador "hidrata" este HTML est√°tico para convertirlo en una aplicaci√≥n React interactiva. ¬°Es como darle un "turbo" inicial a tu p√°gina web! üèéÔ∏è

#### 2. **Beneficios del SSR:**

- **Mejor rendimiento inicial:** Los usuarios ven el contenido de la p√°gina **mucho m√°s r√°pido** porque el HTML ya est√° renderizado. ¬°Ideal para la primera impresi√≥n! ü§©
- **SEO mejorado:** Los motores de b√∫squeda pueden indexar el contenido de tu p√°gina **m√°s f√°cilmente** porque el HTML ya contiene el contenido renderizado. ¬°Ayuda a que te encuentren en Google! üîç
- **Mejor experiencia en dispositivos lentos:** En dispositivos con poca potencia o conexiones lentas, el SSR puede mejorar significativamente la experiencia del usuario al reducir el tiempo de carga inicial. üê¢‚û°Ô∏èüöÄ

#### 3. **Notas o advertencias:**

- **Complejidad:** Implementar SSR puede ser m√°s complejo que el renderizado tradicional en el cliente. Requiere configurar un servidor y manejar la hidrataci√≥n correctamente. ü§Ø
- **Servidor Node.js:** Normalmente, el SSR con React se realiza en un servidor Node.js.

## B - SSR con React: Ejemplo B√°sico (App Est√°tica)

#### 1. **Definici√≥n:**

Para entender c√≥mo funciona el SSR con React, vamos a crear un ejemplo muy sencillo de una aplicaci√≥n **est√°tica** (sin estado, solo muestra contenido) usando `express`, `react` y `react-dom/server`.

#### 2. **Ejemplo de C√≥digo:**

**`tsconfig.json` (Configuraci√≥n de TypeScript):**

```json
{
  "compilerOptions": {
    "noImplicitAny": false,
    "noEmitOnError": true,
    "removeComments": false,
    "sourceMap": true,
    "target": "esnext"
  },
  "include": ["**/*"]
}
```

**`app.tsx` (Componente React):**

```typescript jsx
export const App = () => {
  return (
    <html>
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Static Server-side-rendered App</title>
      </head>
      <body>
        <div>Hello World!</div>
      </body>
    </html>
  );
};
```

**`server.tsx` (Servidor Express):**

```typescript jsx
import express from "express";
import React from "react";
import ReactDOMServer from "react-dom/server"; // Importa react-dom/server

import { App } from "./app.tsx";

const port = Number.parseInt(process.env.PORT || "3000", 10);
const app = express();

app.get("/", (_, res) => {
  const { pipe } = ReactDOMServer.renderToPipeableStream(<App />, {
    // Usa renderToPipeableStream para SSR
    onShellReady() {
      res.setHeader("content-type", "text/html");
      pipe(res); // Env√≠a el HTML renderizado al cliente
    },
  });
});

app.listen(port, () => {
  console.log(`Server is listening at ${port}`);
});
```

**Comandos para ejecutar:**

```bash
tsc --build  # Compila TypeScript
node server.js # Inicia el servidor Node.js
```

#### 3. **Explicaci√≥n del Ejemplo:**

- **`tsconfig.json`:** Configuraci√≥n b√°sica de TypeScript. **¬°Importante!** Aseg√∫rate de eliminar los comentarios de este archivo.
- **`app.tsx`:** Un componente React simple que define la estructura HTML de la p√°gina.
- **`server.tsx`:** El servidor Express que maneja la petici√≥n a la ruta `/`.
  - **`import ReactDOMServer from 'react-dom/server';`:** Importamos `react-dom/server`, que contiene las funciones para renderizar React en el servidor.
  - **`ReactDOMServer.renderToPipeableStream(<App />, { ... })`:** Usamos `renderToPipeableStream` para renderizar el componente `<App>` en un stream HTML. `pipe` env√≠a este stream como respuesta al cliente.
  - **`onShellReady()`:** Esta funci√≥n se llama cuando React ha renderizado la parte inicial de la aplicaci√≥n (el "shell"). Aqu√≠ configuramos el `content-type` a `text/html` y enviamos el stream al cliente.

## C - ¬øQu√© es Hydration?

#### 1. **Definici√≥n:**

Hydration, o Hidrataci√≥n, es el proceso de **convertir el HTML est√°tico** que el servidor envi√≥ **en una aplicaci√≥n React completamente interactiva** en el navegador. Despu√©s de que el navegador recibe el HTML renderizado por el servidor, React "rehidrata" este HTML, adjuntando los event listeners, restaurando el estado y haciendo que la aplicaci√≥n sea din√°mica y responda a las interacciones del usuario. ¬°Es como darle "vida" al HTML est√°tico! üíß

#### 2. **Importancia de la Hydration:**

- **Interactividad:** Sin hydration, tu p√°gina web ser√≠a solo HTML est√°tico, sin ninguna interactividad de React. La hydration es esencial para que tu aplicaci√≥n SSR sea realmente una aplicaci√≥n React funcional. üñ±Ô∏è
- **Continuidad:** La hydration asegura que la aplicaci√≥n en el cliente "contin√∫e" desde el punto donde la dej√≥ el servidor. El estado inicial y la estructura de la UI se mantienen consistentes entre el servidor y el cliente. ü§ù

#### 3. **Notas o advertencias:**

- **`react-dom/client`:** Para la hydration, necesitas usar `react-dom/client` en el lado del cliente.
- **`hydrateRoot`:** La funci√≥n principal para realizar la hydration en React 18 y versiones posteriores es `hydrateRoot`.

## D - Hydration con React: Ejemplo (App con Estado)

#### 1. **Definici√≥n:**

Ahora vamos a crear un ejemplo de una aplicaci√≥n **con estado** que usa SSR e Hydration. Necesitaremos `express`, `react`, `react-dom/server` y **`react-dom/client`** (¬°para la hydration en el cliente!).

#### 2. **Ejemplo de C√≥digo:**

**`tsconfig.json` (Configuraci√≥n de TypeScript):**

```json
{
  "compilerOptions": {
    "noImplicitAny": false,
    "noEmitOnError": true,
    "removeComments": false,
    "sourceMap": true,
    "target": "esnext"
  },
  "include": ["**/*"]
}
```

**`app.tsx` (Componente React - ¬°sin cambios respecto al ejemplo anterior!):**

```typescript jsx
export const App = () => {
  return (
    <html>
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Static Server-side-rendered App</title>
      </head>
      <body>
        <div>Hello World!</div>
      </body>
    </html>
  );
};
```

**`main.tsx` (Punto de entrada del cliente - ¬°NUEVO!):**

```typescript jsx
import ReactDOMClient from "react-dom/client"; // Importa react-dom/client

import { App } from "./app.tsx";

ReactDOMClient.hydrateRoot(document, <App />); // Usa hydrateRoot para la hidrataci√≥n
```

**`server.tsx` (Servidor Express - ¬°ligeramente modificado!):**

```typescript jsx
import express from "express";
import React from "react";
import ReactDOMServer from "react-dom/server";

import { App } from "./app.tsx";

const port = Number.parseInt(process.env.PORT || "3000", 10);
const app = express();

app.use("/", (_, res) => {
  const { pipe } = ReactDOMServer.renderToPipeableStream(<App />, {
    bootstrapScripts: ["/main.js"], // ¬°A√±ade bootstrapScripts para incluir main.js en el HTML!
    onShellReady() {
      res.setHeader("content-type", "text/html");
      pipe(res);
    },
  });
});

app.listen(port, () => {
  console.log(`Server is listening at ${port}`);
});
```

**Comandos para ejecutar:**

```bash
tsc --build  # Compila TypeScript
node server.js # Inicia el servidor Node.js
```

#### 3. **Explicaci√≥n del Ejemplo:**

- **`tsconfig.json`:** Igual que antes. **¬°Importante!** Elimina los comentarios.
- **`app.tsx`:** Componente React (sin cambios).
- **`main.tsx`:** **¬°Nuevo archivo!** Este es el punto de entrada para el c√≥digo del **cliente**.
  - **`import ReactDOMClient from 'react-dom/client';`:** Importamos `react-dom/client`.
  - **`ReactDOMClient.hydrateRoot(document, <App />);`:** Usamos `hydrateRoot` para **hidratar** el HTML renderizado por el servidor. `document` es el nodo ra√≠z donde se realizar√° la hidrataci√≥n, y `<App />` es el mismo componente que se renderiz√≥ en el servidor.
- **`server.tsx`:** Servidor Express (ligeramente modificado).
  - **`bootstrapScripts: ['/main.js']`:** A√±adimos `bootstrapScripts: ['/main.js']` a las opciones de `renderToPipeableStream`. Esto le dice a React que **incluya un script** en el HTML renderizado que cargar√° y ejecutar√° el c√≥digo del cliente (`main.js`, que contiene la llamada a `hydrateRoot`). ¬°Este script es esencial para que la hidrataci√≥n ocurra en el navegador!

## E - ¬°Cuidado con los Errores de Hydration!

#### 1. **Advertencia Importante:**

React es muy sensible a las **diferencias entre el HTML renderizado en el servidor y el HTML que el cliente espera durante la hidrataci√≥n**. Si hay diferencias, React puede mostrar **errores de hydration** en la consola, y en el peor de los casos, ¬°la interactividad de tu aplicaci√≥n podr√≠a romperse! ‚ö†Ô∏è

#### 2. **Causas Comunes de Errores de Hydration:**

- **Espacios en blanco extra:** Espacios, saltos de l√≠nea o comentarios HTML **fuera del nodo ra√≠z de React** pueden causar problemas. Aseg√∫rate de que el HTML generado por el servidor sea **exactamente** lo que React espera.
- **`typeof window !== 'undefined'` en la l√≥gica de renderizado:** Usar comprobaciones como `typeof window !== 'undefined'` para renderizar contenido diferente en el servidor y en el cliente **es un error com√∫n**. El servidor no tiene el objeto `window`, as√≠ que estas comprobaciones pueden llevar a HTML diferente en el servidor y el cliente.
- **APIs solo del navegador (`window.matchMedia`, etc.):** Similar al punto anterior, usar APIs que solo existen en el navegador en tu l√≥gica de renderizado puede causar diferencias.
- **Datos diferentes en servidor y cliente:** La causa m√°s com√∫n de errores de hydration es **renderizar datos diferentes en el servidor y en el cliente**. Aseg√∫rate de que los datos iniciales que usas para renderizar en el servidor sean los mismos que usas para la hidrataci√≥n en el cliente.

#### 3. **C√≥mo Manejar los Errores de Hydration:**

- **React intenta recuperarse:** React intenta recuperarse de algunos errores de hydration, pero **no debes ignorarlos**. Tr√°talos como cualquier otro bug en tu c√≥digo.
- **Rendimiento y errores:** En el mejor de los casos, los errores de hydration pueden causar **ralentizaciones** en tu aplicaci√≥n. En el peor de los casos, pueden hacer que los **event handlers se adjunten a los elementos incorrectos**, ¬°rompiendo la interactividad!
- **Revisa la documentaci√≥n de `hydrateRoot`:** Lee la documentaci√≥n oficial de React sobre `hydrateRoot` para entender mejor las causas y soluciones de los errores de hydration: [hydrateRoot](https://react.dev/reference/react-dom/client/hydrateRoot) üìñ
